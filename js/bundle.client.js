var QueryString=function(){for(var e={},n=window.location.search.substring(1).split("&"),o=0;o<n.length;o++){var t=n[o].split("=");if(void 0===e[t[0]])e[t[0]]=t[1];else if("string"==typeof e[t[0]]){var i=[e[t[0]],t[1]];e[t[0]]=i}else e[t[0]].push(t[1])}return e},useragent=(navigator.userAgent||navigator.vendor||window.opera).toLowerCase(),isiPhone=/iPhone|iPad|iPod/i.test(useragent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,isAndroid=/android/i.test(useragent),isWindowsPhone=/windows phone/i.test(useragent),isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox="undefined"!=typeof InstallTrigger,isSafariA=(!(queryString=QueryString()).isSafari||"false"!=queryString.isSafari)&&(Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString()),isChrome=!!window.chrome&&!isOpera,isIEA=(!queryString.isIE||"false"!=queryString.isIE)&&!!document.documentMode,isEdge=(!queryString.isEdge||"false"!=queryString.isEdge)&&navigator.userAgent.indexOf("Edge")>-1;function getChromeVersion(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!e&&parseInt(e[2],10)}function loadScript(e,n){var o=document.createElement("script");o.type="text/javascript",o.readyState?o.onreadystatechange=function(){"loaded"!=o.readyState&&"complete"!=o.readyState||(o.onreadystatechange=null,n&&n())}:o.onload=function(){n&&n()},o.onerror=function(o){setTimeout(function(){loadScript(e,n)},5e3)},o.src=e+"?v="+currVersion,document.getElementsByTagName("head")[0].appendChild(o)}function stopFullScreenPopup(){document.getElementById("exitFullscreenButton")&&(document.getElementById("exitFullscreenButton").style.display="none"),document.getElementById("fullscreenButton")&&(document.getElementById("fullscreenButton").style.display="block"),window.resizeTo(widgetSize.width+(window.outerWidth-window.innerWidth),widgetSize.height+(window.outerHeight-window.innerHeight)),window.moveTo((screen.width-widgetSize.width)/2,(screen.height-widgetSize.height)/2)}function toggleFullScreen(){document.msFullscreenElement||document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen?stopFullScreen():showFullScreen()}function showFullScreen(){if(currentView="grid")var e=document.getElementById("video_container_small");else e=document.getElementById("video_container");e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.getElementById("exitFullscreenButton").style.display="block"}function stopFullScreen(){$("#fullScreen").show(),document.fullscreen&&document.exitFullscreen?document.exitFullscreen():document.fullscreen&&document.msExitFullscreen?document.msExitFullscreen():document.fullscreen&&document.mozCancelFullScreen?document.mozCancelFullScreen():document.fullscreen&&document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),document.getElementById("exitFullscreenButton")&&(document.getElementById("exitFullscreenButton").style.display="none")}function changeToUrl(e){for(var n=e,o=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi),t=n.split(" "),i=0;i<t.length;i++)t[i].match(o)&&(t[i]='<a target="_blank" href="'+t[i]+'">'+t[i]+"</a>");return t.join(" ")}document.addEventListener("fullscreenchange",function(){document.fullscreen||stopFullScreen()},!1),document.addEventListener("mozfullscreenchange",function(){document.mozFullScreen||stopFullScreen()},!1),document.addEventListener("MSFullscreenChange",function(){document.msFullscreenElement||stopFullScreen()},!1),document.addEventListener("webkitfullscreenchange",function(){document.webkitIsFullScreen||stopFullScreen()},!1);var prevId,prevMsgP,prevBody,estimateDif=function(e){var n=parseInt(e/1e3,10),o=Math.floor(n/3600),t=Math.floor((n-3600*o)/60),i=n-3600*o-60*t;return o||t||i?(o=o?o+(1==o?" hour ":" hours "):"")+(t=t?t+(1==t?" minute ":" minutes "):"")+(i=i?i+(1==i?" second ":" seconds "):""):null},generateLink=function(e){sessionId=Math.random().toString(36).slice(2).substring(0,15);var n={};if(lsRepUrl&&(n.lsRepUrl=lsRepUrl),$("#roomName").val()&&(sessionId=$("#roomName").val()),$("#names").val()&&(n.names=$("#names").val()),agentId&&(n.agentId=agentId),$("#visitorName").val()&&(n.visitorName=$("#visitorName").val()),$("#config").val()&&(n.config=$("#config").val()),$("#shortvisitor").val()?(shortVisitorUrl=$("#shortvisitor").val(),shortVisitorUrl_broadcast=$("#shortvisitor").val()+"_b"):(shortVisitorUrl=Math.random().toString(36).slice(2).substring(0,6),shortVisitorUrl_broadcast=Math.random().toString(36).slice(2).substring(0,6)),$("#shortagent").val()?(shortAgentUrl=$("#shortagent").val(),shortAgentUrl_broadcast=$("#shortagent").val()+"_b"):(shortAgentUrl=Math.random().toString(36).slice(2).substring(0,6),shortAgentUrl_broadcast=Math.random().toString(36).slice(2).substring(0,6)),$("#datetime").val()){var o=new Date($("#datetime").val()).toISOString();n.datetime=o}if($("#duration").val()||$("#durationtext").val()){var t=$("#durationtext").val()?$("#durationtext").val():$("#duration").val();n.duration=t}$("#disableVideo").is(":checked")&&(n.disableVideo=1),$("#disableAudio").is(":checked")&&(n.disableAudio=1),$("#disableScreenShare").is(":checked")&&(n.disableScreenShare=1),$("#disableWhiteboard").is(":checked")&&(n.disableWhiteboard=1),$("#disableTransfer").is(":checked")&&(n.disableTransfer=1),$("#autoAcceptVideo").is(":checked")&&(n.autoAcceptVideo=1),$("#autoAcceptAudio").is(":checked")&&(n.autoAcceptAudio=1);var i="";e&&(i="&broadcast=1");var r=window.btoa(unescape(encodeURIComponent(JSON.stringify(n))));r=r.split("=").join(""),visitorUrl=lsRepUrl+"pages/"+roomLinkPage+"?room="+sessionId+"&p="+r+i,viewerBroadcastLink=lsRepUrl+"pages/"+roomLinkPage+"?room="+sessionId+"&p="+r+i+"&broadcast=1";var a=document.createElement("input");a.setAttribute("value",visitorUrl),document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),$("#roomPass").val()&&(n.pass=$("#roomPass").val()),delete n.visitorName,n.isAdmin=1,r=(r=window.btoa(unescape(encodeURIComponent(JSON.stringify(n))))).split("=").join(""),agentUrl=lsRepUrl+"pages/"+roomLinkPage+"?room="+sessionId+"&p="+r+"&isAdmin=1"+i,agentBroadcastUrl=lsRepUrl+"pages/"+roomLinkPage+"?room="+sessionId+"&p="+r+"&isAdmin=1"+i+"&broadcast=1"},getCurrentTime=function(){return convertTimestamp((new Date).getTime(),!0)},guestName=function(e){if(!e)return"Visitor-00";e.charCodeAt(0),e.charCodeAt(e.length-1);for(var n=0,o=0;o<e.length;o++)n+=e.charCodeAt(o);return"Visitor-"+parseInt(n%100+1)},getCurrentDateFormatted=function(){var e=new Date;return e.getDate()+"_"+(e.getMonth()+1)+"_"+e.getFullYear()+"_"+e.getHours()+e.getMinutes()+e.getSeconds()},getPrettyDate=function(e){var n=new Date,o=String(n.getDate()).padStart(2,"0"),t=String(n.getMonth()+1).padStart(2,"0"),i=n.getFullYear(),r=new Date(1e3*e),a=r.getFullYear(),s=("0"+(r.getMonth()+1)).slice(-2),d=("0"+r.getDate()).slice(-2),c=("0"+r.getHours()).slice(-2),l=("0"+r.getMinutes()).slice(-2);return o==d&&t==s&&i==a?c+":"+l:d+"."+s+"."+a+" "+c+":"+l},convertTimestamp=function(e,n){var o=new Date,t=new Date(e),i=(o.getFullYear()!==t.getFullYear()&&t.getFullYear(),("0"+(t.getMonth()+1)).slice(-2),("0"+t.getDate()).slice(-2),t.getHours()),r=t.getMinutes(),a=i>=12?"pm":"am",s=i%12;return s=s||12,r=r<10?"0"+r:r,time=s+":"+r+" "+a,time},compareDates=function(e,n){var o=new Date(e);o.setHours(0,0,0,0);var t=new Date(n);return t.setHours(0,0,0,0),o.getTime()===t.getTime()},escapeHtmlEntities=function(e){return"undefined"!=typeof jQuery?jQuery("<div/>").text(e).html():e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};function linkify(e){return e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"})}var errorTimer,incomingAudio,incomingMessage,enterRoom,showMessage=function(e,n,o,t,i,r){if(n){n=linkify(n);var a=getPrettyDate((new Date).getTime()/1e3);if(o=""!==o&&null!==o&&"undefined"!==o&&void 0!==o?o:""===e?"":a,"conference"==conferenceStyle){if("Me"===e){e=smartVideoLocale.msgStore.me,className="media media-chat media-chat-reverse"}else""===e?className="media media-meta-day":($("#peer_name_chat").text(e),playIncomingMessage(),"undefined"===e&&(e="Guest"),className="p-10 media-chat",i||(i=lsRepUrl+"img/small-avatar.jpg"),f=i,"avatar "+e);if(t=t||"",prevId&&e==prevId)u=prevMsgP,d=prevBody;else{if((u=$("<div />",{class:className})).attr("data-system-attribue",t),e&&"Me"!==e){var s=$("<h6 />",{});s.appendTo(u),s.html(e)}var d=$("<div />",{class:"media-body"});d.appendTo(u)}var c;(c=$("<p />")).html(n),c.appendTo(d),(c=$("<p />",{class:"meta"})).html('<time datetime="2018">'+o+"</time>"),c.appendTo(d),u.appendTo($("#chat-content")),$("#typing").html(""),prevId=e,prevMsgP=u,prevBody=d,(l=document.getElementById("chat-content")).scrollTop=999999}else{var l,u=document.createElement("li"),m="left",g="",f="";if("Me"===e||"Me~"==e.substring(0,3)){m="right";var v="";if("Me~"==e.substring(0,3))if(e=e.substring(3,300),v=" right-image","img/small-avatar.jpg"!==i&&i)f='<img class="direct-chat-img '+m+'" src="'+i+'" alt="" />';else f=(f=e.match(/\b(\w)/g).join("").toUpperCase())?'<span class="acronym-right">'+f+"</span>":'<img class="direct-chat-img '+m+'" src="img/small-avatar.jpg" alt="" />';e=smartVideoLocale.msgStore.me,className="wd-right-bubble"+v}else if(""===e){var p="";"divider"===t&&(p=" divider"),className="wd-system-bubble"+p}else if(playIncomingMessage(),"undefined"===e&&(e="Guest"),g="wd-chat-name","wd-chat-avatar",className="wd-left-bubble",i||(i="/img/small-avatar.jpg"),f='<img class="direct-chat-img '+m+" "+guestName(e)+'" src="'+i+'" alt="" />',"He~"==e.substring(0,3))if(e=e.substring(3,500),"/img/small-avatar.jpg"!==i&&i)f='<img class="direct-chat-img '+m+" "+guestName(e)+'" src="'+i+'" alt="" />';else{f=e.match(/\b(\w)/g).join("").toUpperCase();var h=svg1+f+svg2;image="data:image/svg+xml;base64,"+btoa(h),f=f?'<img class="direct-chat-img '+m+" "+guestName(e)+'" src="'+image+'" alt="" />':'<img class="direct-chat-img '+m+" "+guestName(e)+'" src="/img/small-avatar.jpg" alt="" />'}t=t||"",u.setAttribute("data-system-attribue",t),u.innerHTML='<div class="'+className+'">'+f+'<span class="'+g+'">'+e+'</span><span class="timestamp">'+o+"</span><div>"+n+"</div>",(l=document.getElementById("newdev_chat_ul1")).appendChild(u),l.scrollTop=999999}}},saveChat=function(e,n,o,t,i,r){var a=queryString.names?queryString.names:svConfigs.agentName,s=(new Date).toISOString();$.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"addchat",roomId:roomId||queryString.room,message:e,agent:a,agentId:t,from:n,participants:Object.keys(r).toString(),system:o,avatar:i,datetime:s}}).done(function(e){}).fail(function(){console.log(!1)})},ERROR_TIMER=1e4,toggleError=function(e,n){jQuery("#error_message").show(),jQuery("#error_message_text").html(e),clearTimeout(errorTimer),errorTimer=setTimeout(function(){jQuery("#error_message").hide(),jQuery("#error_message_text").html("")},n||ERROR_TIMER)},toggleNotification=function(e,n){jQuery("#error_message").toggle(n),jQuery("#error_message_text").html(e)},getCookie=function(e){var n=RegExp(e+"=.[^;]*"),o=document.cookie.match(n);return o?o[0].split("=")[1]:null},deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;;path=/"},setCookie=function(e,n,o){var t=e,i=n,r=new Date,a=r.getTime()+36e5*parseInt(o);r.setTime(a),document.cookie=o?t+"="+i+";expires="+r.toGMTString()+";path=/":t+"="+i+";path=/"},getGuid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};function playIncomingCall(){if(svConfigs.alwaysNotify||!document.hasFocus()){(incomingAudio=new Audio).preload="auto",incomingAudio.autoplay=!0,incomingAudio.loop=!0,incomingAudio.src=lsRepUrl+"/media/ringtone.mp3";var e=incomingAudio.play();isIEA||void 0!==e&&e.then(function(){setTimeout(function(){incomingAudio&&incomingAudio.pause()},1e4)}).catch(function(e){console.log(e)})}}function playIncomingMessage(){if(svConfigs.alwaysNotify||!document.hasFocus()){(incomingMessage=new Audio).preload="auto",incomingMessage.autoplay=!0,incomingMessage.loop=!1,incomingMessage.src=lsRepUrl+"/media/msgtone.mp3";var e=incomingMessage.play();isIEA||void 0!==e&&e.then(function(){setTimeout(function(){incomingMessage&&incomingMessage.pause()},1e3)}).catch(function(e){console.log(e)})}}function playEnterRoom(){if(svConfigs.alwaysNotify||!document.hasFocus()){(enterRoom=new Audio).preload="auto",enterRoom.autoplay=!0,enterRoom.loop=!1,enterRoom.src=lsRepUrl+"/media/msgtone.mp3",enterRoom.play();var e=enterRoom.play();void 0!==e&&e.then(function(){setTimeout(function(){enterRoom&&enterRoom.pause()},1e3)}).catch(function(e){console.log(e)})}}function stopIncomingCall(){if(isIEA)return incomingAudio&&(incomingAudio.pause(),incomingAudio.src=""),!0;if(incomingAudio){var e=incomingAudio.pause();void 0!==e&&e.then(function(){}).catch(function(e){console.log(e)})}}function bytesToSize(e){if(0===e)return"0 Bytes";var n=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,n)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][n]}function hark(e,n){var o=window.webkitAudioContext||window.AudioContext,t=this;if(t.events={},t.on=function(e,n){t.events[e]=n},t.emit=function(){t.events[arguments[0]]&&t.events[arguments[0]](arguments[1],arguments[2],arguments[3],arguments[4])},!o)return t;var i=(n=n||{}).smoothing||.1,r=n.interval||50,a=n.threshold,s=n.play,d=n.history||10,c=!0;window.audioContext00||(window.audioContext00=new o);var l,u,m,g=audioContext00.createGain();g.connect(audioContext00.destination),g.gain.value=0,(m=audioContext00.createAnalyser()).fftSize=512,m.smoothingTimeConstant=i,u=new Float32Array(m.fftSize),l=audioContext00.createMediaStreamSource(e),a=a||-50,l.connect(m),s&&m.connect(audioContext00.destination),t.speaking=!1,t.setThreshold=function(e){a=e},t.setInterval=function(e){r=e},t.stop=function(){c=!1,t.emit("volume_change",-100,a),t.speaking&&(t.speaking=!1,t.emit("stopped_speaking"))},t.speakingHistory=[];for(var f=0;f<d;f++)t.speakingHistory.push(0);var v=function(){setTimeout(function(){if(c){var e=function(e,n){var o=-1/0;e.getFloatFrequencyData(n);for(var t=4,i=n.length;t<i;t++)n[t]>o&&n[t]<0&&(o=n[t]);return o}(m,u);t.emit("volume_change",e,a);var n=0;if(e>a&&!t.speaking){for(var o=t.speakingHistory.length-3;o<t.speakingHistory.length;o++)n+=t.speakingHistory[o];n>=2&&(t.speaking=!0,t.emit("speaking"))}else if(e<a&&t.speaking){for(var i=0;i<t.speakingHistory.length;i++)n+=t.speakingHistory[i];0===n&&(t.speaking=!1,t.emit("stopped_speaking"))}t.speakingHistory.shift(),t.speakingHistory.push(0+(e>a)),v()}},r)};return v(),t}String.prototype.includes||(String.prototype.includes=function(e,n){"use strict";if(e instanceof RegExp)throw TypeError("first argument must not be a RegExp");return void 0===n&&(n=0),-1!==this.indexOf(e,n)});var CryptoJS=CryptoJS||function(e,n){var o={},t=o.lib={},i=function(){},r=t.Base={extend:function(e){i.prototype=this;var n=new i;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=t.WordArray=r.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=null!=n?n:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var n=this.words,o=e.words,t=this.sigBytes;if(e=e.sigBytes,this.clamp(),t%4)for(var i=0;i<e;i++)n[t+i>>>2]|=(o[i>>>2]>>>24-i%4*8&255)<<24-(t+i)%4*8;else if(65535<o.length)for(i=0;i<e;i+=4)n[t+i>>>2]=o[i>>>2];else n.push.apply(n,o);return this.sigBytes+=e,this},clamp:function(){var n=this.words,o=this.sigBytes;n[o>>>2]&=4294967295<<32-o%4*8,n.length=e.ceil(o/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(n){for(var o=[],t=0;t<n;t+=4)o.push(4294967296*e.random()|0);return new a.init(o,n)}}),s=o.enc={},d=s.Hex={stringify:function(e){var n=e.words;e=e.sigBytes;for(var o=[],t=0;t<e;t++){var i=n[t>>>2]>>>24-t%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(e){for(var n=e.length,o=[],t=0;t<n;t+=2)o[t>>>3]|=parseInt(e.substr(t,2),16)<<24-t%8*4;return new a.init(o,n/2)}},c=s.Latin1={stringify:function(e){var n=e.words;e=e.sigBytes;for(var o=[],t=0;t<e;t++)o.push(String.fromCharCode(n[t>>>2]>>>24-t%4*8&255));return o.join("")},parse:function(e){for(var n=e.length,o=[],t=0;t<n;t++)o[t>>>2]|=(255&e.charCodeAt(t))<<24-t%4*8;return new a.init(o,n)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(n){var o=this._data,t=o.words,i=o.sigBytes,r=this.blockSize,s=i/(4*r);if(n=(s=n?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*r,i=e.min(4*n,i),n){for(var d=0;d<n;d+=r)this._doProcessBlock(t,d);d=t.splice(0,n),o.sigBytes-=i}return new a.init(d,i)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});t.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(n,o){return new e.init(o).finalize(n)}},_createHmacHelper:function(e){return function(n,o){return new m.HMAC.init(e,o).finalize(n)}}});var m=o.algo={};return o}(Math);!function(){var e=CryptoJS,n=e.lib.WordArray;e.enc.Base64={stringify:function(e){var n=e.words,o=e.sigBytes,t=this._map;e.clamp(),e=[];for(var i=0;i<o;i+=3)for(var r=(n[i>>>2]>>>24-i%4*8&255)<<16|(n[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|n[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;4>a&&i+.75*a<o;a++)e.push(t.charAt(r>>>6*(3-a)&63));if(n=t.charAt(64))for(;e.length%4;)e.push(n);return e.join("")},parse:function(e){var o=e.length,t=this._map;(i=t.charAt(64))&&(-1!=(i=e.indexOf(i))&&(o=i));for(var i=[],r=0,a=0;a<o;a++)if(a%4){var s=t.indexOf(e.charAt(a-1))<<a%4*2,d=t.indexOf(e.charAt(a))>>>6-a%4*2;i[r>>>2]|=(s|d)<<24-r%4*8,r++}return n.create(i,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function n(e,n,o,t,i,r,a){return((e=e+(n&o|~n&t)+i+a)<<r|e>>>32-r)+n}function o(e,n,o,t,i,r,a){return((e=e+(n&t|o&~t)+i+a)<<r|e>>>32-r)+n}function t(e,n,o,t,i,r,a){return((e=e+(n^o^t)+i+a)<<r|e>>>32-r)+n}function i(e,n,o,t,i,r,a){return((e=e+(o^(n|~t))+i+a)<<r|e>>>32-r)+n}for(var r=CryptoJS,a=(d=r.lib).WordArray,s=d.Hasher,d=r.algo,c=[],l=0;64>l;l++)c[l]=4294967296*e.abs(e.sin(l+1))|0;d=d.MD5=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,r){for(var a=0;16>a;a++){var s=e[d=r+a];e[d]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}a=this._hash.words;var d=e[r+0],l=(s=e[r+1],e[r+2]),u=e[r+3],m=e[r+4],g=e[r+5],f=e[r+6],v=e[r+7],p=e[r+8],h=e[r+9],S=e[r+10],C=e[r+11],w=e[r+12],y=e[r+13],b=e[r+14],_=e[r+15],I=n(I=a[0],A=a[1],E=a[2],k=a[3],d,7,c[0]),k=n(k,I,A,E,s,12,c[1]),E=n(E,k,I,A,l,17,c[2]),A=n(A,E,k,I,u,22,c[3]);I=n(I,A,E,k,m,7,c[4]),k=n(k,I,A,E,g,12,c[5]),E=n(E,k,I,A,f,17,c[6]),A=n(A,E,k,I,v,22,c[7]),I=n(I,A,E,k,p,7,c[8]),k=n(k,I,A,E,h,12,c[9]),E=n(E,k,I,A,S,17,c[10]),A=n(A,E,k,I,C,22,c[11]),I=n(I,A,E,k,w,7,c[12]),k=n(k,I,A,E,y,12,c[13]),E=n(E,k,I,A,b,17,c[14]),I=o(I,A=n(A,E,k,I,_,22,c[15]),E,k,s,5,c[16]),k=o(k,I,A,E,f,9,c[17]),E=o(E,k,I,A,C,14,c[18]),A=o(A,E,k,I,d,20,c[19]),I=o(I,A,E,k,g,5,c[20]),k=o(k,I,A,E,S,9,c[21]),E=o(E,k,I,A,_,14,c[22]),A=o(A,E,k,I,m,20,c[23]),I=o(I,A,E,k,h,5,c[24]),k=o(k,I,A,E,b,9,c[25]),E=o(E,k,I,A,u,14,c[26]),A=o(A,E,k,I,p,20,c[27]),I=o(I,A,E,k,y,5,c[28]),k=o(k,I,A,E,l,9,c[29]),E=o(E,k,I,A,v,14,c[30]),I=t(I,A=o(A,E,k,I,w,20,c[31]),E,k,g,4,c[32]),k=t(k,I,A,E,p,11,c[33]),E=t(E,k,I,A,C,16,c[34]),A=t(A,E,k,I,b,23,c[35]),I=t(I,A,E,k,s,4,c[36]),k=t(k,I,A,E,m,11,c[37]),E=t(E,k,I,A,v,16,c[38]),A=t(A,E,k,I,S,23,c[39]),I=t(I,A,E,k,y,4,c[40]),k=t(k,I,A,E,d,11,c[41]),E=t(E,k,I,A,u,16,c[42]),A=t(A,E,k,I,f,23,c[43]),I=t(I,A,E,k,h,4,c[44]),k=t(k,I,A,E,w,11,c[45]),E=t(E,k,I,A,_,16,c[46]),I=i(I,A=t(A,E,k,I,l,23,c[47]),E,k,d,6,c[48]),k=i(k,I,A,E,v,10,c[49]),E=i(E,k,I,A,b,15,c[50]),A=i(A,E,k,I,g,21,c[51]),I=i(I,A,E,k,w,6,c[52]),k=i(k,I,A,E,u,10,c[53]),E=i(E,k,I,A,S,15,c[54]),A=i(A,E,k,I,s,21,c[55]),I=i(I,A,E,k,p,6,c[56]),k=i(k,I,A,E,_,10,c[57]),E=i(E,k,I,A,f,15,c[58]),A=i(A,E,k,I,y,21,c[59]),I=i(I,A,E,k,m,6,c[60]),k=i(k,I,A,E,C,10,c[61]),E=i(E,k,I,A,l,15,c[62]),A=i(A,E,k,I,h,21,c[63]);a[0]=a[0]+I|0,a[1]=a[1]+A|0,a[2]=a[2]+E|0,a[3]=a[3]+k|0},_doFinalize:function(){var n=this._data,o=n.words,t=8*this._nDataBytes,i=8*n.sigBytes;o[i>>>5]|=128<<24-i%32;var r=e.floor(t/4294967296);for(o[15+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),o[14+(i+64>>>9<<4)]=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8),n.sigBytes=4*(o.length+1),this._process(),o=(n=this._hash).words,t=0;4>t;t++)i=o[t],o[t]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return n},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),r.MD5=s._createHelper(d),r.HmacMD5=s._createHmacHelper(d)}(Math),function(){var e,n=CryptoJS,o=(e=n.lib).Base,t=e.WordArray,i=(e=n.algo).EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,n){for(var o=(s=this.cfg).hasher.create(),i=t.create(),r=i.words,a=s.keySize,s=s.iterations;r.length<a;){d&&o.update(d);var d=o.update(e).finalize(n);o.reset();for(var c=1;c<s;c++)d=o.finalize(d),o.reset();i.concat(d)}return i.sigBytes=4*a,i}});n.EvpKDF=function(e,n,o){return i.create(o).compute(e,n)}}(),CryptoJS.lib.Cipher||function(e){var n=(g=CryptoJS).lib,o=n.Base,t=n.WordArray,i=n.BufferedBlockAlgorithm,r=g.enc.Base64,a=g.algo.EvpKDF,s=n.Cipher=i.extend({cfg:o.extend(),createEncryptor:function(e,n){return this.create(this._ENC_XFORM_MODE,e,n)},createDecryptor:function(e,n){return this.create(this._DEC_XFORM_MODE,e,n)},init:function(e,n,o){this.cfg=this.cfg.extend(o),this._xformMode=e,this._key=n,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(n,o,t){return("string"==typeof o?f:m).encrypt(e,n,o,t)},decrypt:function(n,o,t){return("string"==typeof o?f:m).decrypt(e,n,o,t)}}}});n.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=g.mode={},c=function(e,n,o){var t=this._iv;t?this._iv=void 0:t=this._prevBlock;for(var i=0;i<o;i++)e[n+i]^=t[i]},l=(n.BlockCipherMode=o.extend({createEncryptor:function(e,n){return this.Encryptor.create(e,n)},createDecryptor:function(e,n){return this.Decryptor.create(e,n)},init:function(e,n){this._cipher=e,this._iv=n}})).extend();l.Encryptor=l.extend({processBlock:function(e,n){var o=this._cipher,t=o.blockSize;c.call(this,e,n,t),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+t)}}),l.Decryptor=l.extend({processBlock:function(e,n){var o=this._cipher,t=o.blockSize,i=e.slice(n,n+t);o.decryptBlock(e,n),c.call(this,e,n,t),this._prevBlock=i}}),d=d.CBC=l,l=(g.pad={}).Pkcs7={pad:function(e,n){for(var o,i=(o=(o=4*n)-e.sigBytes%o)<<24|o<<16|o<<8|o,r=[],a=0;a<o;a+=4)r.push(i);o=t.create(r,o),e.concat(o)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},n.BlockCipher=s.extend({cfg:s.cfg.extend({mode:d,padding:l}),reset:function(){s.reset.call(this);var e=(n=this.cfg).iv,n=n.mode;if(this._xformMode==this._ENC_XFORM_MODE)var o=n.createEncryptor;else o=n.createDecryptor,this._minBufferSize=1;this._mode=o.call(n,this,e&&e.words)},_doProcessBlock:function(e,n){this._mode.processBlock(e,n)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var n=this._process(!0)}else n=this._process(!0),e.unpad(n);return n},blockSize:4});var u=n.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),m=(d=(g.format={}).OpenSSL={stringify:function(e){var n=e.ciphertext;return((e=e.salt)?t.create([1398893684,1701076831]).concat(e).concat(n):n).toString(r)},parse:function(e){var n=(e=r.parse(e)).words;if(1398893684==n[0]&&1701076831==n[1]){var o=t.create(n.slice(2,4));n.splice(0,4),e.sigBytes-=16}return u.create({ciphertext:e,salt:o})}},n.SerializableCipher=o.extend({cfg:o.extend({format:d}),encrypt:function(e,n,o,t){t=this.cfg.extend(t);var i=e.createEncryptor(o,t);return n=i.finalize(n),i=i.cfg,u.create({ciphertext:n,key:o,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:t.format})},decrypt:function(e,n,o,t){return t=this.cfg.extend(t),n=this._parse(n,t.format),e.createDecryptor(o,t).finalize(n.ciphertext)},_parse:function(e,n){return"string"==typeof e?n.parse(e,this):e}})),g=(g.kdf={}).OpenSSL={execute:function(e,n,o,i){return i||(i=t.random(8)),e=a.create({keySize:n+o}).compute(e,i),o=t.create(e.words.slice(n),4*o),e.sigBytes=4*n,u.create({key:e,iv:o,salt:i})}},f=n.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:g}),encrypt:function(e,n,o,t){return o=(t=this.cfg.extend(t)).kdf.execute(o,e.keySize,e.ivSize),t.iv=o.iv,(e=m.encrypt.call(this,e,n,o.key,t)).mixIn(o),e},decrypt:function(e,n,o,t){return t=this.cfg.extend(t),n=this._parse(n,t.format),o=t.kdf.execute(o,e.keySize,e.ivSize,n.salt),t.iv=o.iv,m.decrypt.call(this,e,n,o.key,t)}})}(),function(){for(var e=CryptoJS,n=e.lib.BlockCipher,o=e.algo,t=[],i=[],r=[],a=[],s=[],d=[],c=[],l=[],u=[],m=[],g=[],f=0;256>f;f++)g[f]=128>f?f<<1:f<<1^283;var v=0,p=0;for(f=0;256>f;f++){var h=(h=p^p<<1^p<<2^p<<3^p<<4)>>>8^255&h^99;t[v]=h,i[h]=v;var S=g[v],C=g[S],w=g[C],y=257*g[h]^16843008*h;r[v]=y<<24|y>>>8,a[v]=y<<16|y>>>16,s[v]=y<<8|y>>>24,d[v]=y,y=16843009*w^65537*C^257*S^16843008*v,c[h]=y<<24|y>>>8,l[h]=y<<16|y>>>16,u[h]=y<<8|y>>>24,m[h]=y,v?(v=S^g[g[g[w^S]]],p^=g[g[p]]):v=p=1}var b=[0,1,2,4,8,16,32,64,128,27,54];o=o.AES=n.extend({_doReset:function(){for(var e=(o=this._key).words,n=o.sigBytes/4,o=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],r=0;r<o;r++)if(r<n)i[r]=e[r];else{var a=i[r-1];r%n?6<n&&4==r%n&&(a=t[a>>>24]<<24|t[a>>>16&255]<<16|t[a>>>8&255]<<8|t[255&a]):(a=t[(a=a<<8|a>>>24)>>>24]<<24|t[a>>>16&255]<<16|t[a>>>8&255]<<8|t[255&a],a^=b[r/n|0]<<24),i[r]=i[r-n]^a}for(e=this._invKeySchedule=[],n=0;n<o;n++)r=o-n,a=n%4?i[r]:i[r-4],e[n]=4>n||4>=r?a:c[t[a>>>24]]^l[t[a>>>16&255]]^u[t[a>>>8&255]]^m[t[255&a]]},encryptBlock:function(e,n){this._doCryptBlock(e,n,this._keySchedule,r,a,s,d,t)},decryptBlock:function(e,n){var o=e[n+1];e[n+1]=e[n+3],e[n+3]=o,this._doCryptBlock(e,n,this._invKeySchedule,c,l,u,m,i),o=e[n+1],e[n+1]=e[n+3],e[n+3]=o},_doCryptBlock:function(e,n,o,t,i,r,a,s){for(var d=this._nRounds,c=e[n]^o[0],l=e[n+1]^o[1],u=e[n+2]^o[2],m=e[n+3]^o[3],g=4,f=1;f<d;f++){var v=t[c>>>24]^i[l>>>16&255]^r[u>>>8&255]^a[255&m]^o[g++],p=t[l>>>24]^i[u>>>16&255]^r[m>>>8&255]^a[255&c]^o[g++],h=t[u>>>24]^i[m>>>16&255]^r[c>>>8&255]^a[255&l]^o[g++];m=t[m>>>24]^i[c>>>16&255]^r[l>>>8&255]^a[255&u]^o[g++],c=v,l=p,u=h}v=(s[c>>>24]<<24|s[l>>>16&255]<<16|s[u>>>8&255]<<8|s[255&m])^o[g++],p=(s[l>>>24]<<24|s[u>>>16&255]<<16|s[m>>>8&255]<<8|s[255&c])^o[g++],h=(s[u>>>24]<<24|s[m>>>16&255]<<16|s[c>>>8&255]<<8|s[255&l])^o[g++],m=(s[m>>>24]<<24|s[c>>>16&255]<<16|s[l>>>8&255]<<8|s[255&u])^o[g++],e[n]=v,e[n+1]=p,e[n+2]=h,e[n+3]=m},keySize:8});e.AES=n._createHelper(o)}();"use strict";var RTCMultiConnection=function(e,n){var o;function t(e,n){function o(e){return!e.audio&&!e.video&&!e.screen&&e.data}var t="";t+="?userid="+e.userid,t+="&sessionid="+e.sessionid,t+="&msgEvent="+e.socketMessageEvent,t+="&socketCustomEvent="+e.socketCustomEvent,t+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(t+="&oneToMany=true"),t+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(t+="&enableScalableBroadcast=true",t+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),t+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(t+=e.socketCustomParameters);try{io.sockets={}}catch(e){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&("/"==e.socketURL?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",e.socketURL));try{e.socket=io(e.socketURL+t)}catch(n){e.socket=io.connect(e.socketURL+t,e.socketOptions)}var i=e.multiPeersHandler;function r(n,o){e.peersBackup[n]||(e.peersBackup[n]={userid:n,extra:{}}),e.peersBackup[n].extra=o}e.socket.on("extra-data-updated",function(n,o){e.peers[n]&&(e.peers[n].extra=o,e.onExtraDataUpdated({userid:n,extra:o}),r(n,o))}),e.socket.on(e.socketMessageEvent,function n(t){if(t.remoteUserId==e.userid)if(e.peers[t.sender]&&e.peers[t.sender].extra!=t.message.extra&&(e.peers[t.sender].extra=t.extra,e.onExtraDataUpdated({userid:t.sender,extra:t.extra}),r(t.sender,t.extra)),t.message.streamSyncNeeded&&e.peers[t.sender]){var a=e.streamEvents[t.message.streamid];if(!a||!a.stream)return;var s=t.message.action;if("ended"===s||"inactive"===s||"stream-removed"===s)return e.peersBackup[a.userid]&&(a.extra=e.peersBackup[a.userid].extra),void e.onstreamended(a);var d="both"!=t.message.type?t.message.type:null;"function"==typeof a.stream[s]&&a.stream[s](d)}else if("dropPeerConnection"!==t.message){if(t.message.allParticipants)return-1===t.message.allParticipants.indexOf(t.sender)&&t.message.allParticipants.push(t.sender),void t.message.allParticipants.forEach(function(n){i[e.peers[n]?"renegotiatePeer":"createNewPeer"](n,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:o(e.session)})});if(t.message.newParticipant){if(t.message.newParticipant==e.userid)return;if(e.peers[t.message.newParticipant])return;i.createNewPeer(t.message.newParticipant,t.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:o(e.session)})}else if(t.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia))setTimeout(function(){n(t)},1);else if(t.message.newParticipationRequest&&t.sender!==e.userid){e.peers[t.sender]&&e.deletePeer(t.sender);var c={extra:t.extra||{},localPeerSdpConstraints:t.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:t.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==t.message.isOneWay?t.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==t.message.isDataOnly?t.message.isDataOnly:o(e.session),dontGetRemoteStream:void 0!==t.message.isOneWay?t.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!t.message.dontGetRemoteStream,connectionDescription:t,successCallback:function(){}};e.onNewParticipant(t.sender,c)}else{if(t.message.changedUUID&&e.peers[t.message.oldUUID]&&(e.peers[t.message.newUUID]=e.peers[t.message.oldUUID],delete e.peers[t.message.oldUUID]),t.message.userLeft)return i.onUserLeft(t.sender),void(t.message.autoCloseEntireSession&&e.leave());i.addNegotiatedMessage(t.message,t.sender)}}else e.deletePeer(t.sender)});var a=!1;e.socket.resetProps=function(){a=!1},e.socket.on("connect",function(){a||(a=!0,e.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){e.socket.emit("extra-data-updated",e.extra)},1e3),n&&n(e.socket))}),e.socket.on("disconnect",function(n){e.onSocketDisconnect(n)}),e.socket.on("error",function(n){e.onSocketError(n)}),e.socket.on("user-disconnected",function(n){n!==e.userid&&(e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]&&e.peers[n].extra||{}}),e.deletePeer(n))}),e.socket.on("user-connected",function(n){n!==e.userid&&e.onUserStatusChanged({userid:n,status:"online",extra:e.peers[n]&&e.peers[n].extra||{}})}),e.socket.on("closed-entire-session",function(n,o){e.leave(),e.onEntireSessionClosed({sessionid:n,userid:n,extra:o})}),e.socket.on("userid-already-taken",function(n,o){e.onUserIdAlreadyTaken(n,o)}),e.socket.on("logs",function(n){e.enableLogs&&console.debug("server-logs",n)}),e.socket.on("number-of-broadcast-viewers-updated",function(n){e.onNumberOfBroadcastViewersUpdated(n)}),e.socket.on("set-isInitiator-true",function(n){n==e.sessionid&&(e.isInitiator=!0)})}function i(e){var n=this,o=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function t(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(n){e.onFileProgress(n)},e.fbr.onBegin=function(n){e.onFileStart(n)},e.fbr.onEnd=function(n){e.onFileEnd(n)}}e.peers={getLength:function(){var e=0;for(var n in this)-1==o.indexOf(n)&&e++;return e},selectFirst:function(){var e;for(var n in this)-1==o.indexOf(n)&&(e=this[n]);return e},getAllParticipants:function(e){var n=[];for(var t in this)-1==o.indexOf(t)&&t!=e&&n.push(t);return n},forEach:function(n){this.getAllParticipants().forEach(function(o){n(e.peers[o])})},send:function(o,t){var i=this;if(!m(o.size)&&!m(o.type)){if(e.enableFileSharing)return void n.shareFile(o,t);"string"!=typeof o&&(o=JSON.stringify(o))}if("text"===o.type||o instanceof ArrayBuffer||o instanceof DataView){if("text"===o.type&&(o=JSON.stringify(o)),t){var r=e.peers[t];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(o)}):(e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout(function(){i.send(o,t)},3e3))}this.getAllParticipants().forEach(function(n){if(!i[n].channels.length)return e.peers[n].createDataChannel(),e.renegotiate(n),void setTimeout(function(){i[n].channels.forEach(function(e){e.send(o)})},3e3);i[n].channels.forEach(function(e){e.send(o)})})}else M.send({text:o,channel:this,connection:e,remoteUserId:t})}},this.uuid=e.userid,this.getLocalConfig=function(o,i,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:i,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){n.onNegotiationNeeded(e,i)},onLocalCandidate:function(o){(o=E.processCandidates(e,o))&&n.onNegotiationNeeded(o,i)},remoteSdp:o,onDataChannelMessage:function(o){if(!e.fbr&&e.enableFileSharing&&t(),"string"!=typeof o&&e.enableFileSharing){var r=this;o instanceof ArrayBuffer||o instanceof DataView?e.fbr.convertToObject(o,function(e){r.onDataChannelMessage(e)}):o.readyForNextChunk?e.fbr.getNextChunk(o,function(n,o){e.peers[i].channels.forEach(function(e){e.send(n)})},i):o.chunkMissing?e.fbr.chunkMissing(o):e.fbr.addChunk(o,function(n){e.peers[i].peer.channel.send(n)})}else n.onDataChannelMessage(o,i)},onDataChannelError:function(e){n.onDataChannelError(e,i)},onDataChannelOpened:function(e){n.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){n.onDataChannelClosed(e,i)},onRemoteStream:function(o){e.peers[i]&&e.peers[i].streams.push(o),n.onGettingRemoteMedia(o,i)},onRemoteStreamRemoved:function(e){n.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){n.onPeerStateChanged(e),"new"===e.iceConnectionState&&n.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&n.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(n.onUserLeft(i),n.disconnectWith(i))}}},this.createNewPeer=function(n,o){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(o=o||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!o.streamsToShare&&(o.isOneWay=!1,o.isDataOnly=!1,o.session=e.session),!o.isOneWay&&!o.isDataOnly)return o.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:o},n);o=e.setUserPreferences(o,n);var t=this.getLocalConfig(null,n,o);e.peers[n]=new I(t)}},this.createAnsweringPeer=function(n,o,t){t=e.setUserPreferences(t||{},o);var i=this.getLocalConfig(n,o,t);e.peers[o]=new I(i)},this.renegotiatePeer=function(n,o,t){if(e.peers[n]){o||(o={}),o.renegotiatingPeer=!0,o.peerRef=e.peers[n].peer,o.channels=e.peers[n].channels;var i=this.getLocalConfig(t,n,o);e.peers[n]=new I(i)}else console.error("Peer ("+n+") does not exist. Renegotiation skipped.")},this.replaceTrack=function(n,o,t){if(!e.peers[o])throw"This peer ("+o+") does not exist.";var i=e.peers[o].peer;i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?i.getSenders().forEach(function(i){t&&"video"===i.track.kind&&(e.peers[o].peer.lastVideoTrack=i.track,i.replaceTrack(n)),t||"audio"!==i.track.kind||(e.peers[o].peer.lastAudioTrack=i.track,i.replaceTrack(n))}):(console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(o))},this.onNegotiationNeeded=function(e,n){},this.addNegotiatedMessage=function(o,t){if(o.type&&o.sdp)return"answer"==o.type&&e.peers[t]&&e.peers[t].addRemoteSdp(o),"offer"==o.type&&(o.renegotiatingPeer?this.renegotiatePeer(t,null,o):this.createAnsweringPeer(o,t)),void(e.enableLogs&&console.log("Remote peer's sdp:",o.sdp));if(o.candidate)return e.peers[t]&&e.peers[t].addRemoteCandidate(o),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",o.candidate));if(o.enableMedia){e.session=o.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),o.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var i={};e.attachStreams.forEach(function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),o.userPreferences.streamsToShare=i,n.onNegotiationNeeded({readyForOffer:!0,userPreferences:o.userPreferences},t)}o.readyForOffer&&e.onReadyForOffer(t,o.userPreferences)},this.onGettingRemoteMedia=function(e,n){},this.onRemovingRemoteMedia=function(e,n){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(n,o){e.onMediaError(n,o)},this.shareFile=function(n,o){t(),e.fbr.readAsArrayBuffer(n,function(n){var t=e.getAllParticipants();o&&(t=[o]),t.forEach(function(o){e.fbr.getNextChunk(n,function(n){e.peers[o].channels.forEach(function(e){e.send(n)})},o)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var i=new x(e);this.onDataChannelMessage=function(n,o){i.receive(JSON.parse(n),o,e.peers[o]?e.peers[o].extra:{})},this.onDataChannelClosed=function(n,o){n.userid=o,n.extra=e.peers[o]?e.peers[o].extra:{},e.onclose(n)},this.onDataChannelError=function(n,o){n.userid=o,event.extra=e.peers[o]?e.peers[o].extra:{},e.onerror(n)},this.onDataChannelOpened=function(n,o){e.peers[o].channels.length?e.peers[o].channels=[n]:(e.peers[o].channels.push(n),e.onopen({userid:o,extra:e.peers[o]?e.peers[o].extra:{},channel:n}))},this.onPeerStateChanged=function(n){e.onPeerStateChanged(n)},this.onNegotiationStarted=function(e,n){},this.onNegotiationCompleted=function(e,n){},this.getRemoteStreams=function(n){return n=n||e.peers.getAllParticipants()[0],e.peers[n]?e.peers[n].streams:[]}}function r(e,n,o){if("undefined"!=typeof CustomEvent){var t=new CustomEvent(n,{arguments:o,__exposedProps__:o});e.dispatchEvent(t)}}function a(e,n){n.stream&&n.stream&&n.stream.addEventListener&&(n.stream.addEventListener("mute",function(o){(o=e.streamEvents[n.streamid]).session={audio:"audio"===o.muteType,video:"video"===o.muteType},e.onmute(o)},!1),n.stream.addEventListener("unmute",function(o){(o=e.streamEvents[n.streamid]).session={audio:"audio"===o.unmuteType,video:"video"===o.unmuteType},e.onunmute(o)},!1))}function s(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",o=0,t=e.length;o<t;o++)n+=e[o].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function d(e,n,o){if(o.autoCreateMediaElement){var t=!1;v(e,"video").length||e.isVideo||e.isScreen||(t=!0),"Firefox"===DetectRTC.browser.name&&(o.session.video||o.session.screen)&&(t=!1);var i=document.createElement(t?"audio":"video");if(i.srcObject=e,i.setAttribute("autoplay",!0),i.setAttribute("playsinline",!0),i.setAttribute("controls",!0),i.setAttribute("muted",!1),i.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var r="ended";"oninactive"in i&&(r="inactive"),i.addEventListener(r,function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){r="ended","oninactive"in e&&(r="inactive"),T.onSyncNeeded(e.streamid,r),o.attachStreams.forEach(function(n,t){e.streamid===n.streamid&&delete o.attachStreams[t]});var n=[];o.attachStreams.forEach(function(e){e&&n.push(e)}),o.attachStreams=n;var t=o.streamEvents[e.streamid];if(t)return void o.onstreamended(t);this.parentNode&&this.parentNode.removeChild(this)}},!1)}var a=i.play();if(void 0!==a){var s=!1;setTimeout(function(){s||(s=!0,n(i))},1e3),a.then(function(){s||(s=!0,n(i))}).catch(function(e){s||(s=!0,n(i))})}else n(i)}else n({})}function c(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function l(e){var n=[];return e.forEach(function(e){e&&n.push(e)}),n}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function m(e){return void 0===e}(o="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0===global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(o.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=o.addEventListener=o.removeEventListener=function(){},o.HTMLVideoElement=o.HTMLMediaElement=function(){}),"undefined"==typeof io&&(o.io=function(){return{on:function(e,n){n=n||function(){},"connect"===e&&n()},emit:function(e,n,o){o=o||function(){},"open-room"!==e&&"join-room"!==e||o(!0,n.sessionid,null)}}}),"undefined"==typeof location&&(o.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(o.screen={width:0,height:0}),"undefined"==typeof URL&&(o.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),o.window=global),function(){var e="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(h="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var n=process.versions.node.toString().replace("v","");e="Nodejs/"+n+" (NodeOS) AppleWebKit/"+n+" (KHTML, like Gecko) Nodejs/"+n+" Nodejs/"+n}!function(n){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:e,getUserMedia:function(){}},n.window=global),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(n.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var o=window.navigator;void 0!==o?(void 0!==o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),void 0!==o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){},userAgent:e};var t=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(o.userAgent||""),i=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),r=!!window.opera||o.userAgent.indexOf(" OPR/")>=0,a=void 0!==window.InstallTrigger,s=/^((?!chrome|android).)*safari/i.test(o.userAgent),d=!!window.chrome&&!r,c="undefined"!=typeof document&&!!document.documentMode&&!i;function l(e,n){var o=0,t=!1,i=window.setInterval(function(){e()&&(window.clearInterval(i),n(t)),o++>50&&(window.clearInterval(i),n(t=!0))},10)}var u={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return u.Android()||u.BlackBerry()||u.iOS()||u.Opera()||u.Windows()},getOsName:function(){var e="Unknown OS";return u.Android()&&(e="Android"),u.BlackBerry()&&(e="BlackBerry"),u.iOS()&&(e="iOS"),u.Opera()&&(e="Opera Mini"),u.Windows()&&(e="Windows"),e}};var m="Unknown OS",g="Unknown OS Version";var f,v,p=function(){for(var e,n=o.appVersion,t=o.userAgent,i="-",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],a=0;e=r[a];a++)if(e.r.test(t)){i=e.s;break}var s="-";switch(/Windows/.test(i)&&(/Windows (.*)/.test(i)&&(s=/Windows (.*)/.exec(i)[1]),i="Windows"),i){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(t)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(t)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(t)&&(s=/Android ([\.\_\d]+)/.exec(t)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(t)&&(s=(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(n))[1]+"."+s[2]+"."+(0|s[3]))}return{osName:i,osVersion:s}}();p&&p.osName&&"-"!=p.osName?(m=p.osName,g=p.osVersion):u.any()&&"Android"==(m=u.getOsName())&&(g=!!(v=(f=(f||o.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&v[1]);var h="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===m&&h&&(m="Nodejs",g=process.versions.node.toString().replace("v",""));var S=!1,C=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!S&&e in document.createElement("canvas")&&(S=!0),!C&&e in document.createElement("video")&&(C=!0))});var w=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,y=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,b=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;var I=[],k=[],E=[],A=[];o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){var n=o.mediaDevices.enumerateDevices();n&&n.then?o.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])});var R=!1;void 0!==_&&"getSources"in _?R=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(R=!0);var T=!1,x=!1,M=!1,P=!1,O=!1;function V(e){if(R)if(!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices){I=[],k=[],E=[],A=[],T=!1,x=!1,M=!1,P=!1,O=!1;var n={};o.enumerateDevices(function(o){o.forEach(function(e){var o={};for(var t in e)try{"function"!=typeof e[t]&&(o[t]=e[t])}catch(e){}n[o.deviceId+o.label+o.kind]||("audio"===o.kind&&(o.kind="audioinput"),"video"===o.kind&&(o.kind="videoinput"),o.deviceId||(o.deviceId=o.id),o.id||(o.id=o.deviceId),o.label?("videoinput"!==o.kind||O||(O=!0),"audioinput"!==o.kind||P||(P=!0)):(o.isCustomLabel=!0,"videoinput"===o.kind?o.label="Camera "+(A.length+1):"audioinput"===o.kind?o.label="Microphone "+(k.length+1):"audiooutput"===o.kind?o.label="Speaker "+(E.length+1):o.label="Please invoke getUserMedia once.",void 0!==L&&L.browser.isChrome&&L.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(o.label="HTTPs is required to get label of this "+o.kind+" device.")),"audioinput"===o.kind&&(T=!0,-1===k.indexOf(o)&&k.push(o)),"audiooutput"===o.kind&&(x=!0,-1===E.indexOf(o)&&E.push(o)),"videoinput"===o.kind&&(M=!0,-1===A.indexOf(o)&&A.push(o)),I.push(o),n[o.deviceId+o.label+o.kind]=o)}),void 0!==L&&(L.MediaDevices=I,L.hasMicrophone=T,L.hasSpeakers=x,L.hasWebcam=M,L.isWebsiteHasWebcamPermissions=O,L.isWebsiteHasMicrophonePermissions=P,L.audioInputDevices=k,L.audioOutputDevices=E,L.videoInputDevices=A),e&&e()})}else e&&e();else e&&e()}var L=window.DetectRTC||{};L.browser=function(){o.appVersion;var e,n,t,l=o.userAgent,u=o.appName,m=""+parseFloat(o.appVersion),g=parseInt(o.appVersion,10);if(s&&!d&&-1!==l.indexOf("CriOS")&&(s=!1,d=!0),r){u="Opera";try{g=(m=o.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){m="0.0.0.0",g=0}}else c?((n=l.indexOf("rv:"))>0?m=l.substring(n+3):(n=l.indexOf("MSIE"),m=l.substring(n+5)),u="IE"):d?(n=l.indexOf("Chrome"),u="Chrome",m=l.substring(n+7)):s?(n=l.indexOf("Safari"),u="Safari",m=l.substring(n+7),-1!==(n=l.indexOf("Version"))&&(m=l.substring(n+8)),-1!==o.userAgent.indexOf("Version/")&&(m=o.userAgent.split("Version/")[1].split(" ")[0])):a?(n=l.indexOf("Firefox"),u="Firefox",m=l.substring(n+8)):(e=l.lastIndexOf(" ")+1)<(n=l.lastIndexOf("/"))&&(u=l.substring(e,n),m=l.substring(n+1),u.toLowerCase()===u.toUpperCase()&&(u=o.appName));return i&&(u="Edge",m=o.userAgent.split("Edge/")[1]),-1!==(t=m.search(/[; \)]/))&&(m=m.substring(0,t)),g=parseInt(""+m,10),isNaN(g)&&(m=""+parseFloat(o.appVersion),g=parseInt(o.appVersion,10)),{fullVersion:m,version:g,name:u,isPrivateBrowsing:!1}}(),function(e){var n;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){n=!1},function(e){n=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var o;try{(o=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){n=!0}void 0===n&&l(function(){return"done"===o.readyState},function(e){e||(n=!o.result)})}else if(function(e){var n=e.toLowerCase();if(0===n.indexOf("msie")&&0===n.indexOf("trident"))return!1;var o=/(?:msie|rv:)\s?([\d\.]+)/.exec(n);return!!(o&&parseInt(o[1],10)>=10)}(window.navigator.userAgent)){n=!1;try{window.indexedDB||(n=!0)}catch(e){n=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){n=!0}void 0===n&&(n=!1,window.localStorage.removeItem("test"))}}catch(e){n=!1}l(function(){return void 0!==n},function(o){e(n)})}(function(e){L.browser.isPrivateBrowsing=!!e}),L.browser["is"+L.browser.name]=!0,L.osName=m,L.osVersion=g;"object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"];var D=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){D||e in window&&(D=!0)}),L.isWebRTCSupported=D,L.isORTCSupported="undefined"!=typeof RTCIceGatherer;var N=!1;(L.browser.isChrome&&L.browser.version>=35?N=!0:L.browser.isFirefox&&L.browser.version>=34?N=!0:L.browser.isEdge&&L.browser.version>=17?N=!0:"Android"===L.osName&&L.browser.isChrome&&(N=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(L.browser.isChrome||L.browser.isEdge||L.browser.isOpera)?N=!1:L.browser.isFirefox&&(N=!1));L.isScreenCapturingSupported=N;var U={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){U.isSupported||e in window&&(U.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(U.isCreateMediaStreamSourceSupported=!0))}),L.isAudioContextSupported=U.isSupported,L.isCreateMediaStreamSourceSupported=U.isCreateMediaStreamSourceSupported;var B=!1;L.browser.isChrome&&L.browser.version>31&&(B=!0),L.isRtpDataChannelsSupported=B;var j=!1;L.browser.isFirefox&&L.browser.version>28?j=!0:L.browser.isChrome&&L.browser.version>25?j=!0:L.browser.isOpera&&L.browser.version>=11&&(j=!0),L.isSctpDataChannelsSupported=j,L.isMobileDevice=t;var F=!1;o.getUserMedia?F=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(F=!0),L.browser.isChrome&&L.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(F="Requires HTTPs"),"Nodejs"===L.osName&&(F=!1),L.isGetUserMediaSupported=F;var q,Q,W,H="";screen.width&&(H+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));L.displayResolution=H,L.displayAspectRatio=(q=screen.width,Q=screen.height,W=function e(n,o){return 0==o?n:e(o,n%o)}(q,Q),q/W/(Q/W)).toFixed(2),L.isCanvasSupportsStreamCapturing=S,L.isVideoSupportsStreamCapturing=C,"Chrome"==L.browser.name&&L.browser.version>=53&&(L.isCanvasSupportsStreamCapturing||(L.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),L.isVideoSupportsStreamCapturing||(L.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),L.DetectLocalIPAddress=function(e,n){if(L.isWebRTCSupported){var o=!0,t=!0;!function(e,n){if("undefined"==typeof document||"function"!=typeof document.getElementById)return;var o={},t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!t){var i=document.getElementById("iframe");if(!i)return;var r=i.contentWindow;t=r.RTCPeerConnection||r.mozRTCPeerConnection||r.webkitRTCPeerConnection}if(!t)return;var a=null;"Chrome"===L.browser&&L.browser.version<58&&(a={optional:[{RtpDataChannels:!0}]});var s=svConfigs.iceServers,d=new t(s,a);n&&(d.addStream?d.addStream(n):d.addTrack&&n.getTracks()[0]&&d.addTrack(n.getTracks()[0],n));function c(n){if(n){var t=y.exec(n);if(t){var i=t[1],r=n.match(w);void 0===o[i]&&e(i,r,!0),o[i]=!0}}else e()}if(d.onicecandidate=function(e){e.candidate&&e.candidate.candidate?c(e.candidate.candidate):c()},!n)try{d.createDataChannel("sctp",{})}catch(e){}L.isPromisesSupported?d.createOffer().then(function(e){d.setLocalDescription(e).then(l)}):d.createOffer(function(e){d.setLocalDescription(e,l,function(){})},function(){});function l(){d.localDescription.sdp.split("\n").forEach(function(e){e&&0===e.indexOf("a=candidate:")&&c(e)})}}(function(n){n?n.match(w)?e("Local: "+n,o=!1,t):n.match(b)?e("Public: "+n,o,t=!1):e("Public: "+n,o,t):e()},n)}},L.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,L.isWebSocketsBlocked=!L.isWebSocketsSupported,"Nodejs"===L.osName&&(L.isWebSocketsSupported=!0,L.isWebSocketsBlocked=!1),L.checkWebSocketsSupport=function(e){e=e||function(){};try{var n,o=new WebSocket("wss://echo.websocket.org:443/");o.onopen=function(){L.isWebSocketsBlocked=!1,n=(new Date).getTime(),o.send("ping")},o.onmessage=function(){L.WebsocketLatency=(new Date).getTime()-n+"ms",e(),o.close(),o=null},o.onerror=function(){L.isWebSocketsBlocked=!0,e()}}catch(n){L.isWebSocketsBlocked=!0,e()}},L.load=function(e){V(e=e||function(){})},L.MediaDevices=void 0!==I?I:[],L.hasMicrophone=T,L.hasSpeakers=x,L.hasWebcam=M,L.isWebsiteHasWebcamPermissions=O,L.isWebsiteHasMicrophonePermissions=P,L.audioInputDevices=k,L.audioOutputDevices=E,L.videoInputDevices=A;var z=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(z=!0),L.isSetSinkIdSupported=z;var J=!1;L.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(J=!0):L.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(J=!0),L.isRTPSenderReplaceTracksSupported=J;var G=!1;L.browser.isFirefox&&L.browser.version>38&&(G=!0),L.isRemoteStreamProcessingSupported=G;var Y=!1;void 0!==_&&"applyConstraints"in _.prototype&&(Y=!0),L.isApplyConstraintsSupported=Y;var $=!1;L.browser.isFirefox&&L.browser.version>=43&&($=!0),L.isMultiMonitorScreenCapturingSupported=$,L.isPromisesSupported=!!("Promise"in window),L.version="1.3.9",void 0===L&&(window.DetectRTC={});var X=window.MediaStream;void 0===X&&"undefined"!=typeof webkitMediaStream&&(X=webkitMediaStream),L.MediaStream=void 0!==X&&"function"==typeof X&&Object.keys(X.prototype),L.MediaStreamTrack=void 0!==_&&Object.keys(_.prototype);var K=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;L.RTCPeerConnection=void 0!==K&&Object.keys(K.prototype),window.DetectRTC=L,"undefined"!=typeof module&&(module.exports=L),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return L})}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,n,o){e.attachEvent&&e.attachEvent("on"+n,o)}),window.attachEventListener=function(e,n,o,t){e.addEventListener(n,o,t)};var g=window.MediaStream;function f(e,n){return(!e.session.audio||"two-way"!==e.session.audio)&&("Firefox"===DetectRTC.browser.name&&!1!==n||!("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50)&&(!0===typeof n||!(void 0!==n||!e.session.audio||!e.session.screen||e.session.video)&&(n=!0,!0)))}function v(e,n){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(n||"audio")}):[]}function p(){var e=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n=new S;try{n.addTransceiver("audio"),e=!0}catch(e){}n.close()}catch(n){e=!1}return e&&function(){var e=!1;try{var n=new S({sdpSemantics:"unified-plan"});try{var o=n.getConfiguration();e="unified-plan"==o.sdpSemantics||(o.sdpSemantics,!1)}catch(n){e=!1}}catch(n){e=!1}return e}()}function h(){if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}void 0===g&&"undefined"!=typeof webkitMediaStream&&(g=webkitMediaStream),void 0!==g&&("stop"in g.prototype||(g.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",h,!1),h();var S,C={};function w(e){return{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}}void 0!==window.RTCPeerConnection?S=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?S=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(S=webkitRTCPeerConnection);var y=window.RTCSessionDescription||window.mozRTCSessionDescription,b=window.RTCIceCandidate||window.mozRTCIceCandidate,_=window.MediaStreamTrack;function I(e){if(void 0!==window.RTCPeerConnection?S=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?S=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(S=webkitRTCPeerConnection),y=window.RTCSessionDescription||window.mozRTCSessionDescription,b=window.RTCIceCandidate||window.mozRTCIceCandidate,_=window.MediaStreamTrack,!S)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var n=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:n.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){n.addStream(e,o.userid)},this.removeStream=function(e){n.removeStream(e,o.userid)};var o=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var t,i={};C.sdpConstraints=w({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var r=!!e.renegotiatingPeer;e.remoteSdp&&(r=!!e.remoteSdp.renegotiatingPeer);var a=[];if(n.attachStreams.forEach(function(e){e&&a.push(e)}),r)t=e.peerRef;else{var s="all";(n.candidates.turn||n.candidates.relay)&&(n.candidates.stun||n.candidates.reflexive||n.candidates.host||(s="relay"));try{var d={iceServers:n.iceServers,iceTransportPolicy:n.iceTransportPolicy||s};void 0!==n.iceCandidatePoolSize&&(d.iceCandidatePoolSize=n.iceCandidatePoolSize),void 0!==n.bundlePolicy&&(d.bundlePolicy=n.bundlePolicy),void 0!==n.rtcpMuxPolicy&&(d.rtcpMuxPolicy=n.rtcpMuxPolicy),n.sdpSemantics&&(d.sdpSemantics=n.sdpSemantics||"unified-plan"),n.iceServers&&n.iceServers.length||(d=null,n.optionalArgument=null),t=new S(d,n.optionalArgument)}catch(e){try{d={iceServers:n.iceServers};t=new S(d)}catch(e){t=new S}}}!t.getRemoteStreams&&t.getReceivers&&(t.getRemoteStreams=function(){var e=new g;return t.getReceivers().forEach(function(n){e.addTrack(n.track)}),[e]}),!t.getLocalStreams&&t.getSenders&&(t.getLocalStreams=function(){var e=new g;return t.getSenders().forEach(function(n){e.addTrack(n.track)}),[e]}),t.onicecandidate=function(i){if(i.candidate)n.trickleIce&&e.onLocalCandidate({candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex});else if(!n.trickleIce){var r=t.localDescription;e.onLocalSdp({type:r.type,sdp:r.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:o.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:n?n.extra:{},streamsToShare:p})}},a.forEach(function(i){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(i=n.beforeAddingStream(i,o))&&(t.getLocalStreams().forEach(function(e){i&&e.id==i.id&&(i=null)}),i&&i.getTracks&&i.getTracks().forEach(function(e){try{t.addTrack(e,i)}catch(e){}}))}),t.oniceconnectionstatechange=t.onsignalingstatechange=function(){var i=o.extra;n.peers[o.userid]&&(i=n.peers[o.userid].extra||i),t&&(e.onPeerStateChanged({iceConnectionState:t.iceConnectionState,iceGatheringState:t.iceGatheringState,signalingState:t.signalingState,extra:i,userid:o.userid}),t&&t.iceConnectionState&&-1!==t.iceConnectionState.search(/closed|failed/gi)&&o.streams instanceof Array&&o.streams.forEach(function(e){var o=n.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};n.onstreamended(o)}))};var c={OfferToReceiveAudio:!!a.length,OfferToReceiveVideo:!!a.length};e.localPeerSdpConstraints&&(c=e.localPeerSdpConstraints),C.sdpConstraints=w(c);var l={};t.ontrack=function(n){if(n&&"track"===n.type)if(n.stream=n.streams[n.streams.length-1],n.stream.id||(n.stream.id=n.track.id),l[n.stream.id]&&"Safari"!==DetectRTC.browser.name)n.track&&(n.track.onended=function(){t&&t.onremovestream(n)});else{l[n.stream.id]=n.stream.id;var o={};e.remoteSdp&&e.remoteSdp.streamsToShare?o=e.remoteSdp.streamsToShare:e.streamsToShare&&(o=e.streamsToShare);var r=o[n.stream.id];r?(n.stream.isAudio=r.isAudio,n.stream.isVideo=r.isVideo,n.stream.isScreen=r.isScreen):(n.stream.isVideo=!!v(n.stream,"video").length,n.stream.isAudio=!n.stream.isVideo,n.stream.isScreen=!1),n.stream.streamid=n.stream.id,i[n.stream.id]=n.stream,e.onRemoteStream(n.stream),n.stream.getTracks().forEach(function(e){e.onended=function(){t&&t.onremovestream(n)}}),n.stream.onremovetrack=function(){t&&t.onremovestream(n)}}},t.onremovestream=function(n){n.stream.streamid=n.stream.id,i[n.stream.id]&&delete i[n.stream.id],e.onRemoteStreamRemoved(n.stream)},"function"!=typeof t.removeStream&&(t.removeStream=function(e){e.getTracks().forEach(function(n){t.removeTrack(n,e)})});var u=!0;this.addRemoteCandidate=function(e){t.addIceCandidate(new b(e)),isEdge&&u&&(u=!1,setTimeout(function(){t.addIceCandidate(null)},3e3))},this.addRemoteSdp=function(e,o){o=o||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=n.processSdp(e.sdp)),t.setRemoteDescription(new y(e)).then(o,function(n){console.error("setRemoteDescription failed","\n",n,"\n",e.sdp),o()}).catch(function(n){console.error("setRemoteDescription failed","\n",n,"\n",e.sdp),o()})};var m=!0;function f(n){n.binaryType="arraybuffer",n.onmessage=function(n){e.onDataChannelMessage(n.data)},n.onopen=function(){e.onDataChannelOpened(n)},n.onerror=function(n){e.onDataChannelError(n)},n.onclose=function(n){e.onDataChannelClosed(n)},n.internalSend=n.send,n.send=function(e){"open"===n.readyState&&n.internalSend(e)},t.channel=n}e.remoteSdp&&(m=!1),this.createDataChannel=function(){f(t.createDataChannel("sctp",{}))},!0!==n.session.data||r||(m?this.createDataChannel():t.ondatachannel=function(e){f(e.channel)}),this.enableDisableVideoEncoding=function(e){var n;if(t.getSenders().forEach(function(e){n||"video"!==e.track.kind||(n=e)}),n&&n.getParameters){var o=n.getParameters();o.encodings[1]&&(o.encodings[1].active=!!e),o.encodings[2]&&(o.encodings[2].active=!!e),n.setParameters(o)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(c=e.remoteSdp.remotePeerSdpConstraints),C.sdpConstraints=w(c),this.addRemoteSdp(e.remoteSdp,function(){h("createAnswer")})),"two-way"!=n.session.audio&&"two-way"!=n.session.video&&"two-way"!=n.session.screen||(C.sdpConstraints=w({OfferToReceiveAudio:"two-way"==n.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==n.session.video||"two-way"==n.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var p={};function h(i){t[i](C.sdpConstraints).then(function(i){"Safari"!==DetectRTC.browser.name&&(i.sdp=n.processSdp(i.sdp)),t.setLocalDescription(i).then(function(){n.trickleIce&&(e.onLocalSdp({type:i.type,sdp:i.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:o.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:n?n.extra:{},streamsToShare:p}),n.onSettingLocalDescription(o))},function(e){console.error("setLocalDescription error",e)})},function(e){console.error("sdp-error",e)})}t.getLocalStreams().forEach(function(e){p[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),m&&h("createOffer"),t.nativeClose=t.close,t.close=function(){if(t){try{t.nativeClose!==t.close&&t.nativeClose()}catch(e){}t=null,o.peer=null}},this.peer=t}var k=function(){function e(e,t){var i=o(e);return i.videoCodecNumbers?"vp8"===t&&i.vp8LineNumber===i.videoCodecNumbers[0]?e:"vp9"===t&&i.vp9LineNumber===i.videoCodecNumbers[0]?e:"h264"===t&&i.h264LineNumber===i.videoCodecNumbers[0]?e:e=n(e,t,i):e}function n(e,n,o,t){var i="";if("vp8"===n){if(!o.vp8LineNumber)return e;i=o.vp8LineNumber}if("vp9"===n){if(!o.vp9LineNumber)return e;i=o.vp9LineNumber}if("h264"===n){if(!o.h264LineNumber)return e;i=o.h264LineNumber}var r=o.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",a=[i];return t&&(a=[]),o.videoCodecNumbers.forEach(function(e){e!==i&&a.push(e)}),r+=a.join(" "),e=e.replace(o.videoCodecNumbersOriginal,r)}function o(e){var n={};return e.split("\n").forEach(function(e){0===e.indexOf("m=video")&&(n.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach(function(o){(o=o.trim())&&o.length&&(n.videoCodecNumbers.push(o),n.videoCodecNumbersOriginal=e)})),-1===e.indexOf("VP8/90000")||n.vp8LineNumber||(n.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||n.vp9LineNumber||(n.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||n.h264LineNumber||(n.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])}),n}function t(e,n,o){return function(e,n,o,t,i){for(var r=-1!==o?o:e.length,a=n;a<r;++a)if(0===e[a].indexOf(t)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a;return null}(e,0,-1,n,o)}function i(e){var n=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),o=e.match(n);return o&&2===o.length?o[1]:null}return{removeVPX:function(e){var t=o(e);return e=n(e,"vp9",t,!0),e=n(e,"vp8",t,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,n){if(n&&n.getSenders&&n.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";n.getSenders().forEach(function(n){for(var o=n.getParameters(),t=0;t<o.codecs.length;t++)if(o.codecs[t].mimeType==e){o.codecs.unshift(o.codecs.splice(t,1));break}n.setParameters(o)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,n,o){return function(e,n,o){return n?void 0!==isFirefox&&isFirefox?e:(o&&(n.screen?n.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&o&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n"):n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.video+"\r\n")),e):e}(e,n,o)},setVideoBitrates:function(e,n){return function(e,n){var o,r=(n=n||{}).min,a=n.max,s=e.split("\r\n"),d=t(s,"a=rtpmap","VP8/90000");if(d&&(o=i(s[d])),!o)return e;var c,l=t(s,"a=rtpmap","rtx/90000");if(l&&(c=i(s[l])),!l)return e;var u=t(s,"a=fmtp:"+c.toString());if(null!==u){var m="\r\n";m+="a=fmtp:"+o+" x-google-min-bitrate="+(r||"228")+"; x-google-max-bitrate="+(a||"228"),s[u]=s[u].concat(m),e=s.join("\r\n")}return e}(e,n)},setOpusAttributes:function(e,n){return function(e,n){n=n||{};var o,r=e.split("\r\n"),a=t(r,"a=rtpmap","opus/48000");if(a&&(o=i(r[a])),!o)return e;var s=t(r,"a=fmtp:"+o.toString());if(null===s)return e;var d="";return d+="; stereo="+(void 0!==n.stereo?n.stereo:"1"),d+="; sprop-stereo="+(void 0!==n["sprop-stereo"]?n["sprop-stereo"]:"1"),void 0!==n.maxaveragebitrate&&(d+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),void 0!==n.maxplaybackrate&&(d+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),void 0!==n.cbr&&(d+="; cbr="+(void 0!==n.cbr?n.cbr:"1")),void 0!==n.useinbandfec&&(d+="; useinbandfec="+n.useinbandfec),void 0!==n.usedtx&&(d+="; usedtx="+n.usedtx),void 0!==n.maxptime&&(d+="\r\na=maxptime:"+n.maxptime),r[s]=r[s].concat(d),e=r.join("\r\n")}(e,n)},preferVP9:function(n){return e(n,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var n=e.split("\r\n"),o=null,t=0;t<n.length;t++)if(-1!==n[t].search("opus/48000")){var i=extractSdp(n[t],/:(\d+) opus\/48000/i);break}for(t=0;t<n.length;t++){if(-1!==n[t].search("a=fmtp"))if(extractSdp(n[t],/a=fmtp:(\d+)/)===i){o=t;break}}return null===o?e:(n[o]=n[o].concat("; stereo=1; sprop-stereo=1"),e=n.join("\r\n"))}}}();window.BandwidthHandler=k;var E={processCandidates:function(e,n){var o=n.candidate,t=e.candidates,i=t.stun,r=t.turn;if(m(t.reflexive)||(i=t.reflexive),m(t.relay)||(r=t.relay),(t.host||!o.match(/typ host/g))&&(r||!o.match(/typ relay/g))&&(i||!o.match(/typ srflx/g))){var a=e.iceProtocols;if((a.udp||!o.match(/ udp /g))&&(a.tcp||!o.match(/ tcp /g)))return e.enableLogs&&console.debug("Your candidate pairs:",o),{candidate:o,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}}}},A={getIceServers:function(e){var n={stringify:function(e){var n={ct:e.ciphertext.toString(CryptoJS.enc.Base64)};return e.iv&&(n.iv=e.iv.toString()),e.salt&&(n.s=e.salt.toString()),JSON.stringify(n)},parse:function(e){var n=JSON.parse(e),o=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Base64.parse(n.ct)});return n.iv&&(o.iv=CryptoJS.enc.Hex.parse(n.iv)),n.s&&(o.salt=CryptoJS.enc.Hex.parse(n.s)),o}};if(svConfigs.iceServers.requirePass){for(var o=svConfigs.iceServers.iceServers,t=0;t<o.length;t++){if(o[t].username){var i='{"ct":"'+o[t].username+'","iv":"09644439296d0d45c81236b5643e9662","s":"3132333435363738"}',r=JSON.parse(CryptoJS.AES.decrypt(i,svConfigs.iceServers.passPhrase,{format:n}).toString(CryptoJS.enc.Utf8));o[t].username=r}if(o[t].credential){i='{"ct":"'+o[t].credential+'","iv":"09644439296d0d45c81236b5643e9662","s":"3132333435363738"}';var a=JSON.parse(CryptoJS.AES.decrypt(i,svConfigs.iceServers.passPhrase,{format:n}).toString(CryptoJS.enc.Utf8));o[t].credential=a}}svConfigs.iceServers.iceServers=o,svConfigs.iceServers.requirePass=!1}return"r.html"===window.location.pathname.split("/").pop()&&(i='{"ct":"'+svConfigs.iceServers.turnon+'","iv":"09644439296d0d45c81236b5643e9662","s":"3132333435363738"}',CryptoJS.AES.decrypt(i,"aeNbaecqgc",{format:n}).toString(CryptoJS.enc.Utf8)||(svConfigs.iceServers.iceServers=!1)),svConfigs.iceServers.iceServers}};function R(e){if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var n=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[n])r(currentUserMediaRequest.streams[n].stream,!0);else{if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=n,r(e)},function(n){e.onLocalMediaError(n,e.localMediaConstraints)});if(void 0===navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var o,t,i=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),o=stream},function(e){i(e),t=e}),{then:function(e){if(!o)return e,{then:function(e){t?e(t):i=e}};e(o)}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=n,r(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)});else{if(!navigator.getDisplayMedia)throw new Error("getDisplayMedia API is not availabe in this browser.");navigator.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=n,r(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=n,r(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}}else currentUserMediaRequest.queueRequests.push(e);function r(o,t){!function(e,n){e.mandatory&&e.mandatory.chromeMediaSource?n.isScreen=!0:e.mozMediaSource||e.mediaSource?n.isScreen=!0:e.video?n.isVideo=!0:e.audio&&(n.isAudio=!0)}(e.localMediaConstraints,o);var i="ended";"oninactive"in o&&(i="inactive"),o.addEventListener(i,function(){delete currentUserMediaRequest.streams[n],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=l(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[n]={stream:o},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&R(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(o,t)}}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var n=this.streams[e];if(n){var o=(n=n.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(o)&&(delete this.queueRequests[this.queueRequests.indexOf(o)],this.queueRequests=l(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var T=function(){function e(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}return{setHandlers:function(n,o,t){if(n&&n.addEventListener){if(void 0===o||1==o){var i="ended";"oninactive"in n&&(i="inactive"),n.addEventListener(i,function(){T.onSyncNeeded(this.streamid,i)},!1)}n.mute=function(i,a){i=e(i),void 0!==a&&(o=a),void 0!==i&&"audio"!=i||v(n,"audio").forEach(function(e){e.enabled=!1,t.streamEvents[n.streamid].isAudioMuted=!0}),void 0!==i&&"video"!=i||v(n,"video").forEach(function(e){e.enabled=!1}),void 0!==o&&1!=o||T.onSyncNeeded(n.streamid,"mute",i),t.streamEvents[n.streamid].muteType=i||"both",r(n,"mute",i)},n.unmute=function(i,a){i=e(i),void 0!==a&&(o=a),function(){if(!t.streamEvents[n.streamid].mediaElement)return;var e=t.streamEvents[n.streamid].mediaElement;e.volume=0,function e(n,o,t,i){i=(i||0)+1;if(i>=o)return;setTimeout(function(){t(),e(n,o,t,i)},n)}(200,5,function(){try{e.volume+=.2}catch(n){e.volume=1}})}(),void 0!==i&&"audio"!=i||v(n,"audio").forEach(function(e){e.enabled=!0,t.streamEvents[n.streamid].isAudioMuted=!1}),void 0!==i&&"video"!=i||(v(n,"video").forEach(function(e){e.enabled=!0}),void 0!==i&&"video"==i&&t.streamEvents[n.streamid].isAudioMuted&&function e(o){o||(o=0),++o<100&&t.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout(function(){e(o)},50))}()),void 0!==o&&1!=o||T.onSyncNeeded(n.streamid,"unmute",i),t.streamEvents[n.streamid].unmuteType=i||"both",r(n,"unmute",i)}}},onSyncNeeded:function(e,n,o){}}}();function x(e){var n={};return{receive:function(o,t,i){var r=o.uuid;if(n[r]||(n[r]=[]),n[r].push(o.message),o.last){var a=n[r].join("");o.isobject&&(a=JSON.parse(a));var s={data:a,userid:t,extra:i,latency:(new Date).getTime()-o.sendingTime};e.autoTranslateText?(s.original=s.data,e.Translator.TranslateText(s.data,function(n){s.data=n,e.onmessage(s)})):e.onmessage(s),delete n[r]}}}}var M={send:function(e){var n=e.connection,o=e.channel,t=e.remoteUserId,i=e.text,r=n.chunkSize||1e3,a="",d=!1;"string"!=typeof i&&(d=!0,i=JSON.stringify(i));var c=s(),l=(new Date).getTime();!function e(i,s){var u={type:"text",uuid:c,sendingTime:l};i&&(s=i,u.packets=parseInt(s.length/r));s.length>r?u.message=s.slice(0,r):(u.message=s,u.last=!0,u.isobject=d);o.send(u,t);a=s.slice(u.message.length);a.length&&setTimeout(function(){e(null,a)},n.chunkInterval||100)}(i)}},P={handle:function(e){var n={};e.onFileStart=function(o){var t=document.createElement("div");if(t.title=o.name,t.innerHTML="<label>0%</label> <progress></progress>",o.remoteUserId&&(t.innerHTML+=" (Sharing with:"+o.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(t,e.filesContainer.firstChild),!o.remoteUserId)return n[o.uuid]={div:t,progress:t.querySelector("progress"),label:t.querySelector("label")},void(n[o.uuid].progress.max=o.maxChunks);n[o.uuid]||(n[o.uuid]={}),n[o.uuid][o.remoteUserId]={div:t,progress:t.querySelector("progress"),label:t.querySelector("label")},n[o.uuid][o.remoteUserId].progress.max=o.maxChunks},e.onFileProgress=function(e){var o=n[e.uuid];o&&(e.remoteUserId&&!(o=n[e.uuid][e.remoteUserId])||(o.progress.value=e.currentPosition||e.maxChunks||o.progress.max,function(e,n){if(-1!==e.position){var o=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=o+"%"}}(o.progress,o.label)))},e.onFileEnd=function(e){var o=n[e.uuid];if(o){if(!e.remoteUserId||(o=n[e.uuid][e.remoteUserId])){var t=o.div;-1!=e.type.indexOf("image")?t.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':t.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}else console.error("No such progress-helper element exist.",e)}}},O={handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(n,o){var t=document.createElement("script");t.type="text/javascript";var i=encodeURIComponent(n),r="method"+e.token();window[r]=function(e){e.data&&e.data.translations[0]&&o?o(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):e.error?console.error(e.error.message):console.error(e)};var a="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+i;t.src=a,document.getElementsByTagName("head")[0].appendChild(t)},getListOfLanguages:function(n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE){var e=JSON.parse(o.responseText);if(e&&e.data&&e.data.languages)return void n(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error('Text translation failed. Error message: "Daily Limit Exceeded."');if(e.error)return void console.error(e.error.message);console.error(e)}};var t="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";o.open("GET",t,!0),o.send(null)}}}};!function(o){n=n||{useDefaultDevices:!0},o.channel=o.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var r=new i(o),l={};function m(e){if(o.socketAutoReConnect=!0,o.socket)e&&e(o.socket);else{if(void 0===t)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new t(o,function(n){e&&e(o.socket)})}}function h(e,n){o.socket.emit("join-room",{sessionid:o.sessionid,session:o.session,mediaConstraints:o.mediaConstraints,sdpConstraints:o.sdpConstraints,streams:w(),extra:o.extra,password:void 0!==o.password&&"object"!=typeof o.password?o.password:""},function(t,i){if(!0===t){if(o.enableLogs&&console.log("isRoomJoined: ",t," roomid: ",o.sessionid),o.peers[o.sessionid])return;r.onNegotiationNeeded(e)}!1===t&&o.enableLogs&&console.warn("isRoomJoined: ",i," roomid: ",o.sessionid),n(t,o.sessionid,i)})}function C(e){o.enableLogs&&console.log("Sending open-room signal to socket.io"),o.waitingForLocalMedia=!1,o.socket.emit("open-room",{sessionid:o.sessionid,session:o.session,mediaConstraints:o.mediaConstraints,sdpConstraints:o.sdpConstraints,streams:w(),extra:o.extra,identifier:o.publicRoomIdentifier,password:void 0!==o.password&&"object"!=typeof o.password?o.password:""},function(n,t){!0===n&&(o.enableLogs&&console.log("isRoomOpened: ",n," roomid: ",o.sessionid),e(n,o.sessionid)),!1===n&&(o.enableLogs&&console.warn("isRoomOpened: ",t," roomid: ",o.sessionid),e(n,o.sessionid,t))})}function w(){try{return o.streamEvents.selectAll("local").map(function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}})}catch(e){return[]}}function y(e,n){if(o.dontCaptureUserMedia||e.isDataOnly)n();else{var t={};e.localPeerSdpConstraints.OfferToReceiveAudio&&(t.audio=o.mediaConstraints.audio),e.localPeerSdpConstraints.OfferToReceiveVideo&&(t.video=o.mediaConstraints.video);var i=e.session||o.session;i.oneway&&"two-way"!==i.audio&&"two-way"!==i.video&&"two-way"!==i.screen?n():(i.oneway&&i.audio&&"two-way"===i.audio&&(i={audio:!0}),(i.audio||i.video||i.screen)&&(i.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(o)}).then(function(e){e.isScreen=!0,r.onGettingLocalMedia(e),!i.audio&&!i.video||f(o)?n(e):o.invokeGetUserMedia(null,n)},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):o.invokeGetUserMedia({audio:f(o),video:!0,isScreen:!0},!i.audio&&!i.video||f(o)?n:o.invokeGetUserMedia(null,n)):(i.audio||i.video)&&o.invokeGetUserMedia(null,n,i)))}}function b(e,n){e?(n.audio&&v(e,"audio").forEach(function(e){e.applyConstraints(n.audio)}),n.video&&v(e,"video").forEach(function(e){e.applyConstraints(n.video)})):o.enableLogs&&console.error("No stream to applyConstraints.")}function I(e,n,t){n?r.replaceTrack(e,n,t):o.peers.getAllParticipants().forEach(function(n){r.replaceTrack(e,n,t)})}r.onGettingLocalMedia=function(e,n){if(n=n||function(){},l[e.streamid])n();else{l[e.streamid]=!0;try{e.type="local"}catch(e){}o.setStreamEndHandler(e),d(e,function(t){t.id=e.streamid,t.muted=!0,t.volume=0,-1===o.attachStreams.indexOf(e)&&o.attachStreams.push(e),void 0!==T&&T.setHandlers(e,!0,o),o.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:t,userid:o.userid,extra:o.extra,streamid:e.streamid,isAudioMuted:!0};try{!function(e,n){if(n.stream&&v(n.stream,"audio").length){if(!e||!n)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if(void 0===hark)throw"hark.js not found.";hark(n.stream,{onspeaking:function(){e.onspeaking(n)},onsilence:function(){e.onsilence(n)},onvolumechange:function(o,t){e.onvolumechange&&e.onvolumechange(merge({volume:o,threshold:t},n))}})}}}(o,o.streamEvents[e.streamid]),a(o,o.streamEvents[e.streamid]),o.onstream(o.streamEvents[e.streamid])}catch(e){}n()},o)}},r.onGettingRemoteMedia=function(e,n){try{e.type="remote"}catch(e){}o.setStreamEndHandler(e,"remote-stream"),d(e,function(t){t.id=e.streamid,void 0!==T&&T.setHandlers(e,!1,o),o.streamEvents[e.streamid]={stream:e,type:"remote",userid:n,extra:o.peers[n]?o.peers[n].extra:{},mediaElement:t,streamid:e.streamid},a(o,o.streamEvents[e.streamid]),o.onstream(o.streamEvents[e.streamid])},o)},r.onRemovingRemoteMedia=function(e,n){var t=o.streamEvents[e.streamid];t||(t={stream:e,type:"remote",userid:n,extra:o.peers[n]?o.peers[n].extra:{},streamid:e.streamid,mediaElement:o.streamEvents[e.streamid]?o.streamEvents[e.streamid].mediaElement:null}),o.peersBackup[t.userid]&&(t.extra=o.peersBackup[t.userid].extra),o.onstreamended(t),delete o.streamEvents[e.streamid]},r.onNegotiationNeeded=function(e,n,t){t=t||function(){};var i={remoteUserId:n=n||e.remoteUserId,message:e=e||"",sender:o.userid};e.remoteUserId&&e.message&&e.sender&&(i=e),m(function(){o.socket.emit(o.socketMessageEvent,i,t)})},r.onUserLeft=function(e){o.deletePeer(e)},r.disconnectWith=function(e,n){o.socket&&o.socket.emit("disconnect-with",e,n||function(){}),o.deletePeer(e)},o.socketOptions={transport:"polling"},o.openOrJoin=function(e,n){n=n||function(){},o.checkPresence(e,function(e,t){if(e){o.sessionid=t;var i,r,a=!!o.session.oneway,s=u(o.session);r={OfferToReceiveAudio:o.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o.sdpConstraints.mandatory.OfferToReceiveVideo},i={OfferToReceiveAudio:a?!!o.session.audio:o.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a?!!o.session.video||!!o.session.screen:o.sdpConstraints.mandatory.OfferToReceiveVideo};var d={remoteUserId:o.sessionid,message:{newParticipationRequest:!0,isOneWay:a,isDataOnly:s,localPeerSdpConstraints:i,remotePeerSdpConstraints:r},sender:o.userid};y(d.message,function(){h(d,n)})}else o.waitingForLocalMedia=!0,o.isInitiator=!0,o.sessionid=t||o.sessionid,u(o.session)?C(n):o.captureUserMedia(function(){C(n)})})},o.waitingForLocalMedia=!1,o.open=function(e,n){n=n||function(){},o.waitingForLocalMedia=!0,o.isInitiator=!0,o.sessionid=e||o.sessionid,m(function(){u(o.session)?C(n):o.captureUserMedia(function(){C(n)})})},o.peersBackup={},o.deletePeer=function(e){if(e&&o.peers[e]){var n={userid:e,extra:o.peers[e]?o.peers[e].extra:{}};if(o.peersBackup[n.userid]&&(n.extra=o.peersBackup[n.userid].extra),o.onleave(n),o.peers[e]){o.peers[e].streams.forEach(function(e){e.stop()});var t=o.peers[e].peer;if(t&&"closed"!==t.iceConnectionState)try{t.close()}catch(e){}o.peers[e]&&(o.peers[e].peer=null,delete o.peers[e])}}},o.rejoin=function(e){if(!o.isInitiator&&e&&Object.keys(e).length){var n={};o.peers[e.remoteUserId]&&(n=o.peers[e.remoteUserId].extra,o.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(o.join(e.remoteUserId),o.onReConnecting({userid:e.remoteUserId,extra:n}))}},o.join=function(e,n){o.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||o.sessionid,o.sessionid+="";var t=!1,i=!1,r=!1,a=!1;if(e&&e.session||!e||"string"==typeof e){var s=e&&e.session||o.session;r=!!s.oneway,a=u(s),i={OfferToReceiveAudio:o.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o.sdpConstraints.mandatory.OfferToReceiveVideo},t={OfferToReceiveAudio:r?!!o.session.audio:o.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!o.session.video||!!o.session.screen:o.sdpConstraints.mandatory.OfferToReceiveVideo}}var d=function(){};"function"==typeof(n=n||{})&&(d=n,n={}),void 0!==n.localPeerSdpConstraints&&(t=n.localPeerSdpConstraints),void 0!==n.remotePeerSdpConstraints&&(i=n.remotePeerSdpConstraints),void 0!==n.isOneWay&&(r=n.isOneWay),void 0!==n.isDataOnly&&(a=n.isDataOnly);var c={remoteUserId:o.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:a,localPeerSdpConstraints:t,remotePeerSdpConstraints:i},sender:o.userid};return y(c.message,function(){m(function(){h(c,d)})}),c},o.publicRoomIdentifier="",o.getUserMedia=o.captureUserMedia=function(e,n){e=e||function(){};var t=n||o.session;o.dontCaptureUserMedia||u(t)?e():(t.audio||t.video||t.screen)&&(t.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(o)}).then(function(i){if(i.isScreen=!0,r.onGettingLocalMedia(i),!t.audio&&!t.video||f(o))e(i);else{var a={};for(var s in t)"screen"!==s&&(a[s]=t[s]);o.invokeGetUserMedia(n,e,a)}},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):o.invokeGetUserMedia({audio:f(o),video:!0,isScreen:!0},function(i){if(!t.audio&&!t.video||f(o))e(i);else{var r={};for(var a in t)"screen"!==a&&(r[a]=t[a]);o.invokeGetUserMedia(n,e,r)}}):(t.audio||t.video)&&o.invokeGetUserMedia(n,e,t))},o.onbeforeunload=function(e,n){o.closeBeforeUnload&&(o.peers.getAllParticipants().forEach(function(e){r.onNegotiationNeeded({userLeft:!0},e),o.peers[e]&&o.peers[e].peer&&o.peers[e].peer.close(),delete o.peers[e]}),n||o.closeSocket(),o.isInitiator=!1)},window.ignoreBeforeUnload?o.closeBeforeUnload=!1:(o.closeBeforeUnload=!0,window.addEventListener("beforeunload",o.onbeforeunload,!1)),o.userid=s(),o.changeUserId=function(e,n){n=n||function(){},o.userid=e||s(),o.socket.emit("changed-uuid",o.userid,n)},o.extra={},o.attachStreams=[],o.session={audio:!0,video:!0},o.enableFileSharing=!1,o.bandwidth={screen:!1,audio:!1,video:!1},o.codecs={audio:"opus",video:"VP9"},o.processSdp=function(e){return p()?e:"Safari"===DetectRTC.browser.name?e:("VP8"===o.codecs.video.toUpperCase()&&(e=k.preferCodec(e,"vp8")),"VP9"===o.codecs.video.toUpperCase()&&(e=k.preferCodec(e,"vp9")),"H264"===o.codecs.video.toUpperCase()&&(e=k.preferCodec(e,"h264")),"G722"===o.codecs.audio&&(e=k.removeNonG722(e)),"Firefox"===DetectRTC.browser.name?e:((o.bandwidth.video||o.bandwidth.screen)&&(e=k.setApplicationSpecificBandwidth(e,o.bandwidth,!!o.session.screen)),o.bandwidth.video&&(e=k.setVideoBitrates(e,{min:8*o.bandwidth.video*1024,max:8*o.bandwidth.video*1024})),o.bandwidth.audio&&(e=k.setOpusAttributes(e,{maxaveragebitrate:8*o.bandwidth.audio*1024,maxplaybackrate:8*o.bandwidth.audio*1024,stereo:1,maxptime:3})),e))},void 0!==k&&(o.BandwidthHandler=o.CodecsHandler=k),o.mediaConstraints={audio:{mandatory:{},optional:o.bandwidth.audio?[{bandwidth:8*o.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:o.bandwidth.video?[{bandwidth:8*o.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(o.mediaConstraints={audio:!0,video:!0}),n.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){var e,n;if(DetectRTC.MediaDevices.forEach(function(t){"audioinput"===t.kind&&!1!==o.mediaConstraints.audio&&(e=t),"videoinput"===t.kind&&!1!==o.mediaConstraints.video&&(n=t)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==o.mediaConstraints.audio?o.mediaConstraints.audio.deviceId=e.id:o.mediaConstraints.audio={deviceId:e.id});1==o.mediaConstraints.audio&&(o.mediaConstraints.audio={mandatory:{},optional:[]}),o.mediaConstraints.audio.optional||(o.mediaConstraints.audio.optional=[]);var t=[{sourceId:e.id}];o.mediaConstraints.audio.optional=t.concat(o.mediaConstraints.audio.optional)}if(n){if("Firefox"===DetectRTC.browser.name)return void(!0!==o.mediaConstraints.video?o.mediaConstraints.video.deviceId=n.id:o.mediaConstraints.video={deviceId:n.id});1==o.mediaConstraints.video&&(o.mediaConstraints.video={mandatory:{},optional:[]}),o.mediaConstraints.video.optional||(o.mediaConstraints.video.optional=[]);t=[{sourceId:n.id}];o.mediaConstraints.video.optional=t.concat(o.mediaConstraints.video.optional)}}),o.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},o.sdpSemantics=null,o.iceCandidatePoolSize=null,o.bundlePolicy=null,o.rtcpMuxPolicy=null,o.iceTransportPolicy=null,o.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},o.iceServers=A.getIceServers(o),o.candidates={host:!0,stun:!0,turn:!0},o.iceProtocols={tcp:!0,udp:!0},o.onopen=function(e){o.enableLogs&&console.info("Data connection has been opened between you & ",e.userid)},o.onclose=function(e){o.enableLogs&&console.warn("Data connection has been closed between you & ",e.userid)},o.onerror=function(e){o.enableLogs&&console.error(e.userid,"data-error",e)},o.onmessage=function(e){o.enableLogs&&console.debug("data-message",e.userid,e.data)},o.send=function(e,n){o.peers.send(e,n)},o.close=o.disconnect=o.leave=function(){o.onbeforeunload(!1,!0)},o.closeEntireSession=function(e){e=e||function(){},o.socket.emit("close-entire-session",function n(){o.getAllParticipants().length?setTimeout(n,100):(o.onEntireSessionClosed({sessionid:o.sessionid,userid:o.userid,extra:o.extra}),o.changeUserId(null,function(){o.close(),e()}))})},o.onEntireSessionClosed=function(e){o.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},o.onstream=function(e){var n=o.videosContainer;n.insertBefore(e.mediaElement,n.firstChild);var t=e.mediaElement.play();void 0===t?setTimeout(function(){e.mediaElement.play()},2e3):t.catch(function(){}).then(function(){setTimeout(function(){e.mediaElement.play()},2e3)})},o.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},o.direction="many-to-many",o.removeStream=function(e,n){var t;o.attachStreams.forEach(function(n){n.id===e&&(t=n)}),t?(o.peers.getAllParticipants().forEach(function(e){if(!n||e===n){var i=o.peers[e];try{i.peer.removeStream(t)}catch(e){}}}),o.renegotiate()):console.warn("No such stream exist.",e)},o.addStream=function(e,n){if(e.getTracks)return-1===o.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),o.attachStreams.push(e)),void o.renegotiate(n);function t(t){e.streamCallback&&e.streamCallback(t),o.renegotiate(n)}u(e)?o.renegotiate(n):(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(o)}).then(function(n){n.isScreen=!0,r.onGettingLocalMedia(n),!e.audio&&!e.video||f(o)?t(n):o.invokeGetUserMedia(null,function(e){t(e)})},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):o.invokeGetUserMedia({audio:f(o),video:!0,isScreen:!0},function(n){!e.audio&&!e.video||f(o)?t(n):o.invokeGetUserMedia(null,function(e){t(e)})}):(e.audio||e.video)&&o.invokeGetUserMedia(null,t))},o.invokeGetUserMedia=function(e,n,t){t||(t=o.session),e||(e=o.mediaConstraints),R({onGettingLocalMedia:function(o){var t=e.video;t&&(t.mediaSource||t.mozMediaSource?o.isScreen=!0:t.mandatory&&t.mandatory.chromeMediaSource&&(o.isScreen=!0)),o.isScreen||(o.isVideo=!!v(o,"video").length,o.isAudio=!o.isVideo&&v(o,"audio").length),r.onGettingLocalMedia(o,function(){"function"==typeof n&&n(o)})},onLocalMediaError:function(e,n){r.onLocalMediaError(e,n)},localMediaConstraints:e||{audio:!!t.audio&&e.audio,video:!!t.video&&e.video}})},o.applyConstraints=function(e,n){if(_&&_.prototype.applyConstraints){var t;if(n)return o.streamEvents[n]&&(t=o.streamEvents[n].stream),void b(t,e);o.attachStreams.forEach(function(n){b(n,e)})}else alert("track.applyConstraints is NOT supported in your browser.")},o.replaceTrack=function(e,n,t){if(e=e||{},S.prototype.getSenders)if(e instanceof _)I(e,n,t);else{if(e instanceof g)return v(e,"video").length&&I(v(e,"video")[0],n,!0),void(v(e,"audio").length&&I(v(e,"audio")[0],n,!1));if(u(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(o)}).then(function(n){n.isScreen=!0,r.onGettingLocalMedia(n),!e.audio&&!e.video||f(o)?i(n):o.invokeGetUserMedia(null,i)},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):o.invokeGetUserMedia({audio:f(o),video:!0,isScreen:!0},!e.audio&&!e.video||f(o)?i:o.invokeGetUserMedia(null,i)):(e.audio||e.video)&&o.invokeGetUserMedia(null,i))}else o.addStream(e);function i(i){o.replaceTrack(i,n,t||e.video||e.screen)}},o.resetTrack=function(e,n){e||(e=o.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var t=o.peers[e].peer;void 0!==n&&!0!==n||!t.lastVideoTrack||o.replaceTrack(t.lastVideoTrack,e,!0),void 0!==n&&!1!==n||!t.lastAudioTrack||o.replaceTrack(t.lastAudioTrack,e,!1)})},o.renegotiate=function(e){e?r.renegotiatePeer(e):o.peers.getAllParticipants().forEach(function(e){r.renegotiatePeer(e)})},o.setStreamEndHandler=function(e,n){if(e&&e.addEventListener&&(n=!!n,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var t="ended";"oninactive"in e&&(t="inactive"),e.addEventListener(t,function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!n){var t=[];o.attachStreams.forEach(function(n){n.id!=e.id&&t.push(n)}),o.attachStreams=t}var i=o.streamEvents[e.streamid];if(i||(i={stream:e,streamid:e.streamid,type:n?"remote":"local",userid:o.userid,extra:o.extra,mediaElement:o.streamEvents[e.streamid]?o.streamEvents[e.streamid].mediaElement:null}),n&&o.peers[i.userid]){var r=o.peers[i.userid].peer;t=[];r.getRemoteStreams().forEach(function(n){n.id!=e.id&&t.push(n)}),o.peers[i.userid].streams=t}i.userid===o.userid&&"remote"===i.type||(o.peersBackup[i.userid]&&(i.extra=o.peersBackup[i.userid].extra),o.onstreamended(i),delete o.streamEvents[e.streamid])},!1)}},o.onMediaError=function(e,n){o.enableLogs&&console.error(e,n)},o.autoCloseEntireSession=!1,o.filesContainer=o.videosContainer=document.body||document.documentElement,o.isInitiator=!1,o.shareFile=r.shareFile,void 0!==P&&P.handle(o),void 0!==O&&O.handle(o),o.token=s,o.onNewParticipant=function(e,n){o.acceptParticipationRequest(e,n)},o.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),r.createNewPeer(e,n)},void 0!==T&&(o.StreamsHandler=T),o.onleave=function(e){},o.invokeSelectFileDialog=function(e){var n=new FileSelector;n.accept="*.*",n.selectSingleFile(e)},o.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var n=e.mediaElement.pause();void 0!==n?n.then(function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},o.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},o.onExtraDataUpdated=function(e){e.status="online",o.onUserStatusChanged(e,!0)},o.getAllParticipants=function(e){return o.peers.getAllParticipants(e)},void 0!==T&&(T.onSyncNeeded=function(e,n,t){o.peers.getAllParticipants().forEach(function(o){r.onNegotiationNeeded({streamid:e,action:n,streamSyncNeeded:!0,type:t||"both"},o)})}),o.connectSocket=function(e){m(e)},o.closeSocket=function(){try{io.sockets={}}catch(e){}o.socket&&("function"==typeof o.socket.disconnect&&o.socket.disconnect(),"function"==typeof o.socket.resetProps&&o.socket.resetProps(),o.socket=null)},o.getSocket=function(e){return!e&&o.enableLogs&&console.warn("getSocket.callback paramter is required."),e=e||function(){},o.socket?e(o.socket):m(function(){e(o.socket)}),o.socket},o.getRemoteStreams=r.getRemoteStreams;var E=["selectFirst","selectAll","forEach"];if(o.streamEvents={selectFirst:function(e){return o.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var n=[];return Object.keys(o.streamEvents).forEach(function(t){var i=o.streamEvents[t];if(-1===E.indexOf(t)){var r=!0;e.local&&"local"===i.type&&(r=!1),e.remote&&"remote"===i.type&&(r=!1),e.isScreen&&i.stream.isScreen&&(r=!1),e.isVideo&&i.stream.isVideo&&(r=!1),e.isAudio&&i.stream.isAudio&&(r=!1),e.userid&&i.userid===e.userid&&(r=!1),!1===r&&n.push(i)}}),n}},o.socketURL="/",o.socketMessageEvent="RTCMultiConnection-Message",o.socketCustomEvent="RTCMultiConnection-Custom-Message",o.DetectRTC=DetectRTC,o.setCustomSocketEvent=function(e){e&&(o.socketCustomEvent=e),o.socket&&o.socket.emit("set-custom-socket-event-listener",o.socketCustomEvent)},o.getNumberOfBroadcastViewers=function(e,n){o.socket&&e&&n&&o.socket.emit("get-number-of-users-in-specific-broadcast",e,n)},o.onNumberOfBroadcastViewersUpdated=function(e){o.enableLogs&&o.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},o.onUserStatusChanged=function(e,n){o.enableLogs&&!n&&console.info(e.userid,e.status)},o.getUserMediaHandler=R,o.multiPeersHandler=r,o.enableLogs=!0,o.setCustomSocketHandler=function(e){void 0!==t&&(t=e)},o.chunkSize=4e4,o.maxParticipantsAllowed=1e3,o.disconnectWith=r.disconnectWith,o.checkPresence=function(e,n){e=e||o.sessionid,"SSEConnection"!==t.name?o.socket?o.socket.emit("check-presence",e+"",function(e,t,i){o.enableLogs&&console.log("checkPresence.isRoomExist: ",e," roomid: ",t),n(e,t,i)}):o.connectSocket(function(){o.checkPresence(e,n)}):SSEConnection.checkPresence(e,function(e,t,i){if(!o.socket)return e||(o.userid=t),void o.connectSocket(function(){n(e,t,i)});n(e,t)})},o.onReadyForOffer=function(e,n){o.multiPeersHandler.createNewPeer(e,n)},o.setUserPreferences=function(e){return o.dontAttachStream&&(e.dontAttachLocalStream=!0),o.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},o.updateExtraData=function(){o.socket.emit("extra-data-updated",o.extra)},o.enableScalableBroadcast=!1,o.maxRelayLimitPerUser=3,o.dontCaptureUserMedia=!1,o.dontAttachStream=!1,o.dontGetRemoteStream=!1,o.onReConnecting=function(e){o.enableLogs&&console.info("ReConnecting with",e.userid,"...")},o.beforeAddingStream=function(e){return e},o.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(o.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(o.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(o.getChromeExtensionStatus=getChromeExtensionStatus),o.modifyScreenConstraints=function(e){return e},o.onPeerStateChanged=function(e){o.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},o.isOnline=!0,c("online",function(){o.isOnline=!0}),c("offline",function(){o.isOnline=!1}),o.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(o.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),o.isLowBandwidth)){if(o.bandwidth={audio:!1,video:!1,screen:!1},o.mediaConstraints.audio&&o.mediaConstraints.audio.optional&&o.mediaConstraints.audio.optional.length){var x=[];o.mediaConstraints.audio.optional.forEach(function(e){void 0===e.bandwidth&&x.push(e)}),o.mediaConstraints.audio.optional=x}if(o.mediaConstraints.video&&o.mediaConstraints.video.optional&&o.mediaConstraints.video.optional.length){x=[];o.mediaConstraints.video.optional.forEach(function(e){void 0===e.bandwidth&&x.push(e)}),o.mediaConstraints.video.optional=x}}o.getExtraData=function(e,n){if(!e)throw"remoteUserId is required.";if("function"!=typeof n)return o.peers[e]?o.peers[e].extra:o.peersBackup[e]?o.peersBackup[e].extra:{};o.socket.emit("get-remote-user-extra-data",e,function(e,o,t){n(e,o,t)})},n.autoOpenOrJoin&&o.openOrJoin(o.sessionid),o.onUserIdAlreadyTaken=function(e,n){o.close(),o.closeSocket(),o.isInitiator=!1,o.userid=o.token(),o.join(o.sessionid),o.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",o.userid)},o.trickleIce=!0,o.version="3.6.9",o.onSettingLocalDescription=function(e){o.enableLogs&&console.info("Set local description for remote user",e.userid)},o.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},o.autoCreateMediaElement=!0,o.password=null,o.setPassword=function(e,n){n=n||function(){},o.socket?o.socket.emit("set-password",e,n):(o.password=e,n(!0,o.sessionid,null))},o.onSocketDisconnect=function(e){o.enableLogs&&console.warn("socket.io connection is closed")},o.onSocketError=function(e){o.enableLogs&&console.warn("socket.io connection is failed")},o.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}}(this)};"undefined"!=typeof module&&(module.exports=exports=RTCMultiConnection),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],function(){return RTCMultiConnection}),function(){function e(){function e(e,n){n=n||function(e){postMessage(e)};var o=e.file;o.uuid||(o.uuid=(100*Math.random()).toString().replace(/\./g,""));var t=e.chunkSize||15e3;e.extra&&e.extra.chunkSize&&(t=e.extra.chunkSize);var i,r=0,a=t,s=Math.floor(Math.min(1e8,a)/t)*t,d=Math.ceil(o.size/t);o.maxChunks=d;var c=0,l=[];n({currentPosition:c,uuid:o.uuid,maxChunks:d,size:o.size,name:o.name,type:o.type,lastModifiedDate:(o.lastModifiedDate||new Date).toString(),start:!0});var u,m=new FileReader;m.onloadend=function(e){e.target.readyState==FileReader.DONE&&function(e,r,a){i=Math.ceil(r.byteLength/t);for(var s=0;s<i;s++){var u=s*t;l[c]=r.slice(u,Math.min(u+t,r.byteLength)),n({uuid:o.uuid,buffer:l[c],currentPosition:c,maxChunks:d,size:o.size,name:o.name,lastModifiedDate:(o.lastModifiedDate||new Date).toString(),type:o.type}),c++}c==d&&!0;a()}(o.name,e.target.result,function(){(++r+1)*s<o.size?(u=o.slice(r*s,(r+1)*s),m.readAsArrayBuffer(u)):r*s<o.size?(u=o.slice(r*s,o.size),m.readAsArrayBuffer(u)):(o.url=URL.createObjectURL(o),n({currentPosition:c,uuid:o.uuid,maxChunks:d,size:o.size,name:o.name,lastModifiedDate:(o.lastModifiedDate||new Date).toString(),url:URL.createObjectURL(o),type:o.type,end:!0}))})},c+=1,u=o.slice(r*s,(r+1)*s),m.readAsArrayBuffer(u)}this.readAsArrayBuffer=function(n,o){var t=o.earlyCallback;function i(e){n.chunks[e.uuid]||(n.chunks[e.uuid]={currentPosition:-1}),o.extra=o.extra||{userid:0},e.userid=o.userid||o.extra.userid||0,e.extra=o.extra,n.chunks[e.uuid][e.currentPosition]=e,e.end&&t&&(t(e.uuid),t=null),e.maxChunks>200&&200==e.currentPosition&&t&&(t(e.uuid),t=null)}delete o.earlyCallback,e(o,i)}}function n(e){var n=this;n.chunks={},n.chunksWaiters={},n.receive=function o(t,i){if(t.uuid){if(t.start&&!n.chunks[t.uuid]&&(n.chunks[t.uuid]={},e.onBegin&&e.onBegin(t)),!t.end&&t.buffer&&(n.chunks[t.uuid][t.currentPosition]=t.buffer),t.end){var r=n.chunks[t.uuid],a=[];Object.keys(r).forEach(function(e,n){a.push(r[e])});var s=new Blob(a,{type:t.type});(s=function(e,n){if(e||(e={}),!n)return e;for(var o in n)try{e[o]=n[o]}catch(e){}return e}(s,t)).url=URL.createObjectURL(s),s.uuid=t.uuid,s.size||console.error("Something went wrong. Blob Size is 0."),e.onEnd&&e.onEnd(s),delete n.chunks[t.uuid],delete n.chunksWaiters[t.uuid]}t.buffer&&e.onProgress&&e.onProgress(t),t.end||(i(t),n.chunksWaiters[t.uuid]=function(){setTimeout(function e(){t.buffer&&n.chunks[t.uuid]&&(t.currentPosition==t.maxChunks||n.chunks[t.uuid][t.currentPosition]||(i(t),setTimeout(e,5e3)))},5e3)},n.chunksWaiters[t.uuid]())}else e.convertToObject(t,function(e){o(e)})}}var o={ConvertToArrayBuffer:function(e,n){g.pack(e,function(e){n(e.buffer)})},ConvertToObject:function(e,n){g.unpack(e,n)}};var t=Uint8Array.BYTES_PER_ELEMENT,i=Uint16Array.BYTES_PER_ELEMENT,r=Uint32Array.BYTES_PER_ELEMENT,a={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17},s=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],d=function(e){var n=0,o=0,d=0,c=new ArrayBuffer(e[0].byte_length+e[0].header_size),l=new DataView(c);for(o=0;o<e.length;o++){e[o].header_size;var u=e[o].type,m=e[o].length,g=e[o].value,f=e[o].byte_length,v=s[u],p=null===v?0:window[v+"Array"].BYTES_PER_ELEMENT;switch(u===a.BUFFER?l.setUint8(n,a.BLOB,!1):l.setUint8(n,u,!1),n+=t,u!==a.ARRAY&&u!==a.OBJECT||(l.setUint16(n,m,!1),n+=i),l.setUint32(n,f,!1),n+=r,u){case a.NULL:case a.UNDEFINED:break;case a.STRING:for(d=0;d<m;d++,n+=p)l.setUint16(n,g.charCodeAt(d),!1);break;case a.NUMBER:case a.BOOLEAN:0,l["set"+v](n,g,!1),n+=p;break;case a.INT8ARRAY:case a.INT16ARRAY:case a.INT32ARRAY:case a.UINT8ARRAY:case a.UINT16ARRAY:case a.UINT32ARRAY:case a.FLOAT32ARRAY:case a.FLOAT64ARRAY:new Uint8Array(l.buffer,n,f).set(new Uint8Array(g.buffer)),n+=f;break;case a.ARRAYBUFFER:case a.BUFFER:new Uint8Array(l.buffer,n,f).set(new Uint8Array(g)),n+=f;break;case a.BLOB:case a.ARRAY:case a.OBJECT:break;default:throw"TypeError: Unexpected type found."}0}return l},c=function(e,n){var o,d,l,u,m,g=0;o=e.getUint8(n,!1),n+=t,o!==a.ARRAY&&o!==a.OBJECT||(d=e.getUint16(n,!1),n+=i),l=e.getUint32(n,!1),n+=r;var f=s[o],v=null===f?0:window[f+"Array"].BYTES_PER_ELEMENT;switch(o){case a.NULL:case a.UNDEFINED:0,u=null;break;case a.STRING:d=l/v;var p=[];for(g=0;g<d;g++){var h=e.getUint16(n,!1);n+=v,p.push(String.fromCharCode(h))}u=p.join("");break;case a.NUMBER:u=e.getFloat64(n,!1),n+=v;break;case a.BOOLEAN:u=1===e.getUint8(n,!1),n+=v;break;case a.INT8ARRAY:case a.INT16ARRAY:case a.INT32ARRAY:case a.UINT8ARRAY:case a.UINT16ARRAY:case a.UINT32ARRAY:case a.FLOAT32ARRAY:case a.FLOAT64ARRAY:case a.ARRAYBUFFER:m=e.buffer.slice(n,n+l),n+=l,u=o===a.ARRAYBUFFER?m:new window[f+"Array"](m);break;case a.BLOB:if(window.Blob){var S=c(e,n),C=c(e,S.cursor);n=C.cursor,u=new Blob([C.value],{type:S.value})}else m=e.buffer.slice(n,n+l),n+=l,u=new Buffer(m);break;case a.ARRAY:for(u=[],g=0;g<d;g++)n=(m=c(e,n)).cursor,u.push(m.value);break;case a.OBJECT:for(u={},g=0;g<d;g++){var w=c(e,n),y=c(e,w.cursor);n=y.cursor,u[w.value]=y.value}break;default:throw"TypeError: Type not supported."}return{value:u,cursor:n}},l=function(e,n){for(var o=e.length,t=[],i=0,r=0,a=0;a<e.length;a++)!function(a){u(e[a],function(e){if(t[a]=e,r+=e[0].header_size+e[0].byte_length,++i===o){for(var s=[],d=0;d<t.length;d++)s=s.concat(t[d]);n(s,r)}})}(a)},u=function(e,n){var o,d,c=t+r,u=0,m=0,g=e;switch(d=function(e){var n=void 0;if(void 0===e)n=a.UNDEFINED;else if(null===e)n=a.NULL;else{var o=e.constructor.name,t=e.constructor.toString().match(/\w+/g)[1];if(void 0!==o&&void 0!==a[o.toUpperCase()])n=a[o.toUpperCase()];else if(void 0!==t&&void 0!==a[t.toUpperCase()])n=a[t.toUpperCase()];else switch(typeof e){case"string":n=a.STRING;break;case"number":n=a.NUMBER;break;case"boolean":n=a.BOOLEAN;break;case"object":e instanceof Array?n=a.ARRAY:e instanceof Int8Array?n=a.INT8ARRAY:e instanceof Int16Array?n=a.INT16ARRAY:e instanceof Int32Array?n=a.INT32ARRAY:e instanceof Uint8Array?n=a.UINT8ARRAY:e instanceof Uint16Array?n=a.UINT16ARRAY:e instanceof Uint32Array?n=a.UINT32ARRAY:e instanceof Float32Array?n=a.FLOAT32ARRAY:e instanceof Float64Array?n=a.FLOAT64ARRAY:e instanceof ArrayBuffer?n=a.ARRAYBUFFER:e instanceof Blob?n=a.BLOB:e instanceof Buffer?n=a.BUFFER:e instanceof Object&&(n=a.OBJECT)}}return n}(e),o=null==s[d]?0:window[s[d]+"Array"].BYTES_PER_ELEMENT,d){case a.UNDEFINED:case a.NULL:break;case a.NUMBER:case a.BOOLEAN:u=o;break;case a.STRING:u+=(m=e.length)*o;break;case a.INT8ARRAY:case a.INT16ARRAY:case a.INT32ARRAY:case a.UINT8ARRAY:case a.UINT16ARRAY:case a.UINT32ARRAY:case a.FLOAT32ARRAY:case a.FLOAT64ARRAY:u+=(m=e.length)*o;break;case a.ARRAY:return void l(e,function(o,t){n([{type:d,length:e.length,header_size:c+i,byte_length:t,value:null}].concat(o))});case a.OBJECT:var f=[];for(var v in e)e.hasOwnProperty(v)&&(f.push(v),f.push(e[v]),m++);return void l(f,function(e,o){n([{type:d,length:m,header_size:c+i,byte_length:o,value:null}].concat(e))});case a.ARRAYBUFFER:u+=e.byteLength;break;case a.BLOB:var p=e.type,h=new FileReader;return h.onload=function(e){l([p,e.target.result],function(e,o){n([{type:d,length:m,header_size:c,byte_length:o,value:null}].concat(e))})},h.onerror=function(e){throw"FileReader Error: "+e},void h.readAsArrayBuffer(e);case a.BUFFER:u+=e.length;break;default:throw'TypeError: Type "'+e.constructor.name+'" not supported.'}n([{type:d,length:m,header_size:c,byte_length:u,value:g}].concat([]))},m=function(e,n){var o=e instanceof DataView?e:new DataView(e);return c(o,0).value};var g={pack:function(e,n){try{0,u(e,function(e){n(d(e))})}catch(e){throw e}},unpack:function(e,n){try{0;var o=m(e);0,n(o)}catch(e){throw e}}};window.FileConverter=o,window.FileSelector=function(){var e=this,n=function(){};function o(o,t,i){o=o||function(){};var r=document.createElement("input");r.type="file",t&&(r.multiple=!0),i&&(r.webkitdirectory=!0),r.accept=e.accept,r.onclick=function(){r.clickStarted=!0},document.body.onfocus=function(){setTimeout(function(){r.clickStarted&&(r.clickStarted=!1,r.value||n())},500)},r.onchange=function(){if(t){if(!r.files.length)return void console.error("No file selected.");var e=[];return Array.from(r.files).forEach(function(n){n.url=n.webkitRelativePath,e.push(n)}),void o(e)}r.files[0]?(o(r.files[0]),r.parentNode.removeChild(r)):console.error("No file selected.")},r.style.display="none",(document.body||document.documentElement).appendChild(r),function(e){if("function"==typeof e.click)return void e.click();if("function"==typeof e.change)return void e.change();if(void 0!==document.createEvent("Event")){if("function"==typeof(n=document.createEvent("Event")).initEvent&&"function"==typeof e.dispatchEvent)return n.initEvent("click",!0,!0),void e.dispatchEvent(n)}var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(n)}(r)}e.selectSingleFile=function(e,t){t&&(n=t),o(e)},e.selectMultipleFiles=function(e,t){t&&(n=t),o(e,!0)},e.selectDirectory=function(e,t){t&&(n=t),o(e,!0,!0)},e.accept="*.*"},window.FileBufferReader=function(){var t=this,i=new e;t.chunks={},t.users={},t.readAsArrayBuffer=function(e,n,o){var r={file:e,earlyCallback:function(e){n(a(e,{currentPosition:-1}))},extra:o||{userid:0}};e.extra&&Object.keys(e.extra).length&&Object.keys(e.extra).forEach(function(n){r.extra[n]=e.extra[n]}),i.readAsArrayBuffer(t,r)},t.getNextChunk=function(e,n,o){var i;void 0!==e.currentPosition&&(i=e.currentPosition,e=e.uuid);var r=t.chunks[e];if(r){void 0!==o?(t.users[o+""]||(t.users[o+""]={fileUUID:e,userid:o,currentPosition:-1}),void 0!==i&&(t.users[o+""].currentPosition=i),t.users[o+""].currentPosition++,i=t.users[o+""].currentPosition):(void 0!==i&&(t.chunks[e].currentPosition=i),t.chunks[e].currentPosition++,i=t.chunks[e].currentPosition);var s=r[i];if(!s)return delete t.chunks[e],void t.convertToArrayBuffer({chunkMissing:!0,currentPosition:i,uuid:e},n);s=a(s),void 0!==o&&(s.remoteUserId=o+""),s.start&&t.onBegin(s),s.end&&t.onEnd(s),t.onProgress(s),t.convertToArrayBuffer(s,function(e){s.currentPosition!=s.maxChunks?n(e,!1):n(e,!0)})}};var r=new n(t);function a(e,n){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var o in n=n||new e.constructor,e)n[o]=void 0===n[o]?a(e[o],null):n[o];return n}t.addChunk=function(e,n){e&&r.receive(e,function(e){t.convertToArrayBuffer({readyForNextChunk:!0,currentPosition:e.currentPosition,uuid:e.uuid},n)})},t.chunkMissing=function(e){delete r.chunks[e.uuid],delete r.chunksWaiters[e.uuid]},t.onBegin=function(){},t.onEnd=function(){},t.onProgress=function(){},t.convertToObject=o.ConvertToObject,t.convertToArrayBuffer=o.ConvertToArrayBuffer,t.setMultipleUsers=function(){}}}();var publicRoomIdentifier,connection,videoConnection,screenConnection,tenant,role,sessionId,sessionForChat,roomId,socket,streamConstraints,recentFile,conversationPanel,tempStream,lsDesigner,conferenceStyle,classVideo,videoElementContainer,videoWidgetContainer,roomLinkPage,facingMode,iphoneLocalStream,localVideoStream,caller_name,caller_phone,caller_avatar,caller_email,peer_name,peer_phone,peer_avatar,peer_logo,peer_background,peer_email,lsRepUrl,ui_handler,notify_handler,jQEngager,pluginInstalled,pluginController,comm_controller,visitors,queryString,videoDevices,multiStreamRecorder,agentId,recordScreen,recordCamera,recordingTimer,videoDefault,videoCurrent,audioSource,videoSource,testAudioTrack,testVideoTrack,videoSelect,audioInputSelect,audioOutputSelect,sourceBuffer,passRoom,agentAvatar,visitorName,agentName,datetime,duration,token,room,disableVideo,disableAudio,disableScreenShare,disableWhiteboard,disableTransfer,autoAcceptVideo,autoAcceptAudio,translator,roomPrd,forceClose=!1,autoReconnectInterval=5e3,popupNotifications=[],repeatStatInterval=2e3,visitorRinging=[],requirePassComm=!1,RMCMediaTrack={cameraStream:null,cameraTrack:null,screen:null},comController=function(){var e=this;this.init=function(o,t){requirePassComm=void 0!==passRoom&&passRoom,roomId=t,role=o,sessionId=getCookie("sessionId")&&"admin"!==getCookie("sessionId")?getCookie("sessionId"):getGuid(),queryString.s&&(sessionId=queryString.s);var i="admin"===role?"a":"";if(sessionForChat=getCookie("sessionForChat")?getCookie("sessionForChat"):sessionId+i,"admin"===role&&(sessionId="admin"),queryString.isAdmin&&(sessionId+="a"),facingMode=svConfigs.videoScreen.primaryCamera?svConfigs.videoScreen.primaryCamera:"user",setCookie("sessionId",sessionId,1),setCookie("sessionForChat",sessionForChat,1),window.enableAdapter=!0,publicRoomIdentifier="dashboard",tenant="dashboard",(connection=new RTCMultiConnection).enableLogs=!!svConfigs.videoScreen.enableLogs&&svConfigs.videoScreen.enableLogs,connection.iceServers=svConfigs.iceServers.iceServers,connection.socketURL=svConfigs.appWss,connection.autoCreateMediaElement=!1,conferenceStyle=svConfigs.videoScreen&&"conference"===svConfigs.videoScreen.videoContainerStyle?"conference":"simple",classVideo="conference"===conferenceStyle?"sourcevideo":"bigvideo",videoElementContainer="conference"===conferenceStyle?"video_container_small":"video_container",videoWidgetContainer="conference"===conferenceStyle?"w.html":"widget.html",roomLinkPage="conference"==conferenceStyle?"r.html":"room.html",connection.publicRoomIdentifier=publicRoomIdentifier,connection.onbeforeunload=function(){},connection.session={audio:!1,video:!1,data:!0},connection.processSdp=function(e){return e},void 0!==names)var r=names[sessionId]?names[sessionId].name:guestName(sessionId);else r=guestName(sessionId);try{var a=localStorage.getItem("prd")?JSON.parse(localStorage.getItem("prd")):""}catch(e){a=""}if(connection.extra={role:role,name:r,tenant:tenant,sessionId:sessionId,ua:navigator.userAgent,referrer:document.title,roomId:roomId,isAdmin:queryString.isAdmin||"admin"==role?1:0,pass:requirePassComm,callerInfo:a},connection.onopen=function(e){if(svConfigs.videoScreen.enableLogs&&console.log("You are connected with: "+connection.getAllParticipants().join(", ")),lsDesigner&&lsDesigner.pointsLength<=0&&setTimeout(function(){connection.send("plz-sync-points")},1e3),"popup"==e.extra.role)if(e.extra.isAdmin){var n=jQEngager.Event("AdminPopupOnline",{sessionId:e.extra.sessionId,isAdmin:1,pass:e.extra.pass});jQEngager(document).trigger(n)}else{if(e.extra.callerInfo)e={sessionId:e.extra.sessionId,isAdmin:e.extra.isAdmin,name:e.extra.callerInfo?e.extra.callerInfo.name:e.extra.name,callerInfo:e.extra.callerInfo,pass:e.extra.pass};else e={sessionId:e.extra.sessionId,isAdmin:e.extra.isAdmin,pass:e.extra.pass};n=jQEngager.Event("PopupOnline",e);jQEngager(document).trigger(n)}if(e.extra&&"admin"==e.extra.role){n=jQEngager.Event("AdminOnline");jQEngager(document).trigger(n)}},connection.onclose=connection.onerror=connection.onleave=function(e){if(e.extra&&"admin"==e.extra.role){var n=jQEngager.Event("AdminOffline");jQEngager(document).trigger(n)}e.extra&&"visitor"==e.extra.role&&(jQEngager("#simpleButton"+e.extra.sessionId).hide(),jQEngager("#chats-lsv-admin").remove("#simpleButton"+e.extra.sessionId))},connection.onUserStatusChanged=function(n){if(svConfigs.videoScreen.enableLogs&&console.log("onUserStatusChanged",n),"offline"==n.status&&0==connection.getAllParticipants().length){var o=jQEngager.Event("AdminPopupOffline");jQEngager(document).trigger(o),e.handleCallTermination()}"online"==n.status&&"admin"===role&&socket.emit(connection.socketCustomEvent,{type:"adminOnline",role:"admin"})},connection.onPeerStateChanged=function(e){if(svConfigs.videoScreen.enableLogs&&console.log("On PeerStateChanged",e),"closed"==e.iceConnectionState&&e.extra&&e.extra.isAdmin){var n=jQEngager.Event("AdminOffline");jQEngager(document).trigger(n);n=jQEngager.Event("AdminPopupOffline");jQEngager(document).trigger(n);for(var o=0;o<popupNotifications.length;o++)popupNotifications[o]==e.extra.sessionId&&popupNotifications.splice(o,1)}},this.onGettingWebRTCStats=function(e,n){videoConnection.peers[n]||e.nomore();bytesToSize(e.bandwidth.speed),e.encryption,e.audio.recv.codecs.concat(e.video.recv.codecs).join(", "),bytesToSize(e.audio.bytesReceived+e.video.bytesReceived),e.connectionType.remote.candidateType.join(", "),e.connectionType.remote.transport.join(", "),e.results.forEach(function(e){if("ssrc"===e.type&&"Channel-audio-1"===e.transportId){var n=e.packetsLost;e.packetsSent,e.audioInputLevel,e.googTrackId,e.mediaType,e.id.indexOf("_send");"\n","packetsLost: "+n}})},this.joinBroadcastLooper=function(){videoConnection.extra.broadcaster=!1,videoConnection.dontCaptureUserMedia=!0,videoConnection.session.oneway=!0,function e(){videoConnection.checkPresence(roomId+"_video",function(n,o,t){t._room&&t._room.isFull&&alert("Room is full."),n?videoConnection.join(roomId+"_video",function(e,n,o){o?console.error("join",o,roomId+"_video"):setTimeout(function(){var e=jQEngager.Event("MakeBigBroadcast");jQEngager(document).trigger(e)},3e3)}):setTimeout(e,5e3)})}()},this.startScreenConnection=function(e,n){screenConnection.openOrJoin(roomId+"_screen",function(o,t,i){screenConnection.isInitiator=e,(e||screenConnection.extra.sessionId!==n)&&(screenConnection.extra={sessionId:n}),e&&socket.emit(connection.socketCustomEvent,{type:"startScreenShare",role:role,tenant:tenant,sessionId:n,roomId:roomId})})},connection.onmessage=function(n){if(!0!==n.data.typing)if(!1!==n.data.typing)if(n.data.chatMessage)if(n.data.privateId){if(n.data.privateId==e.getSessionId()){d=jQEngager.Event("ChatMessage",{msg:n.data.chatMessage,date:n.data.date,sessionId:n.data.sessionId,privateId:n.data.privateId});jQEngager(document).trigger(d)}if(n.data.privateId&&"admin"===role){jQEngager("#simpleButton"+n.data.privateId).show();var o=$("#contentChatsimple"+n.data.privateId)[0],t=$("#nameChat"+n.data.privateId).val();const e='<div class="msg-lsv ${side}-msg-lsv">   <div class="msg-lsv-bubble"> \t<div class="msg-lsv-info"> \t  <div class="msg-lsv-info-name">'+t+'</div> \t  <div class="msg-lsv-info-time">'+getPrettyDate((new Date).getTime()/1e3)+'</div> \t</div>  \t<div class="msg-lsv-text">'+n.data.chatMessage+"</div>   </div> </div>";if(o.insertAdjacentHTML("beforeend",e),o.scrollTop+=500,playEnterRoom(),svConfigs.serverSide.chatHistory){var i=n.data.privateId,r=[];r[sessionForChat]={},r[i]={},saveChat(n.data.chatMessage,t,"",null,null,r)}}}else{d=jQEngager.Event("ChatMessage",{msg:n.data.chatMessage,date:n.data.date,sessionId:n.data.sessionId});jQEngager(document).trigger(d)}else if(n.data.translateMessage){d=jQEngager.Event("TranslateMessage",{msg:n.data.translateMessage,sessionId:n.data.sessionId});jQEngager(document).trigger(d)}else{if("voiceSpeaking"===n.data){d=jQEngager.Event("VoiceSpeaking",{id:n.userid});jQEngager(document).trigger(d)}if("voiceSilence"===n.data){d=jQEngager.Event("VoiceSilence",{id:n.userid});jQEngager(document).trigger(d)}if(lsDesigner&&"plz-sync-points"===n.data)lsDesigner.sync();else if(n.data.whiteboardData){d=jQEngager.Event("WhiteboardSync");if(jQEngager(document).trigger(d),queryString.isAdmin||localStorage.getItem("hasPrivileges")||e.startWhiteboard(),lsDesigner||e.startWhiteboard(),n.data.whiteboardData){var a=n.data.whiteboardData,s=screen.width/n.data.width;a.points.forEach(function(e){if("text"==e[0]){e[1][1]=e[1][1]*s,e[1][2]=e[1][2]*s;var n=e[2][7].split(" "),o=n[0].split("px");e[2][7]=o[0]*s+"px "+n[1]}else"image"==e[0]||"pdf"==e[0]?(e[1][1]=e[1][1]*s,e[1][2]=e[1][2]*s,e[1][3]=e[1][3]*s,e[1][4]=e[1][4]*s):(e[1][0]=e[1][0]*s,e[1][1]=e[1][1]*s,e[1][2]=e[1][2]*s,e[1][3]=e[1][3]*s,e[2][0]=e[2][0]*s)}),lsDesigner.syncData(a)}else lsDesigner.clearCanvas()}}else{var d=jQEngager.Event("SendTyping",{typing:!1});jQEngager(document).trigger(d)}else{var d=jQEngager.Event("SendTyping",{typing:!0,sessionId:n.userid});jQEngager(document).trigger(d)}},queryString.room){(videoConnection=new RTCMultiConnection).enableLogs=!!svConfigs.videoScreen.enableLogs&&svConfigs.videoScreen.enableLogs,videoConnection.iceServers=svConfigs.iceServers.iceServers,videoConnection.socketURL=svConfigs.appWss,videoConnection.maxParticipantsAllowed=svConfigs.maxParticipantsAllowed?svConfigs.maxParticipantsAllowed:1e3,videoConnection.publicRoomIdentifier=publicRoomIdentifier,videoConnection.autoCreateMediaElement=!1,queryString.broadcast?videoConnection.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!!queryString.isAdmin}:videoConnection.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},videoConnection.extra={sessionId:sessionId},videoConnection.onclose=videoConnection.onerror=videoConnection.onleave=function(e){if(e.extra&&e.extra.sessionId){var n=jQEngager.Event("PopupLeft",{sessionId:e.extra.sessionId,isAdmin:0});jQEngager(document).trigger(n)}},videoConnection.onPeerStateChanged=function(e){},videoConnection.onspeaking=function(n){audio_on&&video_on&&e.getStream()&&connection.send("voiceSpeaking")},videoConnection.onsilence=function(e){connection.send("voiceSilence")},videoConnection.onMediaError=function(e){if("NotAllowedError"===e.name||"SecurityError"===e.name){e=jQEngager.Event("TogglePermissionDenied");jQEngager(document).trigger(e),socket.emit(connection.socketCustomEvent,{type:"endCall",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})}else videoConnection.openOrJoin(roomId+"_video",function(e,n,o){o&&console.error("openOrJoin",o,n)})},connection.chunkSize=16e3,connection.enableFileSharing=!0,connection.onUserIdAlreadyTaken=function(e,n){},connection.autoSaveToDisk=!1;var s={};if(connection.onFileProgress=function(e,n){var o=s[e.uuid];o.progress[0].value=e.currentPosition||e.maxChunks||o.progress[0].max},connection.onFileStart=function(e){if(e.userid===connection.userid){if(!recentFile.started){recentFile.started=!0;var n=jQEngager.Event("IncomingFileTransfer",{name:e.name,sender:!0,fileId:e.uuid});jQEngager(document).trigger(n)}}else{n=jQEngager.Event("IncomingFileTransfer",{name:e.name,sender:!1,fileId:e.uuid});jQEngager(document).trigger(n)}s[e.uuid]={progress:jQEngager("#progress"+e.uuid)},s[e.uuid].progress.max=e.maxChunks},connection.onFileEnd=function(n){var o=e.getFileHTML(n);if(n.userid===connection.userid)if(recentFile){recentFile.userIndex++;var t=connection.getAllParticipants()[recentFile.userIndex];t?connection.send(recentFile,t):recentFile=null}else recentFile=null;else jQEngager("#download"+n.uuid).html(o)},videoConnection.onstream=function(o){if(svConfigs.videoScreen.enableLogs&&console.log("videoConnection.onstream",o),videoConnection.videosContainer=document.getElementById(videoElementContainer),"local"===o.type){var t=jQEngager.Event("LocalVideoStarted");if(jQEngager(document).trigger(t),o.stream.isVideo)iphoneLocalStream=RMCMediaTrack.cameraStream=o.stream,RMCMediaTrack.cameraTrack=e.getTracks(o.stream,"video")[0],(r=document.getElementById("localVideo")).setAttribute("data-sessionId",o.extra.sessionId),svConfigs.videoScreen.localFeedMirrored&&(r.style.transform="scale(-1, 1)"),r.srcObject=svConfigs.videoScreen.videoFileStream?localVideoStream:o.stream,RMCMediaTrack.selfVideo=r,videoConnection.extra.screen&&(RMCMediaTrack.cameraTrack.onended=RMCMediaTrack.cameraTrack.onmute=RMCMediaTrack.cameraTrack.oninactive=function(){n=!1,videoConnection.extra.screen=!1,e.handleScreenShareTermination()}),isiPhone&&e.checkMediaDevices()}else{if(void 0===o.extra.sessionId)return;$(".sourcevideo").each(function(){$(this).attr("id"),o.extra.sessionId}),$(".bigvideo").each(function(){$(this).attr("id"),o.extra.sessionId});var i=document.getElementById("remoteVideoSpan"+o.extra.sessionId),r=document.getElementById(o.extra.sessionId);i&&i.remove(),r&&r.remove();var a=document.createElement("video");a.id=o.extra.sessionId;var s=videoConnection.getAllParticipants().length;if(a.setAttribute("class",classVideo),"conference"!==conferenceStyle){var d=s>1?"49%":"98%";a.style.width=d}try{a.setAttributeNode(document.createAttribute("autoplay")),a.setAttributeNode(document.createAttribute("playsinline")),a.setAttributeNode(document.createAttribute("videoautoplay"))}catch(t){a.playsinline=!0,a.autoplay=!0,a.videoautoplay=!0}var c=o.stream;if("srcObject"in a?a.srcObject=c:a[navigator.mozGetUserMedia?"mozSrcObject":"src"]=navigator.mozGetUserMedia?c:(window.URL||window.webkitURL).createObjectURL(c),videoConnection.videosContainer.appendChild(a),queryString.broadcast){t=jQEngager.Event("RemoteVideoStarted");jQEngager(document).trigger(t),queryString.token?toggleNotification(smartVideoLocale.msgStore.welcomeBroadcast,!0):toggleNotification(smartVideoLocale.msgStore.incomingBroadcast,!0);var l=a.play();void 0!==l&&l.then(function(){toggleNotification("",!1),a.play()}).catch(function(e){$("#incomingBroadcast").click(function(){toggleNotification("",!1),a.play()})})}else{t=jQEngager.Event("RemoteVideoStarted");jQEngager(document).trigger(t)}visitorRinging=[],setTimeout(function(){connection.send("voiceSpeaking")},1500)}if(queryString.broadcast)if("remote"===o.type&&videoConnection.isInitiator){var u=[];videoConnection.getAllParticipants().forEach(function(e){u.push({pid:e,broadcaster:!0===videoConnection.peers[e].extra.broadcaster})}),videoConnection.socket.emit(videoConnection.socketCustomEvent,{roomId:roomId,participants:u})}else"remote"!==o.type||videoConnection.extra.broadcaster||videoConnection.socket.emit(videoConnection.socketCustomEvent,{giveAllParticipants:!0,roomId:roomId});videoConnection.onUserStatusChanged(o),e.initHark({stream:o.stream,streamedObject:o,connection:videoConnection})},videoConnection.onstreamended=function(n){if(n.extra){var o=document.getElementById(n.extra.sessionId);o&&(o.parentNode.removeChild(o),$("#remoteVideoSpan"+n.extra.sessionId).remove(),$("#"+n.extra.sessionId).remove());var t=jQEngager.Event("RemoteVideoStopped");jQEngager(document).trigger(t);var i=videoConnection.getAllParticipants().length;0===i&&e.handleCallTermination(),queryString.broadcast&&!queryString.isAdmin&&"local"!==n.type&&0===i&&(toggleError(smartVideoLocale.msgStore.broadcastStopped,5e3),setTimeout(function(){location.reload()},1e3))}},videoConnection.onUserStatusChanged=function(n){var o=[];connection.getAllParticipants().forEach(function(n){o.push(e.getFullName(n))}),o=o.length?[connection.extra.userFullName||"You"].concat(o):["Only You"]},videoConnection.onopen=function(){svConfigs.videoScreen.enableLogs&&console.log("You are connected with: "+connection.getAllParticipants().join(", "))},videoConnection.onEntireSessionClosed=function(e){videoConnection&&(videoConnection.leave(),videoConnection.streamEvents.selectAll({local:!0}).forEach(function(e){e.stream.getAudioTracks()[0].stop(),e.stream.getVideoTracks()[0].stop()}));var n=jQEngager.Event("CallEnded");jQEngager(document).trigger(n)},"conference"==conferenceStyle&&(connection.autoCloseEntireSession=!1,videoConnection.autoCloseEntireSession=!1),!queryString.broadcast&&svConfigs.videoScreen.separateScreenShare){(screenConnection=new RTCMultiConnection).enableLogs=!!svConfigs.videoScreen.enableLogs&&svConfigs.videoScreen.enableLogs,screenConnection.maxParticipantsAllowed=svConfigs.maxParticipantsAllowed?svConfigs.maxParticipantsAllowed:1e3,screenConnection.closeBeforeUnload=!1,screenConnection.iceServers=svConfigs.iceServers.iceServers,screenConnection.socketURL=svConfigs.appWss,screenConnection.publicRoomIdentifier=publicRoomIdentifier,screenConnection.autoCloseEntireSession=!1,screenConnection.autoCreateMediaElement=!1,screenConnection.sdpConstraints.mandatory={OfferToReceiveAudio:!1,OfferToReceiveVideo:!0};var d={mandatory:{maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};screenConnection.mediaConstraints=d,screenConnection.session={screen:!0,oneway:!0},screenConnection.onstream=function(e){if("local"===e.type)var n=document.getElementById("localScreen");else n=document.getElementById("remoteScreen");try{n.setAttributeNode(document.createAttribute("autoplay")),n.setAttributeNode(document.createAttribute("playsinline"))}catch(o){n.setAttribute("autoplay",!0),n.setAttribute("playsinline",!0)}if("local"===e.type){n.volume=0;try{n.setAttributeNode(document.createAttribute("muted"))}catch(o){n.setAttribute("muted",!0)}}else{var o=jQEngager.Event("RemoteScreenShareStarted");jQEngager(document).trigger(o)}n.srcObject=e.stream},screenConnection.onstreamended=function(n){var o=jQEngager.Event("ScreenShareEnded");jQEngager(document).trigger(o),e.handleScreenShareTermination()},screenConnection.onMediaError=function(n){if("Concurrent mic process limit."===n.message){if(DetectRTC.audioInputDevices.length<=1)return void alert("Please select external microphone. Check github issue number 483.");var o=DetectRTC.audioInputDevices[1].deviceId;screenConnection.mediaConstraints.audio={deviceId:o}}if("Permission denied"===n.message){n=jQEngager.Event("ScreenShareEnded");jQEngager(document).trigger(n),e.handleScreenShareTermination()}}}}e.connect()},this.connect=function(){this.updateListOfRooms=function(n){jQEngager("#visitors").empty(),jQEngager("#visitorsCount").html(0);var o=0;n.forEach(function(n,t){n.participants.forEach(function(t,i){var r=connection.peers[t];if(r){var a=r.extra,s=jQEngager("#visitors").find("#"+a.sessionId),d=a.ua?detect.parse(a.ua):"",c=d?d.browser.name:"",l=d?d.os.name:"",u=a.callerInfo&&a.callerInfo.name?a.callerInfo.name:guestName(a.sessionId),m='<a href="javascript:void(0);" id="chat'+a.sessionId+'">Start chat</a>',g='<section class="msger-lsv" id="simpleButton'+a.sessionId+'" style="display: none;">                            <header class="msger-lsv-header">                                <div class="msger-lsv-header-title">                                        '+u+'                                </div>                                <div class="msger-lsv-header-options">                                        <a href="javascript:void(0);" title="" class="close-but-wd-small" id="closeSimpleChat'+a.sessionId+'"><span></span></a>                                </div>                        </header>                        <main class="msger-lsv-chat" id="contentChatsimple'+a.sessionId+'">                        </main>                        <form class="msger-lsv-inputarea" id="form'+a.sessionId+'">                                <input type="text" id="input'+a.sessionId+'" class="msger-lsv-input" placeholder="Enter your message...">                                <input type="hidden" id="nameChat'+a.sessionId+'" value="'+u+'">                                <button type="submit" class="msger-lsv-send-btn">Send</button>                        </form>                </section>';if(0==s.length){m='<a href="javascript:void(0);" id="chat'+a.sessionId+'">Start chat</a>';var f=document.createElement("div");f.className="row msg_container base_receive",f.id=a.sessionId,f.innerHTML='<div class="col-sm-10 col-xs-10">                                                                        <div class="messages msg_receive">                                                                                <p>'+u+" "+a.referrer+" "+m+"<br/>"+l+" "+c+"</p>                                                                                                                                                        </div>                                                                </div>",jQEngager("#visitors").append(f),o++}if($("#chat"+a.sessionId).off("click"),$("#chat"+a.sessionId).click(function(){$("#simpleButton"+a.sessionId).show()}),0==jQEngager("#chats-lsv-admin").find("#simpleButton"+a.sessionId).length){jQEngager("#chats-lsv-admin").append(g),$("#chat"+a.sessionId).click(function(){$("#simpleButton"+a.sessionId).show()}),$("#closeSimpleChat"+a.sessionId).click(function(){$("#simpleButton"+a.sessionId).hide()});var v=function(e,n,o,t){if(!o)return;o=linkify(o);var i=$("#contentChatsimple"+a.sessionId)[0];const r='<div class="msg-lsv '+n+'-msg-lsv">   <div class="msg-lsv-bubble"> \t<div class="msg-lsv-info"> \t  <div class="msg-lsv-info-name">'+e+'</div> \t  <div class="msg-lsv-info-time">'+(t||getPrettyDate((new Date).getTime()/1e3))+'</div> \t</div>  \t<div class="msg-lsv-text">'+o+"</div>   </div> </div>";i.insertAdjacentHTML("beforeend",r),i.scrollTop+=500};$("#form"+a.sessionId).submit(function(n){n.preventDefault();var o=$("#input"+a.sessionId),t=o.val();if(v("Me","right",t),o.val(""),e.addLocalChat(t,null,a.sessionId),svConfigs.serverSide.chatHistory){var i=svConfigs.agentName?svConfigs.agentName:"Agent",r=a.sessionId,s=[];s[sessionForChat]={},s[r]={},saveChat(t,i,"",null,null,s)}}),svConfigs.serverSide.chatHistory&&$.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"getchat",roomId:roomId,sessionId:a.sessionId,agentId:null}}).done(function(e){e&&JSON.parse(e).forEach(function(e){var n=svConfigs.agentName?svConfigs.agentName:"Agent";if(e.from==n)var o="Me",t="right";else o=e.from,t="left";var i=getPrettyDate(e.date_created);v(o,t,e.message,i)})}).fail(function(){})}if("popup"==n.extra.role){var p=jQEngager("#visitors").find("#"+a.sessionId),h=jQEngager("#visitors").find("#room"+a.sessionId),S=!1;if(jQEngager("#roomid_"+n.extra.roomId).html(n.extra.roomId+' <img src="../img/online.png" alt="waiting to connect">'),n.participants.forEach(function(e,o){connection.peers[e]||(S=!0,jQEngager("#roomid_"+n.extra.roomId).html(n.extra.roomId+' <img src="../img/offline.png" alt="busy">'))}),p.length>0&&0===h.length&&!S&&(setTimeout(function(){var e=p.children().children().children(),o={};o.names=svConfigs.agentName?svConfigs.agentName:guestName(a.sessionId),lsRepUrl&&(o.lsRepUrl=lsRepUrl),agentId&&(o.agentId=agentId);var t=window.btoa(unescape(encodeURIComponent(JSON.stringify(o)))),i=lsRepUrl+"pages/"+roomLinkPage+"?room="+n.extra.roomId+"&p="+t+"&isAdmin=1",r=document.createElement("span");r.id="room"+a.sessionId,r.innerHTML=' <a href="'+i+'" target="_blank">Enter Room</a>',e.append(r)},200),-1==jQEngager.inArray(a.sessionId,popupNotifications))){playEnterRoom();var C=jQEngager.Event("EnterPageNotification",{name:u});jQEngager(document).trigger(C),popupNotifications.push(a.sessionId)}}}}),jQEngager("#visitorsCount").html(o)})},this.looper=function(){connection.socket.emit("get-public-rooms",publicRoomIdentifier,function(n){e.updateListOfRooms(n),setTimeout(e.looper,3e3)})},connection.connectSocket(function(n){socket=n,connection.changeUserId(sessionId,null),e.showStatusBar("Connected to the chat server!",5e3);var o=jQEngager.Event("CommConnected");jQEngager(document).trigger(o),"admin"===role&&e.looper();socket.on("connect",function(n){e.showStatusBar("Connected to the chat server!",5e3)}),socket.on("disconnect",function(n){e.showStatusBar("Unable to connect to the chat server! Kindly refresh",1e4);var o=jQEngager.Event("AdminOffline");jQEngager(document).trigger(o),jQEngager("#visitors").empty(),location.reload()}),socket.on(connection.socketCustomEvent,function(n){if("initCall"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){connection.getAllParticipants().forEach(function(e){visitorRinging.push(e)});var o=jQEngager.Event("IncomingCall",{autoaccept:n.autoaccept,sessionId:n.sessionId});jQEngager(document).trigger(o)}if("customerHere"===n.type&&sessionId!==n.sessionId&&"dashboard"===roomId){jQEngager("#roomid_"+n.roomId).html(n.roomId+' <img src="../img/online.png" alt="waiting to connect">');o=jQEngager.Event("EnterCustomerNotification",{name:n.name,roomId:n.roomId});jQEngager(document).trigger(o),setTimeout(function(){jQEngager("#roomid_"+n.roomId).html(n.roomId)},1e4)}if("customerOut"===n.type&&sessionId!==n.sessionId&&"dashboard"===roomId&&jQEngager("#roomid_"+n.roomId).html(n.roomId),"endCall"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId&&setTimeout(function(){var e=visitorRinging.indexOf(n.sessionId);if(-1!==e&&visitorRinging.splice(e,1),0==videoConnection.getAllParticipants().length&&0==visitorRinging.length){var o=jQEngager.Event("CallEnded");jQEngager(document).trigger(o)}},200),"remoteVideoUnmuted"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("RemoteVideoUnmuted",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("startScreenShare"===n.type&&n.roomId===roomId)if(queryString.broadcast){o=jQEngager.Event("VoiceSpeaking",{id:n.sessionId});jQEngager(document).trigger(o)}else sessionId!==n.sessionId&&e.startScreenConnection(!1,n.sessionId);if("remoteVideoMuted"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("RemoteVideoMuted",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("remoteAudioUnmuted"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("RemoteAudioUnmuted",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("remoteAudioMuted"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("RemoteAudioMuted",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("revokePriveleges"===n.type&&sessionId==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("RevokePriveleges",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("grantPriveleges"===n.type&&sessionId==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("GrantPriveleges",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("blockUser"===n.type&&n.roomId===roomId){o=jQEngager.Event("BlockUser",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("forceAudioMuted"===n.type&&n.roomId===roomId){o=jQEngager.Event("ForceAudioMuted",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("forceAudioMutedAll"===n.type&&n.roomId===roomId){o=jQEngager.Event("ForceAudioMutedAll");jQEngager(document).trigger(o)}if("forceDelete"===n.type&&n.roomId===roomId){connection.leave();o=jQEngager.Event("ForceDelete",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("forceDeleteAll"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){connection.leave();o=jQEngager.Event("ForceDeleteAll");jQEngager(document).trigger(o)}if("setPresent"===n.type&&n.roomId===roomId){o=jQEngager.Event("SetPresent",{sessionId:n.sessionId,present:n.present});jQEngager(document).trigger(o)}if("endMeeting"===n.type&&n.roomId===roomId){o=jQEngager.Event("EndMeeting",{sessionId:n.sessionId});jQEngager(document).trigger(o)}if("adminOnline"===n.type&&(n.roomId===roomId||"admin"==n.role)){o=jQEngager.Event("AdminOnline");jQEngager(document).trigger(o)}if("toVideo"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("ToVideo");jQEngager(document).trigger(o)}if("startRecording"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("RemoteStartRecording");jQEngager(document).trigger(o)}if("stopRecording"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("RemoteStopRecording");jQEngager(document).trigger(o)}if("rejectCall"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){var t=visitorRinging.indexOf(n.sessionId);if(-1!==t&&visitorRinging.splice(t,1),0==visitorRinging.length){o=jQEngager.Event("CallEnded");jQEngager(document).trigger(o)}}if("setCallerInfo"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId){o=jQEngager.Event("CallerInfo",{sessionId:n.sessionId,callerInfo:n.callerInfo,isAdmin:n.isAdmin});jQEngager(document).trigger(o)}if("clearCanvas"===n.type&&sessionId!==n.sessionId&&n.roomId===roomId&&lsDesigner&&lsDesigner.clearCanvas(),"sendCallerBack"===n.type&&n.roomId===roomId){o=jQEngager.Event("SendCallerBack",{access:n.access,sessionId:n.sessionId});jQEngager(document).trigger(o)}if(n.participants&&videoConnection&&!videoConnection.isInitiator&&!videoConnection.extra.broadcaster&&n.roomId==roomId&&n.participants.forEach(function(e){e.pid!==videoConnection.userid&&-1===videoConnection.getAllParticipants().indexOf(e.pid)&&(videoConnection.extra.broadcaster||!1!==e.broadcaster)&&videoConnection.join(e.pid,function(e,n,o){})}),n.giveAllParticipants&&videoConnection&&videoConnection.isInitiator&&n.roomId==roomId){var i=[];videoConnection.getAllParticipants().forEach(function(e){i.push({pid:e,broadcaster:!0===videoConnection.peers[e].extra.broadcaster})}),connection.socket.emit(connection.socketCustomEvent,{participants:i}),toggleError(smartVideoLocale.msgStore.broadcastViewers+" "+i.length,5e3),$("#wd-widget-content-whiteboard").is(":visible")&&lsDesigner&&lsDesigner.sync()}}),connection.checkPresence(roomId,function(e,n){!0===e?connection.join(roomId,function(e,n,o){queryString.isAdmin&&socket.emit(connection.socketCustomEvent,{type:"adminOnline",role:"popup",sessionId:sessionId,roomId:roomId}),svConfigs.videoScreen.enableLogs&&console.log("joined to "+n),o&&location.reload()}):connection.open(roomId,function(e,n,o){queryString.isAdmin&&socket.emit(connection.socketCustomEvent,{type:"adminOnline",role:"popup",sessionId:sessionId,roomId:roomId}),o&&location.reload()}),"admin"===role&&(connection.isInitiator=!0)})})},this.renegotiate=function(e){facingMode="user"===facingMode?"environment":"user",navigator.mediaDevices.getUserMedia({video:{facingMode:facingMode},audio:audio_on}).then(function(e){!function(e,n){n?videoConnection.lastCamera||(videoConnection.lastCamera=videoConnection.attachStreams[0]):videoConnection.lastCamera=e;videoConnection.getAllParticipants().forEach(function(n){var o=videoConnection.peers[n].peer;if(o.getSenders){var t=e.clone().getVideoTracks()[0],i=e.clone().getAudioTracks()[0];o.getSenders().forEach(function(e){e&&e.track&&("video"===e.track.kind&&t?(e.track.id!=t.id&&e.replaceTrack(t),t=null):"audio"===e.track.kind&&i&&(e.track.id!=i.id&&e.replaceTrack(i),i=null))})}})}(e)}),videoConnection.streamEvents.selectAll({local:!0}).forEach(function(e){e.stream.isAudio&&e.stream.getAudioTracks()[0].stop(),e.stream.isVideo&&e.stream.getVideoTracks()[0].stop()}),videoConnection.attachStreams.forEach(function(e){e.stop()}),streamConstraints={video:e?{deviceId:{exact:e}}:{facingMode:facingMode},audio:audio_on},videoConnection.mediaConstraints=streamConstraints,videoConnection.session={video:!0,audio:audio_on},videoConnection.checkPresence(roomId,function(e,n){!0===e?videoConnection.join(roomId+"_video",function(e,n,o){o&&location.reload()}):videoConnection.open(roomId+"_video",function(e,n,o){o&&location.reload()})})},this.initCall=function(n,o,t,i,r,a,s){videoConnection.extra.roomOwner=!0;var d=n||("initVideo"===this.id?"Video":"Audio"),c=r?{deviceId:{exact:r}}:{};audio_on||(c=!1),s&&jQEngager.extend(!0,c,s);var l=t?{deviceId:{exact:t}}:{facingMode:facingMode};switch(a&&jQEngager.extend(!0,l,a),d){case"Video":var u=!0;streamConstraints={video:l,audio:c};break;case"Audio":u=!1,streamConstraints={audio:c,video:!1};break;default:u=!0,streamConstraints={video:l,audio:c}}if(queryString.broadcast){var m=function(){queryString.isAdmin&&svConfigs.videoScreen.videoFileStream?(videoConnection.dontCaptureUserMedia=!0,videoConnection.attachStreams=[localVideoStream],videoConnection.extra.broadcaster=!0,videoConnection.openOrJoin(roomId+"_video",function(e,n,o){if(o)console.error("openOrJoin",o,n);else{var t=jQEngager.Event("LocalVideoStarted");jQEngager(document).trigger(t)}})):(videoConnection.session={audio:!(!queryString.isAdmin&&!localStorage.getItem("hasPrivileges")),video:!!queryString.isAdmin,broadcast:!0},videoConnection.mediaConstraints={audio:!(!queryString.isAdmin&&!localStorage.getItem("hasPrivileges"))&&c,video:!!queryString.isAdmin&&l},queryString.isAdmin||localStorage.getItem("hasPrivileges")?(videoConnection.extra.broadcaster=!0,videoConnection.openOrJoin(roomId+"_video",function(e,n,o){o&&console.error("openOrJoin",o,n)})):(videoConnection.extra.roomOwner=!1,e.joinBroadcastLooper()))};if(svConfigs.videoScreen.videoFileStream){var g=document.getElementById("localVideo");function f(){localVideoStream||(g.captureStream?(localVideoStream=g.captureStream(),m()):g.mozCaptureStream&&(localVideoStream=g.mozCaptureStream(),m()))}g.setAttribute("volume",0),g.setAttribute("autoplay",""),g.setAttribute("muted",""),g.setAttribute("loop",""),g.setAttribute("playsinline",""),g.setAttribute("src",svConfigs.videoScreen.videoFileStream),g.oncanplay=f,g.readyState>=3&&f()}else m()}else{videoConnection.DetectRTC.load(function(){var n=[];if(videoConnection.DetectRTC.videoInputDevices.forEach(function(e){var o={};o.value=e.id,o.text=e.label,n.push(o)}),0===videoConnection.DetectRTC.videoInputDevices.length){var t=jQEngager.Event("VideoRemoved");jQEngager(document).trigger(t),socket.emit(connection.socketCustomEvent,{type:"remoteVideoMuted",role:role,tenant:tenant,sessionId:i,roomId:roomId})}if(0===videoConnection.DetectRTC.audioInputDevices.length){t=jQEngager.Event("AudioRemoved");jQEngager(document).trigger(t),socket.emit(connection.socketCustomEvent,{type:"remoteAudioMuted",role:role,tenant:tenant,sessionId:i,roomId:roomId})}if(videoConnection.DetectRTC.videoInputDevices){t=jQEngager.Event("MediaDevices",{devices:n});jQEngager(document).trigger(t)}streamConstraints.video=!!video_on&&streamConstraints.video,streamConstraints.audio=!!audio_on&&streamConstraints.audio,videoConnection.mediaConstraints=streamConstraints,videoConnection.session={video:!!video_on&&u,audio:audio_on},video_on||(videoConnection.session.oneway=!0),videoConnection.checkPresence(roomId+"_video",function(n,t){if(!0===n?videoConnection.join(roomId+"_video",function(n,o,t){t&&(e.handleCallTermination(),videoConnection.closeEntireSession(function(){videoConnection.openOrJoin(roomId+"_video")}))}):videoConnection.open(roomId+"_video",function(n,o,t){t&&(svConfigs.videoScreen.enableLogs&&console.log(t),e.handleCallTermination(),videoConnection.closeEntireSession(function(){videoConnection.openOrJoin(roomId+"_video")}))}),!video_on){var r=jQEngager.Event("LocalVideoStarted");jQEngager(document).trigger(r)}"simple"==conferenceStyle&&socket.emit(connection.socketCustomEvent,{type:"initCall",role:role,tenant:tenant,autoaccept:o,sessionId:i,roomId:roomId}),connection.getAllParticipants().forEach(function(e){visitorRinging.push(e)})})})}},this.leave=function(){connection.getAllParticipants().forEach(function(e){connection.disconnectWith(e)})},this.customerHere=function(e){socket.emit(connection.socketCustomEvent,{type:"customerHere",name:e,role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.customerOut=function(e){socket.emit(connection.socketCustomEvent,{type:"customerOut",name:e,role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.toggleAudio=function(){var e=1,n=1;videoConnection.attachStreams.forEach(function(o){o.getAudioTracks().forEach(function(o){e=o.enabled=!o.enabled,n=0})}),1==n&&(videoConnection.mediaConstraints.audio=!0,videoConnection.addStream({audio:!0}));var o=e?"AudioUnmuted":"AudioMuted",t=e?"remoteAudioUnmuted":"remoteAudioMuted",i=jQEngager.Event(o);jQEngager(document).trigger(i),socket.emit(connection.socketCustomEvent,{type:t,role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.toggleVideo=function(){var e=1,n=1;videoConnection.attachStreams.forEach(function(o){o.getVideoTracks().forEach(function(o){e=o.enabled=!o.enabled,n=0})}),1==n&&(videoConnection.mediaConstraints.video=!0,videoConnection.addStream({video:!0}),videoConnection.session.oneway=!1);var o=e?"VideoUnmuted":"VideoMuted",t=e?"remoteVideoUnmuted":"remoteVideoMuted",i=jQEngager.Event(o);jQEngager(document).trigger(i),socket.emit(connection.socketCustomEvent,{type:t,role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.joinBroadcast=function(){videoConnection.streamEvents.selectAll({local:!0}).forEach(function(e){e.stream.isAudio&&e.stream.getAudioTracks()[0].stop(),e.stream.isVideo&&e.stream.getVideoTracks()[0].stop()}),videoConnection.attachStreams.forEach(function(e){e.stop()}),videoConnection.mediaConstraints.video=svConfigs.videoScreen.broadcastAttendeeVideo,videoConnection.mediaConstraints.audio=!0,videoConnection.addStream({video:svConfigs.videoScreen.broadcastAttendeeVideo,audio:!0}),videoConnection.session.oneway=!1,svConfigs.videoScreen.allowOtherSee&&(videoConnection.extra.broadcaster=!0,videoConnection.openOrJoin(roomId+"_video",function(e,n,o){if(o)console.error("openOrJoin",o,n);else if(!videoConnection.isInitiator){var t=videoConnection.dontCaptureUserMedia;videoConnection.dontCaptureUserMedia=!0,videoConnection.open(videoConnection.userid,function(e,n,o){o?console.error("open",o,n):(videoConnection.dontCaptureUserMedia=t,videoConnection.isInitiator=!1)})}}))},this.revokeBroadcast=function(){videoConnection.streamEvents.selectAll({local:!0}).forEach(function(e){e.stream.isAudio&&e.stream.getAudioTracks()[0].stop(),e.stream.isVideo&&e.stream.getVideoTracks()[0].stop()}),videoConnection.attachStreams.forEach(function(e){e.stop()}),videoConnection.mediaConstraints.video=!1,videoConnection.mediaConstraints.audio=!1,videoConnection.addStream({video:!1,audio:!1}),videoConnection.session.oneway=!0,document.getElementById("localVideo").srcObject=null},this.answerCall=function(n,o,t,i,r,a){var s=i?{deviceId:{exact:i}}:{};if(a&&jQEngager.extend(!0,s,a),n)var d=t?{deviceId:{exact:t}}:{facingMode:facingMode};else d=!1;r&&jQEngager.extend(!0,d,r),streamConstraints={video:d,audio:s},videoConnection.session={video:n,audio:!0},videoConnection.mediaConstraints=streamConstraints,o&&setTimeout(function(){videoConnection.openOrJoin(roomId+"_video",function(n,o,t){t&&(e.handleCallTermination(),location.reload())})},200)},this.startStopIphone=function(){facingMode="user"===facingMode?"environment":"user",e.forceStopCall()},this.forceStopCall=function(){videoConnection.streamEvents.selectAll({local:!0}).forEach(function(n){n.stream&&n.stream.isAudio&&n.stream.getAudioTracks().length>0&&(n.stream.getAudioTracks()[0].stop(),e.getTracks(n.stream,"audio").forEach(function(e){n.stream.removeTrack(e)}),e.getTracks(n.stream,"audio").forEach(function(e){n.stream.removeTrack(e)})),n.stream&&n.stream.isVideo&&n.stream.getVideoTracks().length>0&&(n.stream.getVideoTracks()[0].stop(),e.getTracks(n.stream,"video").forEach(function(e){n.stream.removeTrack(e)}),e.getTracks(n.stream,"video").forEach(function(e){n.stream.removeTrack(e)}))}),videoConnection.attachStreams.forEach(function(e){e.stop()}),videoConnection.leave(),document.getElementById("localVideo").srcObject=null,streamConstraints={video:{facingMode:facingMode="user"===facingMode?"environment":"user"},audio:audio_on},videoConnection.mediaConstraints=streamConstraints,videoConnection.session={video:video_on,audio:audio_on};var n=function(){videoConnection.getAllParticipants().forEach(function(e){var n,o,t=videoConnection.peers[e].peer;t.getSenders&&(videoConnection.streamEvents.selectAll({local:!0}).forEach(function(e){e.stream.isAudio&&(o=e.stream.getAudioTracks()[0]),e.stream.isVideo&&(n=e.stream.getVideoTracks()[0])}),t.getSenders().forEach(function(e){e&&e.track&&("video"===e.track.kind&&n?(e.track.id!=n.id&&e.replaceTrack(n),n=null):"audio"===e.track.kind&&o&&(e.track.id!=o.id&&e.replaceTrack(o),o=null))}))})};videoConnection.checkPresence(roomId,function(o,t){!0===o?videoConnection.join(roomId+"_video",function(o,t,i){i?(e.handleCallTermination(),videoConnection.closeEntireSession(function(){videoConnection.openOrJoin(roomId+"_video",function(e,o,t){n()})})):n()}):videoConnection.open(roomId+"_video",function(o,t,i){i?(e.handleCallTermination(),videoConnection.closeEntireSession(function(){videoConnection.openOrJoin(roomId+"_video",function(e,o,t){n()})})):n()})})},this.handleCallTermination=function(){videoConnection&&"conference"!=conferenceStyle&&(videoConnection.streamEvents.selectAll({local:!0}).forEach(function(n){n.stream.isAudio&&(n.stream.getAudioTracks()[0].stop(),e.getTracks(n.stream,"audio").forEach(function(e){n.stream.removeTrack(e)})),n.stream.isVideo&&(n.stream.getVideoTracks()[0].stop(),e.getTracks(n.stream,"video").forEach(function(e){n.stream.removeTrack(e)}))}),videoConnection.attachStreams.forEach(function(e){e.stop()}),0==videoConnection.getAllParticipants().length?videoConnection.closeSocket():videoConnection.leave())},this.reconnectWebsocket=function(n){forceClose||(svConfigs.videoScreen.enableLogs&&console.log("WebSocketClient reconnecting in "+autoReconnectInterval,n),setTimeout(function(){svConfigs.videoScreen.enableLogs&&console.log("WebSocketClient: reconnecting..."),e.connect()},autoReconnectInterval))},this.getRoomId=function(){return roomId},this.checkMediaDevices=function(){videoConnection.DetectRTC.load(function(){var e=[];videoConnection.DetectRTC.videoInputDevices.forEach(function(n){var o={};o.value=n.id,o.text=n.label,e.push(o)});var n=jQEngager.Event("MediaDevices",{devices:e});jQEngager(document).trigger(n)})},this.getParticipants=function(){return connection.getAllParticipants()},this.getVideoSessions=function(){return videoConnection?videoConnection.getAllParticipants().length:0},this.getTracks=function(e,n){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(n||"audio")}):[]},this.addStreamStopListener=function(e,n){e.addEventListener("ended",function(){n(),n=function(){}},!1),e.addEventListener("inactive",function(){n(),n=function(){}},!1),e.getTracks().forEach(function(e){e.addEventListener("ended",function(){n(),n=function(){}},!1),e.addEventListener("inactive",function(){n(),n=function(){}},!1)})},this.addToJoinScreenShare=function(){screenConnection&&screenConnection.checkPresence(roomId+"_screen",function(e,n,o){setTimeout(function(){screenConnection.isInitiator=!1,screenConnection.extra.sessionId!==sessionId&&(screenConnection.extra={sessionId:sessionId}),e&&screenConnection.join(roomId+"_screen",function(e,n,o){o&&console.error("join",o,roomId+"_screen")})},1e3)})},this.startScreenShareConf=function(){e.startScreenConnection(!0,sessionId)},this.screenHelper=function(e){if(svConfigs.videoScreen.screenConstraint)var n=svConfigs.videoScreen.screenConstraint;else n={mandatory:{maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(n).then(function(n){e(n)},function(e){var n=jQEngager.Event("ScreenShareEnded");jQEngager(document).trigger(n)}):navigator.getDisplayMedia?navigator.getDisplayMedia(n).then(function(n){e(n)},function(e){var n=jQEngager.Event("ScreenShareEnded");jQEngager(document).trigger(n)}):toggleNotification("getDisplayMedia API is not available in this browser.",!0)};var n=!1;this.getScreenStream=function(o){e.screenHelper(function(t){RMCMediaTrack.screen=e.getTracks(t,"video")[0],RMCMediaTrack.selfVideo.srcObject=t,function e(){"ended"!==RMCMediaTrack.screen.readyState?setTimeout(e,1e3):RMCMediaTrack.screen.onended()}(),n=!1,RMCMediaTrack.screen.onended=function(){e.handleScreenShareTermination()},o(t)})},this.replaceTrack=function(e){e&&"ended"!==e.readyState&&videoConnection.getAllParticipants().forEach(function(n){var o=videoConnection.peers[n].peer;if(o.getSenders){var t=e;o.getSenders().forEach(function(e){e&&e.track&&"video"===e.track.kind&&t&&(e.replaceTrack(t),t=null)})}})},this.startScreenShare=function(){RMCMediaTrack.cameraStream?e.getScreenStream(function(n){videoConnection.getAllParticipants().length>0&&e.replaceTrack(RMCMediaTrack.screen),videoConnection.attachStreams.forEach(function(n){e.getTracks(n,"video").forEach(function(e){n.removeTrack(e)}),n.addTrack(RMCMediaTrack.screen)})}):(videoConnection.mediaConstraints.screen=!0,videoConnection.addStream({video:!0,screen:!0}),videoConnection.extra.screen=!0),socket.emit(connection.socketCustomEvent,{type:"startScreenshare",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.rejectCall=function(){socket.emit(connection.socketCustomEvent,{type:"rejectCall",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.stopRecording=function(){},this.getSessionId=function(){return sessionId},this.getRemoteSessionId=function(){return""},this.getVideoStream=function(){var e=!1;return videoConnection?videoConnection.attachStreams.forEach(function(n){n.getVideoTracks().forEach(function(n){e=n.enabled})}):e=!1,e},this.getStream=function(){return!!videoConnection&&videoConnection.getAllParticipants().length>0},this.getRemoteStream=function(e){var n;return videoConnection&&Object.keys(videoConnection.streamEvents).forEach(function(o){var t=videoConnection.streamEvents[o];if(t.stream&&t.extra.sessionId==e)return n=t.stream,!1}),n},this.endCall=function(n){socket.emit(connection.socketCustomEvent,{type:"endCall",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId,msg:n}),videoConnection&&(videoConnection.streamEvents.selectAll({local:!0}).forEach(function(n){n.stream.isAudio&&(n.stream.getAudioTracks()[0]&&n.stream.getAudioTracks()[0].stop(),e.getTracks(n.stream,"audio").forEach(function(e){n.stream.removeTrack(e)})),n.stream.isVideo&&(n.stream.getVideoTracks()[0]&&n.stream.getVideoTracks()[0].stop(),e.getTracks(n.stream,"video").forEach(function(e){n.stream.removeTrack(e)}))}),videoConnection.leave())},this.setMute=function(e){socket.emit(connection.socketCustomEvent,{type:"forceAudioMuted",role:role,tenant:tenant,sessionId:e,roomId:roomId})},this.setMuteAll=function(){socket.emit(connection.socketCustomEvent,{type:"forceAudioMutedAll",role:role,tenant:tenant,roomId:roomId})},this.setDelete=function(e){socket.emit(connection.socketCustomEvent,{type:"forceDelete",role:role,tenant:tenant,sessionId:e,roomId:roomId})},this.setClose=function(){forceClose=!0,connection.closeEntireSession()},this.setPresentUser=function(e,n){socket.emit(connection.socketCustomEvent,{type:"setPresent",role:role,tenant:tenant,present:n,sessionId:e,roomId:roomId})},this.setDeleteAll=function(e){socket.emit(connection.socketCustomEvent,{type:"forceDeleteAll",role:role,tenant:tenant,sessionId:e,roomId:roomId})},this.revokePriveleges=function(e){socket.emit(connection.socketCustomEvent,{type:"revokePriveleges",role:role,tenant:tenant,sessionId:e,roomId:roomId})},this.blockUser=function(e){socket.emit(connection.socketCustomEvent,{type:"blockUser",role:role,tenant:tenant,sessionId:e,roomId:roomId})},this.endMeeting=function(e){socket.emit(connection.socketCustomEvent,{type:"endMeeting",role:role,tenant:tenant,sessionId:e,roomId:roomId})},this.toVideo=function(){socket.emit(connection.socketCustomEvent,{type:"toVideo",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.grantPriveleges=function(e){socket.emit(connection.socketCustomEvent,{type:"grantPriveleges",role:role,tenant:tenant,sessionId:e,roomId:roomId})},this.getScreenStreamConnections=function(){return!!screenConnection&&screenConnection.getAllParticipants().length>0},this.startRecording=function(){socket.emit(connection.socketCustomEvent,{type:"startRecording",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.stopRecording=function(){socket.emit(connection.socketCustomEvent,{type:"stopRecording",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})},this.setCallerInfo=function(e,n){socket.emit(connection.socketCustomEvent,{type:"setCallerInfo",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId,callerInfo:e,isAdmin:n}),connection.extra={role:role,name:name,tenant:tenant,sessionId:sessionId,roomId:roomId,isAdmin:queryString.isAdmin||"admin"==role?1:0,pass:requirePassComm,callerInfo:e}},this.sendCallerBack=function(e,n){socket.emit(connection.socketCustomEvent,{type:"sendCallerBack",role:role,tenant:tenant,sessionId:n,roomId:roomId,access:e})},this.handleScreenShareTermination=function(){if(queryString.broadcast||!svConfigs.videoScreen.separateScreenShare){if(n)return;n=!0,RMCMediaTrack.cameraStream&&(e.getTracks(RMCMediaTrack.cameraStream,"video")[0].readyState&&(e.getTracks(RMCMediaTrack.cameraStream,"video").forEach(function(e){RMCMediaTrack.cameraStream.getVideoTracks()[0].stop(),RMCMediaTrack.cameraStream.removeTrack(e)}),RMCMediaTrack.cameraStream.addTrack(RMCMediaTrack.cameraTrack)),RMCMediaTrack.selfVideo.srcObject=RMCMediaTrack.cameraStream,e.replaceTrack(RMCMediaTrack.cameraTrack),videoConnection.attachStreams=[RMCMediaTrack.cameraStream]);var o=jQEngager.Event("ScreenShareEnded");jQEngager(document).trigger(o)}else{if(!screenConnection)return;screenConnection&&screenConnection.streamEvents.selectAll({local:!0}).forEach(function(e){e.stream.getVideoTracks()[0].stop()}),screenConnection.attachStreams.forEach(function(e){e.stop()}),screenConnection.isInitiator=!1,screenConnection.extra={sessionId:null},screenConnection.closeSocket()}},this.addLocalChat=function(e,n,o){e&&e.replace(/ /g,"").length&&(connection.send({chatMessage:e,privateId:o,date:n,sessionId:sessionId}),connection.send({typing:!1}))},this.sendTranslateMessage=function(e){e&&e.replace(/ /g,"").length&&connection.send({translateMessage:e,sessionId:sessionId})},this.sendTyping=function(e){e?connection.send({typing:!0}):connection.send({typing:!1})},this.getFileHTML=function(e){return'<a href="'+(e.url||URL.createObjectURL(e))+'" target="_blank" download="'+e.name+'">Download: <b>'+e.name+"</b></a>"},this.getFullName=function(e){var n=e;return connection.peers[e]&&connection.peers[e].extra&&connection.peers[e].extra.userFullName&&(n=connection.peers[e].extra.userFullName),n},this.sendFile=function(e){recentFile=e,connection.getAllParticipants().length>=1&&(recentFile.userIndex=0,connection.send(recentFile,connection.getAllParticipants()[recentFile.userIndex]))},this.setWhiteboardTools=function(){lsDesigner&&(lsDesigner.destroy(),lsDesigner=null),e.startWhiteboard()},this.whiteboardTools=function(){lsDesigner.setSelected("pencil"),lsDesigner.setTools({line:!0,arrow:!0,pencil:!0,marker:!0,dragSingle:!0,dragMultiple:!0,eraser:!0,pdf:!0,rectangle:!0,arc:!0,text:!0,image:!0,zoom:!0,lineWidth:!0,colorsPicker:!0,extraOptions:!0,undo:!0}),lsDesigner.icons={pencil:lsRepUrl+"img/whiteboard/pencil.png",marker:lsRepUrl+"img/whiteboard/brush.png",eraser:lsRepUrl+"img/whiteboard/eraser.png",text:lsRepUrl+"img/whiteboard/text.png",image:lsRepUrl+"img/whiteboard/image.png",dragSingle:lsRepUrl+"img/whiteboard/dragSingle.png",dragMultiple:lsRepUrl+"img/whiteboard/dragMultiple.png",line:lsRepUrl+"img/whiteboard/line.png",arrow:lsRepUrl+"img/whiteboard/arrow.png",pdf:lsRepUrl+"img/whiteboard/pdf.png",zoom_in:lsRepUrl+"img/whiteboard/zoom_in.png",zoom_out:lsRepUrl+"img/whiteboard/zoom_out.png",arc:lsRepUrl+"img/whiteboard/arc.png",rectangle:lsRepUrl+"img/whiteboard/rectangle.png",lineWidth:lsRepUrl+"img/whiteboard/lineWidth.png",undo:lsRepUrl+"img/whiteboard/undo.png",colorsPicker:lsRepUrl+"img/whiteboard/colorsPicker.png",extraOptions:lsRepUrl+"img/whiteboard/extraOptions.png"}},this.initHark=function(e){if(!window.hark)throw"Please link hark.js";var n=e.connection,o=e.streamedObject,t=hark(e.stream,{});t.on("speaking",function(){n.onspeaking(o)}),t.on("stopped_speaking",function(){n.onsilence(o)})},this.startWhiteboard=function(){if(!lsDesigner){(lsDesigner=new CanvasDesigner).widgetHtmlURL=lsRepUrl+"pages/whiteboard.html",lsDesigner.widgetJsURL=lsRepUrl+"js/whiteboard.widget.js",queryString.isAdmin||svConfigs.whiteboard.allowAnonymous||localStorage.getItem("hasPrivileges")?(e.whiteboardTools(),lsDesigner.addSyncListener(function(e){connection.send({width:screen.width,whiteboardData:e})})):(lsDesigner.setTools({}),lsDesigner.setSelected("")),lsDesigner.pointsLength<=0&&setTimeout(function(){connection.send("plz-sync-points")},1e3);var n=document.getElementById("whiteboard_canvas");lsDesigner.appendTo(n)}setTimeout(function(){lsDesigner.sync()},2e3)},this.clearCanvas=function(){lsDesigner?(lsDesigner.clearCanvas(),socket.emit(connection.socketCustomEvent,{type:"clearCanvas",role:role,tenant:tenant,sessionId:sessionId,roomId:roomId})):e.startWhiteboard(),setTimeout(function(){lsDesigner.sync()},2e3)},this.showStatusBar=function(e,n){jQEngager("#statusbar").html(e),jQEngager("#statusbar").show(),"Connected to the chat server!"==e?jQEngager("#statusIcon").html('<i class="fas fa-fw fa-check-circle" id="statusOk"></i>'):jQEngager("#statusIcon").html('<i class="fas fa-fw fa-times-circle" id="statusNotOk"></i>'),setTimeout(function(){jQEngager("#statusbar").hide()},n)}},uiHandler=function(){var e,n,o=this;this.init=function(o,t,i){e=o,t,n=i},this.setMobileChatOnly=function(){(isAndroid||isiPhone)&&e(".wd-v-share").hide(),o.displayChatOnly()},this.setVideoBoxOff=function(n){audio_on=!1,video_on=!1,o.setMuteButton(),o.setVideoButton(),e("#wd-widget-content-"+n+" .wd-video-box-on").hide(),e("#wd-widget-content-video-ringing").hide(),e("#wd-widget-content-video-waiting").hide(),e("#unsupported_div").show()},this.toggleHeaderChat=function(n){e(".header-auido-video").hide()},this.displayScreenShare=function(){svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat?(e(".wd-chat-box").show(),e(".wd-video-box").css("width","70%"),e(".wd-chat-box").css("width","30%")):(e(".wd-chat-box").hide(),e(".wd-video-box").css("width","100%"),e(".wd-video-box").css("border-right",0)),e(".wd-avatar-agent").hide(),e("#mainleft_div").show(),e("#wd-widget-content-whiteboard").hide(),e("#wd-widget-content-video").show()},this.displayVideoOnly=function(){"simple"==conferenceStyle&&svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat?(e(".wd-chat-box").show(),e(".wd-video-box").css("width","70%"),e(".wd-chat-box").css("width","30%")):(e(".wd-chat-box").hide(),e(".wd-video-box").css("width","100%"),e(".wd-video-box").css("border-right",0)),e("#mainleft_div").show(),e("#wd-widget-content-whiteboard").hide(),e("#wd-widget-content-video").show(),e("."+classVideo).each(function(){var n=this.id;e("#"+n).detach().appendTo("#"+videoElementContainer),e("#"+n).removeClass("smallvideo")})},this.displayChatOnly=function(){n.getStream(n.getRemoteSessionId())?(e("#call_audio_video").hide(),e("#slide_video").show()):(e("#slide_video").hide(),svConfigs.videoScreen&&(!1===svConfigs.videoScreen.onlyAgentButtons||queryString.isAdmin)&&e("#call_audio_video").show()),svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat?e(".wd-v-text").hide():e(".wd-v-text").show(),e("#mainleft_div").hide(),e(".wd-chat-box").show(),e(".wd-chat-box").css("width","100%"),e("#wd-widget-content-whiteboard").hide()},this.restoreVideoBox=function(){"conference"==conferenceStyle?(e("#wd-widget-content-greenroom").hide(),e("#wd-widget-content-prev").hide(),isAndroid||isiPhone||(stopFullScreenPopup(),e("#invideo").attr("style","")),e("#invideo").show(),e(".wd-video-c").hide()):(e("#call_audio_video").hide(),isAndroid||isiPhone||(stopFullScreenPopup(),e("#mainleft_div").attr("style","")),e("#mainleft_div").show())},this.syncVideoChatPanelsPos=function(){var n=e("#newdev_video"),o=e("#newdev_chat");e("#newdev_video").is(":visible")?(panel_xpos=n.css("left"),panel_ypos=n.css("top"),o.css("left",panel_xpos),o.css("top",panel_ypos)):e("#newdev_chat").is(":visible")&&(panel_xpos=o.css("left"),panel_ypos=o.css("top"),n.css("left",panel_xpos),n.css("top",panel_ypos))},this.setScreenDisabled=function(n){n?(e(".wd-v-share").addClass("disabled"),e("#screenshare_div").addClass("disabled"),"simple"==conferenceStyle?e("."+classVideo).each(function(){var n=this.id;e("#"+n).detach().appendTo("#small_video"),e("#"+n).addClass("smallvideo")}):e(".bigvideo").hide()):(e(".wd-v-share").removeClass("disabled"),e("#screenshare_div").removeClass("disabled"),"simple"==conferenceStyle?e("."+classVideo).each(function(){var n=this.id;e("#"+n).detach().appendTo("#"+videoElementContainer),e("#"+n).removeClass("smallvideo")}):(e(".bigvideo").show(),e(".sourcevideo").show()))},this.setDisabled=function(n){n?(e("#raisehand_div").addClass("disabled"),e("#exit_meeting").addClass("disabled"),e("#call_video").addClass("disabled"),e("#call_audio").addClass("disabled"),e("#file_transfer").addClass("disabled"),e("#startscreenshare").addClass("disabled"),e("#callButton_1").addClass("disabled"),e("#callAudioButton_1").addClass("disabled"),e("#newdev_chat_message1").addClass("disabled"),e("#whiteboard").addClass("disabled"),e("#startVideoButton").addClass("disabled"),e(".startVideoButton").addClass("disabled"),e("#answer_call_button").addClass("disabled"),e("#answer_audiocall_button").addClass("disabled"),e("#reject_call_button").addClass("disabled"),e(".wd-v-share").addClass("disabled")):(e("#raisehand_div").removeClass("disabled"),e("#exit_meeting").removeClass("disabled"),e("#call_video").removeClass("disabled"),e("#call_audio").removeClass("disabled"),e("#startscreenshare").removeClass("disabled"),e("#file_transfer").removeClass("disabled"),(queryString.room||queryString.broadcast)&&e("#callButton_1").removeClass("disabled"),queryString.room&&e("#callAudioButton_1").removeClass("disabled"),e("#newdev_chat_message1").removeClass("disabled"),e("#whiteboard").removeClass("disabled"),e("#startVideoButton").removeClass("disabled"),e(".startVideoButton").removeClass("disabled"),e("#answer_call_button").removeClass("disabled"),e("#answer_audiocall_button").removeClass("disabled"),e("#reject_call_button").removeClass("disabled"),e(".wd-v-share").removeClass("disabled"))},this.toggleWidget=function(){e("#nd_widget_content").toggle(),e(".agent-address-wd").hide(),e("#peer_email_video").toggle(!1)},this.toggleVisitors=function(n){e("#nd_widget_visitors").toggle(n)},this.setAgentOnlyButtons=function(){e(".wd-v-pickupaudio").hide(),e(".wd-v-pickup").hide(),e(".wd-v-share").hide(),e(".header-auido-video").hide(),e("#screenshareLi").hide(),e("#snapshotLi").hide(),e("#recordingLi").hide(),e("#whiteboardLi").hide(),e("#cameraSwitch").hide()},this.disableScreenShare=function(){e(".wd-v-share").hide(),e("#startscreenshare").hide()},this.disableVideo=function(){e("#startVideoButton").hide(),e(".wd-v-pickup").hide(),e("#call_video").hide(),e("#answer_call_button").hide(),e(".muteVideo").prop("checked",!0),e(".muteVideo").hide(),e(".turnOffCamera").hide()},this.disableAudio=function(){e(".wd-v-pickupaudio").hide(),e("#call_audio").hide(),e("#answer_audiocall_button").hide(),e(".muteAudio").prop("checked",!0),e(".muteAudio").hide(),e(".muteMe").hide()},this.disableWhiteboard=function(){e("#whiteboard").hide()},this.disableTransfer=function(){e("#file_transfer").hide()},this.setVideoBox=function(){e("#recordingIcon").hide(),e("#newdev_video").show(),e("#mainleft_div").children().hide(),e("#video_container").show(),e("#video_container_oneway").hide(),e("#video_container_oneway_agent").hide(),e(".wd-v-nosound").removeClass("disabledDiv"),e("#video_back").show()},this.setOneWay=function(){e("#localVideo").hide(),e("#video_container_oneway").show(),e("#local_video_div").hide(),e(".wd-v-video").attr("class","wd-v-novideo"),e(".wd-v-novideo").addClass("disabledDiv"),e(".wd-v-sound").attr("class","wd-v-nosound"),e(".wd-v-nosound").addClass("disabledDiv")},this.togglePermissionError=function(){o.syncVideoChatPanelsPos(),o.togglePermissionWidget(!1),o.setVideoBox(),e("#permission_browsers_error").children().hide(),isChrome&&e("#permission_div_error_chrome").show(),isFirefox&&e("#permission_div_error_firefox").show(),e("#wd-widget-error").show(),o.setVideoButton()},this.toggleInstaWhiteboard=function(){window.resizeTo(window.screen.availWidth,window.screen.availHeight),stopIncomingCall(),o.syncVideoChatPanelsPos(),e("#mainleft_div").show(),"simple"==conferenceStyle&&svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat?(e(".wd-chat-box").show(),e(".wd-chat-box").css("width","30%"),e(".wd-video-box").css("width","70%"),e(".wd-video-box").css("border-right",0),e(".wd-v-text").hide()):(e(".wd-chat-box").hide(),e(".wd-video-box").css("width","100%"),e(".wd-video-box").css("border-right",0),e(".wd-v-text").show()),e("#wd-widget-content-whiteboard").show(),e("#wd-widget-content-chat-main").hide(),e("#wd-widget-content-video").hide(),e("#wd-avatar-agent").hide(),e("#video_container_chat").hide(),queryString.isAdmin||localStorage.getItem("hasPrivileges")?(e(".wd-v-tovideo").show(),e("#cleanCanvas").show(),e("#downloadCanvas").show(),e("#whiteboard_canvas iframe").contents().find("#tool-box").show()):e("#whiteboard_canvas iframe").contents().find("#tool-box").hide(),e("."+classVideo).each(function(){var n=this.id;e("#"+n).detach().appendTo("#whiteboard_video"),e("#"+n).addClass("smallvideo")}),e(".bigvideo").each(function(){var n=this.id;e("#"+n).detach().appendTo("#whiteboard_video"),e("#"+n).addClass("smallvideo")}),e(".broadcastvideo").each(function(){e(this).detach().appendTo("#whiteboard_video"),e(this).addClass("smallvideo")})},this.toggleInstaChat=function(){stopIncomingCall(),window.outerHeight==screen.availHeight&&void 0!==widgetSize?stopFullScreenPopup():stopFullScreen(),e(".wd-video-c").removeClass("disabled"),o.syncVideoChatPanelsPos(),o.togglePermissionWidget(!0),o.setVideoBox(),e("#recordingIcon").hide(),e("#wd-widget-content-chat-main").show(),e("#wd-avatar-agent").show(),svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat?e(".wd-v-text").hide():e(".wd-v-text").show(),e(".wd-v-recording").hide(),e("#video_container_chat").hide(),e("#wd-widget-content-whiteboard").hide(),o.setVideoButton(),o.setMuteButton()},this.onIncomingVideo=function(){o.restoreVideoBox()},this.toggleRinging=function(n){o.setMobileChatOnly(),o.displayVideoOnly(),e("#toggle_icon").removeClass("video"),e("#wd-widget-content-video").hide(),e("#wd-widget-content-chat-main").hide(),e("#wd-widget-content-video-waiting").hide(),e("#wd-widget-content-video-ringing").show(),e("#wd-widget-content-whiteboard").hide(),e("#answer_call_button").off(),e("#answer_audiocall_button").off(),e("#reject_call_button").off(),e("#answer_call_button").on("click",function(){video_on=!0,o.setVideoButton(),o.toggleVideoBox(!1),n(!0)}),e("#answer_audiocall_button").on("click",function(){isiPhone?(video_on=!0,video_iphone_on=!1):video_on=!1,o.setVideoButton(),n(!0),o.toggleVideoBox(!1)}),e("#reject_call_button").on("click",function(){n(!1),o.toggleInstaChat()})},this.toggleVideoBox=function(n){stopIncomingCall(),e("#wd-widget-content-chat-main").hide(),e("#wd-widget-content-greenroom").hide(),e("#wd-widget-content-prev").hide(),e("#wd-widget-content-video-ringing").hide(),e("#wd-widget-content-whiteboard").hide(),!0===n?(svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat?(e("#call_audio_video").hide(),e(".wd-v-text").hide()):e(".wd-v-text").show(),e("#wd-widget-content-video").show(),e("#wd-widget-content-video-waiting").hide(),e("."+classVideo).each(function(){var n=this.id;e("#"+n).detach().appendTo("#"+videoElementContainer),e("#"+n).removeClass("smallvideo")})):4==n?(e(".wd-chat-box").hide(),e(".wd-video-box").css("width","100%"),e(".wd-video-box").css("border-right",0),e("#wd-widget-content-greenroom").show(),e("#wd-widget-content-video").hide(),e("#wd-widget-content-video-waiting").hide()):(e("#wd-widget-content-video").hide(),e("#wd-widget-content-video-waiting").show(),"simple"==conferenceStyle&&svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat?(e(".wd-chat-box").show(),e(".wd-video-box").css("width","70%"),e(".wd-chat-box").css("width","30%")):(e(".wd-chat-box").hide(),e(".wd-video-box").css("width","100%"),e(".wd-video-box").css("border-right",0)))},this.setWidgetValues=function(){e("#peer_name_video").html(peer_name),e(".peer_name_video").html(peer_name),e("#peer_name_chat").html(peer_name),e(".dw-chat-avatar").attr("src",peer_avatar),e("#peer_email_video").html(peer_email),e("#peer_email_chat").html(peer_email),e(".agent-address-wd a").attr("href","mailto:"+peer_email),e("#peer_phone_video").html(peer_phone),e("#peer_phone_chat").html(peer_phone);var n=getCurrentTime();e("#timestamp").html(n),peer_avatar?e("#nd_widget_content .peer_avatar").attr("src",peer_avatar):e("#nd_widget_content .peer_avatar").attr("src",lsRepUrl+"img/small-avatar.jpg");var o=document.querySelector(".bg-site4");peer_background&&null!=o&&(o.style.background="url("+peer_background+") no-repeat center center",o.style.backgroundSize="cover"),peer_logo&&(e("#nd_widget_content .firm-logo-wd img").attr("src",peer_logo),e("#nd_widget_content .firm-logo-wd img").width(100),e("#nd_widget_content .firm-logo-wd img").height("auto")),e("#popup_widget_text").html(popup_message)},this.toggleInstaVideo=function(e){o.syncVideoChatPanelsPos(),o.setMuteButton(),o.setVideoBox(),o.setVideoButton(),o.toggleVideoBox(e)},this.togglePermissionWidget=function(n,t,i){isAndroid||(n?(t?e("#wd-widget-content-video-waiting").show():e("#wd-widget-content-video-waiting").hide(),e("#permission_div").hide()):(e("#wd-widget-content-chat-main").hide(),e("#wd-widget-content-video-waiting").hide(),o.permissionDisplay()))},this.permissionDisplay=function(){var n=video_on?"video":"";e("#permission_browsers").children().hide(),e("#permission_div_span").show(),isChrome?e("#permission_div_chrome"+n).show():isFirefox?e("#permission_div_firefox"+n).show():isIEA?e("#permission_div_ie"+n).show():isSafariA||isiPhone?e("#permission_div_safari"+n).show():e("#permission_div_default"+n).show(),e("#permission_div_span").html(smartVideoLocale.msgStore.allowMicCamera),e("#wd-widget-content-video-waiting").hide(),e("#permission_div").show()},this.resetCallHoldState=function(){e("#on_hold").hide()},this.setMuteButton=function(){audio_on?(e(".wd-v-nosound").attr("class","wd-v-sound"),e(".fa-microphone-slash").closest("a").addClass("active")):(e(".wd-v-sound").attr("class","wd-v-nosound"),e(".fa-microphone-slash").closest("a").removeClass("active"))},this.setRecordingUi=function(n){n?(e(".wd-v-recording").removeClass("recording-off"),e(".wd-v-recording").addClass("recording-on"),e("#startRecording").addClass("active")):(e(".wd-v-recording").removeClass("recording-on"),e(".wd-v-recording").addClass("recording-off"),e("#startRecording").removeClass("active"))},this.setScreenButton=function(n){!isChrome&&!isFirefox||isAndroid||isiPhone||(n?(e(".wd-v-share").hide(),e(".wd-v-stopshare").show(),e("#startscreenshare").hide(),e("#screensharestop_div").show()):(e(".wd-v-share").show(),e(".wd-v-stopshare").hide(),e("#screensharestop_div").hide(),e("#startscreenshare").show()))},this.setVideoButton=function(){video_on?(e("#local_video_div").show(),e(".wd-v-novideo").attr("class","wd-v-video"),e(".fa-video-camera").closest("a").addClass("active")):(e("#local_video_div").hide(),e(".wd-v-video").attr("class","wd-v-novideo"),e(".fa-video-camera").closest("a").removeClass("active"))},this.showTranslateMessage=function(n){e("#translate_message").css("width",e(".bigvideo.bigvideoadd").css("width")),e("#translate_message").css("bottom",e(".bigvideo.bigvideoadd").css("bottom")),e("#translate_message").show(),e("#translate_message").html(n)},this.setLocalRemote=function(n){e("#localVideo").removeClass("localvideo"),e("#localVideo").addClass(classVideo)},this.setRemoteLocal=function(n){e("#localVideo").removeClass(classVideo),e("#localVideo").addClass("localvideo")},this.changeSpanPostition=function(n){e("#remoteVideoSpan"+n).remove(),setTimeout(function(){var o=e(e("#"+n)).position();if(o&&"localVideo"!=n){var t=names[n]?names[n].name:peer_name,i=e("<h2 />",{id:"remoteVideoSpan"+n,class:"sourcevideospan"});i.css("left",o.left),i.css("top",o.top),i.appendTo($("#video_container_small")),i.html(t)}},0)},this.makeAllSmall=function(){e(".bigvideo").each(function(){if(e(this).is(":visible")&&"conference"===svConfigs.videoScreen.videoContainerStyle){var n=e(this).attr("id");e("#"+n).detach().appendTo("#video_container_small"),e("#"+n).removeClass("bigvideo"),e("#"+n).removeClass("bigvideoadd"),e("#"+n).addClass("sourcevideo")}}),o.changeSpanPositions()},this.makeAllSmallGrid=function(){e(".bigvideogrid").each(function(){if(e(this).is(":visible")&&"conference"===svConfigs.videoScreen.videoContainerStyle){var n=e(this).attr("id");e("#remoteVideoSpan"+n).remove(),e("#"+n).detach().appendTo("#video_container_small"),e("#"+n).removeClass("bigvideogrid"),e("#"+n).removeClass("bigvideoadd"),e("#"+n).addClass("sourcevideo")}}),o.changeSpanPositions()},this.changeSpanPositions=function(){e(".sourcevideospan").remove(),"list"==currentView?(e(".bigvideo").each(function(){if(e(this).is(":visible")&&"conference"===svConfigs.videoScreen.videoContainerStyle){var n=e(this).attr("id");o.changeSpanPostition(n)}}),e(".sourcevideo").each(function(){if(e(this).is(":visible")&&"conference"===svConfigs.videoScreen.videoContainerStyle){var n=e(this).attr("id");o.changeSpanPostition(n)}})):e(".bigvideogrid").each(function(){var n=e(this).attr("id");e("#"+n).css("height","98%"),o.changeSpanPostition(n)})},this.makeBig=function(){e(".sourcevideo").each(function(){var o=e(this).attr("id");e("#fullScreen").show(),e("#"+o).detach().appendTo("#video_container"),e("#"+o).removeClass("sourcevideo"),e("#"+o).addClass("bigvideo"),e("#"+o).addClass("bigvideoadd"),n.getVideoSessions()>1?(e("#"+o).css("height","85%"),e("#"+o).css("height","85%")):(e("#"+o).css("height","98%"),e("#"+o).css("height","98%"))}),o.changeSpanPositions()},this.makeBigGrid=function(){e(".sourcevideo").each(function(){var n=e(this).attr("id");e("#"+n).css("height","98%"),e("#"+n).css("height","98%"),e("#remoteVideoSpan"+n).remove(),e("#fullScreen").show(),e("#"+n).detach().appendTo("#video_container_small"),e("#"+n).removeClass("sourcevideo"),e("#"+n).addClass("bigvideogrid"),e("#"+n).addClass("bigvideoadd")}),o.changeSpanPositions()},this.changeView=function(n){var t=!1;function i(){e(".fa-th-large").closest("a").addClass("active"),currentView="grid",o.makeAllSmall(),e("#video_container_small").removeClass("video_container_small"),e("#video_container_small").addClass("video_container_grid"),e("#localVideo").detach().appendTo("#video_container_small"),e("#localVideo").prependTo("#video_container_small"),e("#localVideo").removeClass("localvideo"),e("#localVideo").removeClass("localvideo"),e("#localVideo").addClass("bigvideogrid"),e("#localVideo").addClass("bigvideoadd"),o.makeBigGrid()}function r(){e(".fa-th-large").closest("a").removeClass("active"),currentView="list",o.makeAllSmallGrid(),e("#localVideo").detach().appendTo("#local_video_div"),e("#video_container_small").removeClass("video_container_grid"),e("#video_container_small").addClass("video_container_small"),e("#localVideo").addClass("localvideo"),e("#localVideo").removeClass("bigvideogrid"),e("#localVideo").removeClass("bigvideoadd"),e("#localVideo").removeClass("sourcevideo"),o.makeAllSmall()}"list"==currentView?n?i():r():n?r():i(),$("video").off("click"),$("video").on("click",function(){var n=$(this).attr("class");if("sourcevideo"==n){var i=e.Event("VoiceSpeaking",{id:this.id});e(document).trigger(i)}else if("bigvideogrid bigvideoadd"==n){t=!0,r();i=e.Event("VoiceSpeaking",{id:this.id});e(document).trigger(i)}else"bigvideo bigvideoadd"==n&&(t?o.changeView(!0):o.makeAllSmall())}),localStorage.setItem("currentView",currentView)}},notifyHandler=function(){var e=this;this.init=function(){e.isNotificationSupported()?"granted"!==Notification.permission&&Notification.requestPermission():console.log("Your browser does not support Notifications.")},jQEngager(document).on("EnterPageNotification",function(n){if(svConfigs.alwaysNotify||!document.hasFocus()){var o=n.name?n.name:"Visitor",t=smartVideoLocale.msgStore.incomingText;t=t.replace("{{caller_name}}",o),e.showNotification(t)}}),jQEngager(document).on("EnterCustomerNotification",function(n){if(svConfigs.alwaysNotify||!document.hasFocus()){var o=n.name?n.name:"Visitor",t=smartVideoLocale.msgStore.userWaitingRoom;t=(t=t.replace("{{user}}",o)).replace("{{room}}",n.roomId),e.showNotification(t)}}),jQEngager(document).on("IncomingCall",function(n){!svConfigs.alwaysNotify&&document.hasFocus()||e.showNotification("Visitor is calling you.")}),this.showNotification=function(n){if(e.isNotificationSupported())if("granted"===Notification.permission){var o=new Notification(n,{icon:lsRepUrl+"/img/logo.png",body:smartVideoLocale.msgStore.clickOpenPage,vibrate:[500,110,500,110,500]});o.onclick=function(){try{window.focus()}catch(e){console.log(e)}},setTimeout(o.close.bind(o),1e4)}else"denied"!==Notification.permission&&Notification.requestPermission().then(function(e){"granted"===e&&(o=new Notification("Hi there!"))});else console.log("Your browser does not support Notifications. Use Latest Chrome/Safari to save the world.")},this.requestPermissions=function(){"granted"!==Notification.permission&&Notification.requestPermission()},this.isNotificationSupported=function(){return"Notification"in window}},popup_instance=null,names=[],popup_message="",widgetSize={width:750,height:564},video_on=!0,audio_on=!0,isOnline=!1,roomAllow=!0,remoteVideoSessions=0,inCall=[],videoCurrentId=0,audioCurrentId=0,audioOutputCurrentId=0,startNextCamera=!1,requirePass=!1,timerVars=[],startedRecroding=!1,is_widget_opened=!1,is_callerback=!1,is_chat_opened=!1,isLsvAdmin=!1,currentView="list",recordingWidth=360,recordingHeight=240,main=function(){jQEngager=jQuery;var e=document.currentScript||document.getElementById("newdev-embed-script");if(null==e||null==e){var n=document.getElementsByTagName("script"),o=n.length-1;e=n[o]}jQuery(document).ready(function(n){if(room=e.getAttribute("data-room_id")?e.getAttribute("data-room_id"):queryString.room,lsRepUrl=e.getAttribute("data-source_path"),agentAvatar=peer_avatar=e.getAttribute("data-avatar")?e.getAttribute("data-avatar"):lsRepUrl+"img/small-avatar.jpg",agentName=peer_name=e.getAttribute("data-names")?e.getAttribute("data-names"):svConfigs.agentName,visitorName=e.getAttribute("data-visitorName")?e.getAttribute("data-visitorName"):"",passRoom=e.getAttribute("data-pass")?e.getAttribute("data-pass"):passRoom,datetime=e.getAttribute("data-datetime")?e.getAttribute("data-datetime"):"",duration=e.getAttribute("data-duration")?e.getAttribute("data-duration"):"",agentId=e.getAttribute("data-agentId")?e.getAttribute("data-agentId"):"",isLsvAdmin=e.getAttribute("data-isAdmin")?e.getAttribute("data-isAdmin"):queryString.isAdmin,svConfigs.recording.recordingConstraints&&(recordingWidth=svConfigs.recording.recordingConstraints.width,recordingHeight=svConfigs.recording.recordingConstraints.height),(comm_controller=new comController).init("popup",room),(notify_handler=new notifyHandler).init(),localStorage.getItem("prd")){var o=localStorage.getItem("prd");o=JSON.parse(o),queryString.isAdmin?agentName=agentName||o.name:visitorName=visitorName||o.name}localStorage.getItem("facingMode")&&(facingMode=localStorage.getItem("facingMode")),localStorage.setItem("facingMode",facingMode),localStorage.getItem("currentView")&&(currentView=localStorage.getItem("currentView")),localStorage.setItem("currentView",currentView),token=queryString.token?queryString.token:"",disableVideo=!!e.getAttribute("data-disableVideo"),disableAudio=!!e.getAttribute("data-disableAudio"),disableScreenShare=!!e.getAttribute("data-disableScreenShare"),disableWhiteboard=!!e.getAttribute("data-disableWhiteboard"),disableTransfer=!!e.getAttribute("data-disableTransfer"),autoAcceptVideo=!!e.getAttribute("data-autoAcceptVideo"),autoAcceptAudio=!!e.getAttribute("data-autoAcceptAudio"),"conference"==conferenceStyle&&(widgetSize={width:800,height:600}),svConfigs.serverSide&&svConfigs.serverSide.agentInfo&&agentId&&n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"getagent",tenant:agentId}}).done(function(e){e&&(e=JSON.parse(e),agentName=e.first_name+" "+e.last_name)}).fail(function(){}),(isiPhone||isAndroid)&&(svConfigs.videoScreen.chat=!1),svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat&&(widgetSize.width=1052);var t=n("<div>",{class:"nd-widget-container_lead",id:"newdev-widget"});n(document).on("AdminPopupOffline",function(e){isOnline=!1}),n(document).on("VisitorsRoom",function(e){visitors=e.count}),n(window).on("unload",function(){f()}),n(window).on("resize",function(){ui_handler.changeSpanPositions()});var i=function(e){if(names[e.sessionId]||(names[e.sessionId]={}),e.callerInfo.name&&names[e.sessionId]&&names[e.sessionId].name!==e.callerInfo.name){if(names[e.sessionId].username)var o=names[e.sessionId].username;names[e.sessionId]={name:e.callerInfo.name,email:e.callerInfo.email},o&&(names[e.sessionId].username=o),e.callerInfo.isAdmin&&agentName&&(names[e.sessionId].name=agentName),n("#peer_name_chat").text(names[e.sessionId].name),function(e){var o=smartVideoLocale.msgStore.incomingText;if(o&&names[e.sessionId]&&n("#incoming_text").html(o.replace("{{caller_name}}",names[e.sessionId].name)),e.sessionId!==comm_controller.getSessionId()){var t=smartVideoLocale.msgStore.joinedChat;if(t&&-1==names[e.sessionId].name.indexOf(svConfigs.anonVisitor)){var i=t.replace("{{caller_name}}",names[e.sessionId].name);svConfigs.videoScreen&&svConfigs.videoScreen.waitingRoom?toggleError(i,5e3):(showMessage("",i,null,"joinedChat"),svConfigs.serverSide.chatHistory&&saveChat(i,"","joinedChat",agentId,"",names))}}}(e)}var t=e.callerInfo.avatar?e.callerInfo.avatar:lsRepUrl+"img/small-avatar.jpg";names[e.sessionId]&&(names[e.sessionId].avatar=t,names[e.sessionId].priv=e.callerInfo.priv,e.callerInfo.username&&(names[e.sessionId].username=e.callerInfo.username)),names[e.sessionId].muted=e.callerInfo.muted,names[e.sessionId].video=e.callerInfo.video,names[e.sessionId].isAdmin=!!e.callerInfo.isAdmin&&e.callerInfo.isAdmin,e.callerInfo.isAdmin&&agentName&&(names[e.sessionId].name=agentName),n(".dw-chat-avatar").attr("src",t),"conference"!==conferenceStyle&&n(".direct-chat-img left "+guestName(e.callerInfo.name)).attr("src",t),u(),r()},r=function(){if("conference"==conferenceStyle){n("#attendeesList").empty();var e=0;for(var o in names){var t="";o==comm_controller.getSessionId()&&(t=" (Me) ");var i="",a="",s="",d=n("ul#attendeesList");if("undefined"!==names[o].muted)if(1==names[o].muted)i='<i class="fa fa-microphone-slash"></i> ',a="";else if(a="",i='<i class="fa fa-microphone"></i> ',o!==comm_controller.getSessionId())a='<span class="user-action"><a data-typeid="'+o+'" href="#" id="muteAttendee'+o+'"><i class="fa fa-fw fa-volume-off"></i> '+smartVideoLocale.msgStore.mute+"</a></span>";else a='<span class="user-action"><a data-typeid="'+o+'" href="#" id="muteAllAttendee"><i class="fa fa-fw fa-volume-off"></i> '+smartVideoLocale.msgStore.muteAll+"</a></span>";if("undefined"!==names[o].muted&&names[o].video&&(s='<i class="fa fa-tv"></i> '),o!==comm_controller.getSessionId())var c=' <span class="user-action"><a data-typeid="'+o+'" href="#" id="private'+o+'"><i class="fa fa-comment"></i> '+smartVideoLocale.msgStore.privateChat+"</a></span>";else c="";if(queryString.isAdmin){var l=blockIcon="";if(queryString.broadcast)if(names[o].priv)l=' <span class="user-action"><a data-typeid="'+o+'" href="#" id="revoke'+o+'"><i class="fa fa-stop-circle-o"></i> '+(f=smartVideoLocale.msgStore.revoke)+"</a></span>";else names[o].raiseHand&&(l=' <span class="user-action"><a data-typeid="'+o+'" href="#" id="grant'+o+'"><i class="fa fa-hand-paper-o"></i> '+(f=smartVideoLocale.msgStore.grant)+"</a></span>");if((svConfigs.serverSide.loginForm||svConfigs.serverSide.token)&&o!==comm_controller.getSessionId()){var u=smartVideoLocale.msgStore.block;blockIcon=' <span class="user-action"><a data-typeid="'+o+'" href="#" id="block'+o+'"><i class="fa fa-stop"></i> '+u+"</a></span>"}n("<li>"+i+s+'<span class="mx-10">'+names[o].name+t+"</span>"+a+c+l+blockIcon+"</li>").appendTo(d),n("#grant"+o).on("click",function(e){for(var o in names)names[o].priv&&(names[o].priv=!1,comm_controller.revokePriveleges(o));names[n(this).attr("data-typeid")].priv=!0,comm_controller.grantPriveleges(n(this).attr("data-typeid"))}),n("#block"+o).on("click",function(e){if(1==confirm(smartVideoLocale.msgStore.sureBlock)){var o=names[n(this).attr("data-typeid")].username?names[n(this).attr("data-typeid")].username:names[n(this).attr("data-typeid")].email;n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"blockuser",username:o}}).done(function(e){}).fail(function(){}),delete names[n(this).attr("data-typeid")],comm_controller.blockUser(n(this).attr("data-typeid")),r(),setTimeout(function(){ui_handler.toggleVisitors(!1),r()},500)}}),n("#revoke"+o).on("click",function(e){names[n(this).attr("data-typeid")].priv=!1,comm_controller.revokePriveleges(n(this).attr("data-typeid")),setTimeout(function(){ui_handler.toggleVisitors(!1),r()},500)}),n("#muteAttendee"+o).on("click",function(e){comm_controller.setMute(n(this).attr("data-typeid")),setTimeout(function(){ui_handler.toggleVisitors(!1),r()},500)})}else n("<li>"+i+s+'<span class="mx-10">'+names[o].name+t+"</span>"+c+"</li>").appendTo(d);n("#private"+o).on("click",function(e){var o=n(this).attr("data-typeid");n("#visitor_message").show(),n("#send_message_to").html(smartVideoLocale.msgStore.sendMessageTo+names[o].name),n("#private_message_button").off(),n("#private_message_button").on("click",function(){var t=n("#private_message_small").val();S(t,!0,o),n("#private_message_small").val(""),n("#visitor_message").hide(),e.stopPropagation()}),e.stopPropagation()}),o!==comm_controller.getSessionId()&&(peer_avatar=names[o].avatar,peer_name=names[o].name,peer_name_id=o),n("<li><hr/></li>").appendTo(d),e++}e>0?(n(".dw-chat-avatar").show(),n(".dw-chat-avatar").attr("src",peer_avatar),n("#peer_name_chat").html(peer_name),n("#showProfile").show()):(n(".dw-chat-avatar").hide(),n("#peer_name_chat").html(""),n("#showProfile").hide()),n("#muteAllAttendee").on("click",function(){comm_controller.setMuteAll()})}else{n("#visitors").empty();e=0;for(var o in names){if(o!==comm_controller.getSessionId()){var m=n("ul#visitors"),g=n("<li/>").addClass("ui-menu-item").attr("role","menuitem").appendTo(m);if(n("<a/>").addClass("ui-all").attr("typeid",o).text(names[o].name).attr("title",smartVideoLocale.msgStore.sendMessageTo+names[o].name).appendTo(g).click(function(){n(this).attr("typeid")!=comm_controller.getSessionId()&&p(n(this).attr("typeid"))}),queryString.isAdmin&&queryString.broadcast){if(names[o].priv)var f=smartVideoLocale.msgStore.revoke,v=lsRepUrl+"img/revoke.png";else names[o].raiseHand?(f=smartVideoLocale.msgStore.grant,v=lsRepUrl+"img/grant.png"):f="";if(f)n("<img/>").attr("typeid",o).addClass("centerImg").attr("src",v).attr("title",f+" "+names[o].name).appendTo(g).click(function(){n(this).attr("typeid")!=comm_controller.getSessionId()&&(names[n(this).attr("typeid")].priv?(names[n(this).attr("typeid")].priv=!1,comm_controller.revokePriveleges(n(this).attr("typeid"))):(names[n(this).attr("typeid")].priv=!0,comm_controller.grantPriveleges(n(this).attr("typeid")))),setTimeout(function(){ui_handler.toggleVisitors(!1),r()},500)})}if(queryString.isAdmin&&(svConfigs.serverSide.loginForm||svConfigs.serverSide.token)){u=smartVideoLocale.msgStore.block;n("<img/>").addClass("centerImg").attr("typeid",o).attr("title",u+" "+names[o].name).attr("src",lsRepUrl+"img/block.png").appendTo(g).click(function(){1==confirm(smartVideoLocale.msgStore.sureBlock)&&(n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"blockuser",username:names[n(this).attr("typeid")].username}}).done(function(e){console.log("blocked")}).fail(function(){}),delete names[n(this).attr("typeid")],comm_controller.blockUser(n(this).attr("typeid")),r(),setTimeout(function(){ui_handler.toggleVisitors(!1),r()},500))})}}o!==comm_controller.getSessionId()&&(peer_avatar=names[o].avatar,peer_name=names[o].name),e++}}function p(e){n("#visitor_message").show(),n("#send_message_to").html(smartVideoLocale.msgStore.sendMessageTo+names[e].name),n("#private_message_button").off(),n("#private_message_button").on("click",function(){var o=n("#private_message_small").text();S(o,!0,e),n("#visitor_message").hide(),setTimeout(function(){ui_handler.toggleVisitors(!1)},500),n("#private_message_small").text("")})}e>2?(n(".dw-chat-avatar").attr("src",lsRepUrl+"img/listusers.png"),n("#peer_name_chat").html("...")):(n(".dw-chat-avatar").attr("src",peer_avatar),n("#peer_name_chat").html(peer_name))},a=function(){comm_controller.getStream()||(stopIncomingCall(),m(!0),"conference"==conferenceStyle?ui_handler.displayVideoOnly():(inCall=[],n("#localVideo").hide(),n("#video_back").show(),ui_handler.toggleInstaChat(),setTimeout(function(){R(!1)},500)))};function s(e){!function(e,n){var o;o={video:!0},navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(o).then(e).catch(n):navigator.getDisplayMedia(o).then(e).catch(n)}(function(n){!function(e,n){e.addEventListener("ended",function(){n(),n=function(){}},!1),e.addEventListener("inactive",function(){n(),n=function(){}},!1),e.getTracks().forEach(function(e){e.addEventListener("ended",function(){n(),n=function(){}},!1),e.addEventListener("inactive",function(){n(),n=function(){}},!1)})}(n,function(){m(!0),ui_handler.setRecordingUi(!1),comm_controller.stopRecording()}),e(n)},function(e){console.error(e),alert("Unable to capture your screen. Please check console logs.\n"+e)})}function d(e){var n=document.createElement("video");n.autoplay=!0,n.muted=!0,n.srcObject=e,n.style.display="none",(document.body||document.documentElement).appendChild(n)}var c=function(){m(!1),comm_controller.startRecording(),ui_handler.setRecordingUi(!0)},l=function(){if(startedRecroding=!0,comm_controller.startRecording(),ui_handler.setRecordingUi(!0),svConfigs.recording.screen)s(function(e){var n;recordScreen=e,d(e),n=function(n){recordCamera=n,d(n),e.width=window.screen.width,e.height=window.screen.height,e.fullcanvas=!0,n.width=recordingWidth,n.height=recordingHeight,n.top=e.height-n.height,n.left=e.width-n.width,(multiStreamRecorder=RecordRTC([e,n],{type:"video",mimeType:"video/webm",bitsPerSecond:2621440,video:{width:recordingWidth,height:recordingHeight},width:recordingWidth,height:recordingHeight})).startRecording(),recordingTimer=setInterval(c,6e4)},navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(n)});else{if(queryString.isAdmin){var e=[];for(var n in names)if(svConfigs.recording.oneWay){if(n!=comm_controller.getSessionId()){var o=comm_controller.getRemoteStream(n);e.push(o)}}else o=comm_controller.getRemoteStream(n),e.push(o)}(multiStreamRecorder=RecordRTC(e,{type:"video",mimeType:"video/webm",disableLogs:!0,bitsPerSecond:2621440,video:{width:recordingWidth,height:recordingHeight},width:recordingWidth,height:recordingHeight})).startRecording()}},u=function(){if(!is_chat_opened&&(is_chat_opened=!0,svConfigs.serverSide.chatHistory)){if(queryString.isAdmin)for(var e in names)e!==comm_controller.getSessionId()&&(o=e);else var o=comm_controller.getSessionId();n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"getchat",roomId:room,sessionId:o,agentId:agentId}}).done(function(e){e&&JSON.parse(e).forEach(function(e){var n=svConfigs.agentName?svConfigs.agentName:"Agent";if(names[comm_controller.getSessionId()]&&(e.from==names[comm_controller.getSessionId()].name||queryString.isAdmin&&e.from==n))var o="Me";else o=e.from;if(queryString.isAdmin||!e.system){var t=getPrettyDate(e.date_created);showMessage(o,e.message,t,e.system,e.avatar)}})}).fail(function(){console.log(!1)})}},m=function(e){ui_handler.setRecordingUi(!1),comm_controller.stopRecording(),multiStreamRecorder&&multiStreamRecorder.stopRecording(function(){g(e),e&&svConfigs.recording.screen&&(clearInterval(recordingTimer),[recordScreen,recordCamera].forEach(function(e){e.getTracks().forEach(function(e){e.stop()})}))})},g=function(e){if(startedRecroding){var o=URL.createObjectURL(multiStreamRecorder.getBlob());if(svConfigs.recording.download){const e=document.createElement("a");e.style.display="none",e.href=o,e.download="record_"+getCurrentDateFormatted()+".webm",document.body.appendChild(e),e.click(),setTimeout(function(){document.body.removeChild(e)},100)}if(svConfigs.recording.saveServer){if(svConfigs.recording.filename)var t=svConfigs.recording.filename,i=(t=(t=t.replace("%room%",room)).replace("%datetime%",getCurrentDateFormatted()))+".webm";else i="record_"+room+"_"+getCurrentDateFormatted()+".webm";var r=new FormData;r.append("video-filename",i),r.append("video-blob",multiStreamRecorder.getBlob()),r.append("room",room),r.append("agentName",agentName),r.append("agentId",agentId),r.append("isFfmpeg",1==svConfigs.recording.transcode),function(n,o){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(e?(multiStreamRecorder.destroy(),multiStreamRecorder=null):multiStreamRecorder.startRecording())},t.open("POST",n),t.send(o)}(lsRepUrl+"/server/saverecord.php",r),n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"addrecording",roomId:roomId||queryString.room,filename:i,agentId:agentId}}).done(function(e){}).fail(function(){console.log(!1)})}n("#recording_message").show(),n(".recordinglink").attr("href",o),n(".recordinglink").click(function(){n("#recording_message").hide()}),n(".close-but-wd-small").on("click",function(){window.URL.revokeObjectURL(o),n("#recording_message").hide()}),startedRecroding=!1}},f=function(){stopIncomingCall(),"conference"==conferenceStyle?ui_handler.displayVideoOnly():ui_handler.toggleInstaChat(),comm_controller.getStream()&&(m(!0),comm_controller.handleCallTermination(),y()),comm_controller.endCall("hang up call")},v=function(){setCookie("lsvGreenRoom","1"),n("<link>",{rel:"stylesheet",type:"text/css",href:lsRepUrl+"css/cloud.css?v="+currVersion}).appendTo("head"),n("<link>",{rel:"stylesheet",type:"text/css",href:lsRepUrl+"css/sky-forms.css?v="+currVersion}).appendTo("head");var e=n("#videoPreview")[0];audioInputSelect=document.querySelector("select#audioSource"),audioOutputSelect=document.querySelector("select#audioOutput"),videoSelect=document.querySelector("select#videoSource");var o=[audioInputSelect,audioOutputSelect,videoSelect];function t(e){var n=o.map(function(e){return e.value});o.forEach(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)});for(var t=0;t!==e.length;++t){var i=e[t],r=document.createElement("option");r.value=i.deviceId,"audioinput"===i.kind?(r.text=i.label||"microphone "+(audioInputSelect.length+1),r.dataset.icon="fa fa-microphone mr-2",audioInputSelect.appendChild(r)):"audiooutput"===i.kind?(r.text=i.label||"speaker "+(audioOutputSelect.length+1),r.dataset.icon="fa fa-headphones mr-2",audioOutputSelect.appendChild(r)):"videoinput"===i.kind&&(r.dataset.icon="fa fa-video-camera mr-2",r.text=i.label||"camera "+(videoSelect.length+1),videoSelect.appendChild(r))}o.forEach(function(e,o){Array.prototype.slice.call(e.childNodes).some(function(e){return e.value===n[o]})&&(e.value=n[o])}),document.getElementById("audioSource").selectedIndex=audioCurrentId,document.getElementById("audioOutput").selectedIndex=audioOutputCurrentId,document.getElementById("videoSource").selectedIndex=videoCurrentId}audioCurrentId=localStorage.getItem("audioCurrentId")>0?parseInt(localStorage.getItem("audioCurrentId")):0,videoCurrentId=localStorage.getItem("videoCurrentId")>0?parseInt(localStorage.getItem("videoCurrentId")):0,videoSource=localStorage.getItem("videoSource")?localStorage.getItem("videoSource"):void 0,audioOutputCurrentId=localStorage.getItem("audioOutputCurrentId")>0?localStorage.getItem("audioOutputCurrentId"):0;var i=!videoSource||{deviceId:videoSource?{exact:videoSource}:void 0};isIEA&&(i=!0);var r={audio:!0,video:i};function a(n){if(testAudioTrack=n.getAudioTracks()[0],testVideoTrack=n.getVideoTracks()[0],testAudioTrack.enabled=!1,window.stream=n,e.srcObject=n,!isIEA)return e.srcObject=n,navigator.mediaDevices.enumerateDevices()}function s(){window.stream&&window.stream.getTracks().forEach(function(e){e.stop()}),audioSource=audioInputSelect.value,videoSource=videoSelect.value,videoCurrentId=videoSelect.selectedIndex,audioCurrentId=audioInputSelect.selectedIndex,localStorage.setItem("videoCurrentId",videoCurrentId),localStorage.setItem("videoSource",videoSource),localStorage.setItem("audioCurrentId",audioCurrentId);var e={audio:!!audio_on&&{deviceId:audioSource?{exact:audioSource}:void 0},video:{deviceId:videoSource?{exact:videoSource}:void 0}};"undefined"==typeof Promise?navigator.getUserMedia(e,a,d):navigator.mediaDevices.getUserMedia(e).then(a).then(t).catch(d)}function d(e){console.log("navigator.getUserMedia error: ",e)}"undefined"==typeof Promise||navigator.mediaDevices.getUserMedia(r).then(a).then(function(){navigator.mediaDevices.enumerateDevices().then(t).catch(d)}).catch(function e(n){if("NotReadableError"===n.name&&audio_on)audio_on=!1;else{if("OverconstrainedError"!==n.name)return;localStorage.removeItem("videoSource"),localStorage.removeItem("videoCurrentId"),localStorage.removeItem("audioCurrentId");var o={audio:!0,video:!0}}"undefined"==typeof Promise||navigator.mediaDevices.getUserMedia(o).then(a).then(function(){navigator.mediaDevices.enumerateDevices().then(t).catch(d)}).catch(e)}),audioInputSelect&&(audioInputSelect.onchange=s),audioOutputSelect&&(audioOutputSelect.onchange=function(){(audioOutputCurrentId=audioOutputSelect.selectedIndex)>0&&localStorage.setItem("audioOutputCurrentId",audioOutputCurrentId);var n,o,t=audioOutputSelect.value;o=t,void 0!==(n=e).sinkId?n.setSinkId(o).then(function(){}).catch(function(e){var n=e;"SecurityError"===e.name&&(n="You need to use HTTPS for selecting audio output device: "+e),console.error(n),audioOutputSelect.selectedIndex=0}):console.warn("Browser does not support output device selection.")}),videoSelect&&(videoSelect.onchange=s),"simple"==conferenceStyle&&(ui_handler.toggleInstaChat(),ui_handler.restoreVideoBox(),n("#popup_widget_text_videos").show(),ui_handler.toggleInstaVideo(4))},p=function(e){audio_on=!n("#muteAudio").is(":checked"),video_on=!n("#muteVideo").is(":checked"),window.stream&&window.stream.getTracks().forEach(function(e){e.stop()}),ui_handler.restoreVideoBox(),ui_handler.toggleInstaVideo(!1);var o=video_on?"Video":"Audio";comm_controller.initCall(o,e,videoSource,comm_controller.getSessionId(),audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint)},h=function(e,o){if(isOnline)if(x(comm_controller.getSessionId(),video_on),queryString.broadcast||!svConfigs.videoScreen.greenRoom||getCookie("lsvGreenRoom")){ui_handler.restoreVideoBox(),ui_handler.toggleInstaVideo(!1);var t=video_on?"Video":"Audio";comm_controller.initCall(t,e,o,comm_controller.getSessionId(),audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint)}else v(),n("#startVideoButton").off(),n("#startVideoButton").on("click",function(){p(e)});else T()},S=function(e,n,o){e=escapeHtmlEntities(e),o&&(e='<small id="private">'+smartVideoLocale.msgStore.private+"</small> "+e),n&&showMessage("Me",e);var t=(new Date).toLocaleTimeString();comm_controller.addLocalChat(e,t,o),svConfigs.serverSide.chatHistory&&saveChat(e,names[comm_controller.getSessionId()].name,"",agentId,names[comm_controller.getSessionId()].avatar,names)},C=function(e){if("conference"==conferenceStyle){if(n("#"+e).val()){var o=n("#"+e).val();S(o,!0),n("#"+e).val("")}}else if(n("#"+e).text()){o=n("#"+e).text();S(o,!0),n("#"+e).html("")}},w=function(e){e?(n("#wd-widget-content-video").show(),n("#local_video_div").show(),!queryString.broadcast&&svConfigs.videoScreen.separateScreenShare&&(n("#localScreen").show(),n("#localVideo").hide()),n("#showHideVideo").addClass("disabled")):(n("#remoteScreenChat").hide(),!queryString.broadcast&&svConfigs.videoScreen.separateScreenShare&&(n("#remoteScreen").hide(),n("#localScreen").hide()),comm_controller.getStream()||"conference"==conferenceStyle?(n("#local_video_div").show(),n("#localVideo").show()):(n("#local_video_div").hide(),n("#localVideo").hide()),n("#showHideVideo").removeClass("disabled")),(svConfigs.videoScreen&&0==svConfigs.videoScreen.onlyAgentButtons||queryString.isAdmin)&&ui_handler.setScreenButton(e)},y=function(){w(!1),comm_controller.handleScreenShareTermination(),comm_controller.getStream()||("conference"==conferenceStyle?ui_handler.displayVideoOnly():ui_handler.toggleInstaChat())},b=function(){if(queryString.broadcast||!svConfigs.videoScreen.separateScreenShare)if(audio_on)ui_handler.restoreVideoBox(),comm_controller.startScreenShare(),w(!0);else{audio_on=!audio_on;var e=localStorage.getItem("prd");(e=JSON.parse(e)).muted=!audio_on,e.room=room,localStorage.setItem("prd",JSON.stringify(e)),comm_controller.toggleAudio(),setTimeout(function(){ui_handler.restoreVideoBox(),comm_controller.startScreenShare(),w(!0)},500)}else y(),ui_handler.restoreVideoBox(),comm_controller.startScreenShareConf(),w(!0)},_=function(){if(queryString.isAdmin&&(isOnline=!0),audio_on=!n("#muteAudio1").is(":checked"),video_on=!n("#muteVideo1").is(":checked"),names[comm_controller.getSessionId()].muted=!audio_on,names[comm_controller.getSessionId()].video=video_on,names[comm_controller.getSessionId()].room=room,names[comm_controller.getSessionId()].name=queryString.isAdmin?agentName:visitorName||guestName(comm_controller.getSessionId()),names[comm_controller.getSessionId()].isAdmin=queryString.isAdmin,names[comm_controller.getSessionId()].priv=!!localStorage.getItem("hasPrivileges"),n("#ng_caller_name").val()&&(queryString.isAdmin?agentName=n("#ng_caller_name").val():visitorName=n("#ng_caller_name").val(),names[comm_controller.getSessionId()].name=n("#ng_caller_name").val()),requirePass&&localStorage.getItem("prd")){var e=JSON.parse(localStorage.getItem("prd"));names[comm_controller.getSessionId()].password=e.password}else comm_controller.setCallerInfo(names[comm_controller.getSessionId()],queryString.isAdmin);localStorage.setItem("prd",JSON.stringify(names[comm_controller.getSessionId()])),svConfigs.videoScreen.greenRoom?(n("#wd-widget-content-greenroom").show(),n("#startVideoButton").off(),n("#startVideoButton").on("click",function(){p(!1)}),v()):(r(),ui_handler.setVideoButton(),h(!0)),requirePass=!1},I=function(){if(datetime)e=datetime;else var e=Date.now();var o=new Date,t=new Date(e);if(t.setMinutes(t.getMinutes()+parseInt(duration)),o>=new Date(e)&&t>o){if(svConfigs.videoScreen.exitMeetingOnTime){var i=new Date,r=t-i;setTimeout(function(){var e=smartVideoLocale.msgStore.meetingIsToEnd;toggleError(e,6e4)},t-i-6e4),setTimeout(function(){toggleNotification("",!1),n("#end_meeting").trigger("click")},r)}return!0}var a=new Date,s=new Date(e),d=Math.abs(s-a)/1e3,c=Math.floor(d/86400);d-=86400*c;var l=Math.floor(d/3600)%24;d-=3600*l;var u=Math.floor(d/60)%60;if(d-=60*u,diffString="",c>0){var m=c>1?smartVideoLocale.msgStore.days:smartVideoLocale.msgStore.day;diffString=c+" "+m}if(0===c&&l>0){var g=l>1?smartVideoLocale.msgStore.hours:smartVideoLocale.msgStore.hour;diffString=l+" "+g}if(0===c&&0==l&&u>0&&(diffString=u+" "+smartVideoLocale.msgStore.minutes),0===c&&0==l&&0==u&&(diffString=smartVideoLocale.msgStore.seconds),diffString&&new Date(e)>o){var f=smartVideoLocale.msgStore.notexactAppointment,v=getPrettyDate(new Date(e).getTime()/1e3),p=(p=f.replace("{{timemeeting}}",v)).replace("{{diffString}}",diffString);toggleNotification(p,!0);var h=new Date,S=new Date(e)-h;setTimeout(function(){window.location.reload()},S)}else toggleNotification(smartVideoLocale.msgStore.appointmentPast,!0);return ui_handler.displayChatOnly(),ui_handler.setDisabled(!0),!1},k=function(e){if(toggleNotification("",!1),is_widget_opened="conference"==conferenceStyle?n("#wd-widget-content-greenroom").is(":visible")||n("#wd-widget-content-video-waiting").is(":visible")||n("#wd-widget-content-video").is(":visible")||is_widget_opened:n("#nd_widget_content").is(":visible"),caller_name=caller_name||"",caller_email=caller_email||"",caller_phone=caller_phone||"",is_widget_opened||ui_handler.toggleWidget(),"conference"==conferenceStyle){var o=localStorage.getItem("prd");o=JSON.parse(o),audio_on=!o||null==o.muted||!o.muted,video_on=!o||null==o.video||o.video,n(".muteVideo").prop("checked",!video_on),n(".muteAudio").prop("checked",!audio_on),fileInput=document.querySelector("input#filetransfer")}else"chat"===e?ui_handler.toggleInstaChat():"video"===e?ui_handler.toggleInstaVideo():4!==e||is_widget_opened||ui_handler.toggleInstaVideo(4),document.getElementById("newdev_chat_message1").focus();r()},E=function(e){n(".new_chat_badge_container").hide(),n(".wd-chat-box").is(":visible")?(ui_handler.displayVideoOnly(),!0===e&&h(!1)):ui_handler.displayChatOnly()},A=function(){if(names[comm_controller.getSessionId()]||(names[comm_controller.getSessionId()]={}),roomAllow){if(queryString.broadcast){if(localStorage.removeItem("hasPrivileges"),svConfigs.serverSide.token)return is_widget_opened||comm_controller.getVideoSessions()||n("#invideo").is(":visible")||n("#ng_info").is(":visible")||(is_widget_opened=!0,ui_handler.setDisabled(!0),n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"logintoken",isAdmin:queryString.isAdmin,token:token,roomId:room}}).done(function(e){return e?(e=JSON.parse(e),ui_handler.setDisabled(!1),names[comm_controller.getSessionId()]={name:e.first_name+" "+e.last_name,avatar:svConfigs.agentAvatar?lsRepUrl+svConfigs.agentAvatar:lsRepUrl+"img/small-avatar.jpg",isAdmin:queryString.isAdmin,username:e.username},names[comm_controller.getSessionId()].priv=localStorage.getItem("hasPrivileges"),queryString.isAdmin?agentName=names[comm_controller.getSessionId()].name:visitorName=names[comm_controller.getSessionId()].name,comm_controller.setCallerInfo(names[comm_controller.getSessionId()],!0),e.name=e.first_name+" "+e.last_name,e.isAdmin=queryString.isAdmin,e.room=room,delete e.password,localStorage.setItem("prd",JSON.stringify(e)),toggleNotification("",!1),ui_handler.setDisabled(!1),r(),"conference"==conferenceStyle&&(queryString.isAdmin?(isOnline=!0,_()):(n("#ng_info").show(),n("#cameraMicChoose").hide(),n("#ng_caller_name").hide(),n("#login-conference-title").html(smartVideoLocale.msgStore.welcomeBroadcast),n("#continue-button").off(),n("#continue-button").on("click",function(){n("#ng_info").hide(),isOnline=!0,_()}))),!1):(toggleNotification(smartVideoLocale.msgStore.notValidToken,!0),localStorage.removeItem("prd"),localStorage.removeItem("hasPrivileges"),comm_controller.setClose(comm_controller.getSessionId()),ui_handler.displayChatOnly(),ui_handler.setDisabled(!0),!1)}).fail(function(){})),!1;if("conference"!==conferenceStyle)return ui_handler.toggleWidget(),ui_handler.toggleInstaChat(),ui_handler.displayVideoOnly(),ui_handler.toggleHeaderChat(),queryString.broadcast&&n("#raisehand_div").show(),n("#localVideo").hide(),n(".wd-avatar-agent").hide(),n("#video_container_chat").show(),n("#wd-widget-content-video").hide(),queryString.isAdmin&&(isOnline=!0,n("#callAudioButton_1").addClass("disabled"),n(".peer_avatar").hide()),!1;k("chat"),queryString.isAdmin&&(isOnline=!0)}if(comm_controller.getVideoSessions()||n("#invideo").is(":visible")||n("#wd-widget-content-greenroom").is(":visible")||n("#ng_info").is(":visible")){e=localStorage.getItem("prd");comm_controller.setCallerInfo(JSON.parse(e),queryString.isAdmin)}else{if(k("chat"),!queryString.isAdmin&&duration)if(!I())return!1;if(queryString.broadcast&&"https://www.new-dev.com/ui/"===lsRepUrl)if(svConfigs.videoScreen.exitMeetingOnTime=!0,svConfigs.videoScreen.exitMeeting="https://www.new-dev.com",duration=5,!I())return!1;if(!queryString.isAdmin&&requirePass)return toggleNotification("",!1),n("#ng_info").show(),ui_handler.displayChatOnly(),ui_handler.setDisabled(!0),visitorName&&n("#ng_caller_name").val(visitorName),svConfigs.entryForm.showEmail&&n("#ng_caller_email").show(),svConfigs.entryForm.showAvatar&&n("#ng_caller_avatar").show(),n("#ng_password").show(),n("#continue-button").off(),n("#continue-button").on("click",function(){is_callerback=!1;var e={};e.name=visitorName||n("#ng_caller_name").val(),n("#ng_caller_name").val()&&(e.email=n("#ng_caller_name").val()),n("#ng_caller_avatar").val()&&(e.avatar=n("#ng_caller_avatar").val()),e.password=n("#ng_password").val(),e.room=room,comm_controller.setCallerInfo(e,!1),localStorage.setItem("prdTmp",JSON.stringify(e))}),!1;if(localStorage.getItem("prd")){var e=localStorage.getItem("prd");e=JSON.parse(e),roomPrd=e.room}if(visitorName&&!queryString.isAdmin&&!svConfigs.serverSide.loginForm&&!queryString.broadcast){svConfigs.entryForm.enabled=!1;var o={name:visitorName,room:room};localStorage.setItem("prd",JSON.stringify(o))}if(localStorage.getItem("prd")&&roomPrd==room&&!svConfigs.serverSide.loginForm&&!queryString.broadcast)svConfigs.entryForm.enabled=!1,(e=localStorage.getItem("prd"))&&(e=JSON.parse(e)),comm_controller.setCallerInfo(e,queryString.isAdmin),names[comm_controller.getSessionId()]={name:e?e.name:caller_name,avatar:e?e.avatar:caller_avatar,email:e?e.email:caller_email};if(svConfigs.entryForm.enabled){var t=function(){caller_name=n("#ng_caller_name").val(),caller_email=n("#ng_caller_email").val(),caller_avatar=n("#ng_caller_avatar").val(),toggleNotification("",!1);var e={name:caller_name,email:caller_email,avatar:caller_avatar,room:room};svConfigs.serverSide&&svConfigs.serverSide.loginForm?isLsvAdmin?(ui_handler.setDisabled(!0),n("#ng_info").show(),n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"loginadmin",email:n("#ng_caller_email").val(),password:n("#ng_password").val()}}).done(function(o){if(!o||200!=o)return toggleNotification(smartVideoLocale.msgStore.notValidPassword,!0),!1;ui_handler.setDisabled(!1),n("#ng_info").hide(),comm_controller.setCallerInfo(e,!1),localStorage.setItem("prd",JSON.stringify(e)),"conference"==conferenceStyle&&_()}).fail(function(){return!1})):(ui_handler.setDisabled(!0),n("#ng_info").show(),n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"login",email:n("#ng_caller_email").val(),password:n("#ng_password").val()}}).done(function(o){if(!o||200!=o)return toggleNotification(smartVideoLocale.msgStore.notValidPassword,!0),!1;ui_handler.setDisabled(!1),n("#ng_info").hide(),comm_controller.setCallerInfo(e,!1),localStorage.setItem("prd",JSON.stringify(e)),"conference"==conferenceStyle&&(isOnline=!0,_())}).fail(function(){return!1})):(localStorage.setItem("prd",JSON.stringify(e)),svConfigs.entryForm.private&&requirePass?e.password=n("#ng_password").val():(n("#ng_info").hide(),n("#continue-button").off(),ui_handler.setDisabled(!1)),comm_controller.setCallerInfo(e,queryString.isAdmin),"conference"==conferenceStyle&&_())};if(svConfigs.entryForm.required||svConfigs.entryForm.private){(svConfigs.entryForm.private&&requirePass||svConfigs.serverSide.loginForm)&&(isOnline=!1,n("#ng_password").show()),svConfigs.entryForm.showEmail&&n("#ng_caller_email").show(),svConfigs.entryForm.showAvatar&&n("#ng_caller_avatar").show(),i=function(e){var o=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;13==e.keyCode&&""!==n("#ng_caller_name").val()&&""!==n("#ng_caller_email").val()&&o.test(n("#ng_caller_email").val())&&t();var i=!svConfigs.entryForm.showEmail||""!==n("#ng_caller_email").val()&&o.test(n("#ng_caller_email").val()),r=!svConfigs.entryForm.showAvatar||""!==n("#ng_caller_avatar").val();""!==n("#ng_caller_name").val()&&i&&r?n("#continue-button").removeClass("disabled"):n("#continue-button").addClass("disabled")},n("#ng_caller_name").keyup(function(e){i(e)}),n("#ng_caller_email").keyup(function(e){i(e)}),n("#ng_password").keyup(function(e){i(e)}),n("#ng_caller_avatar").keyup(function(e){i(e)}),n("#ng_caller_name").blur(function(e){i(e)}),n("#ng_caller_email").blur(function(e){i(e)}),n("#ng_password").blur(function(e){i(e)}),n("#ng_caller_avatar").blur(function(e){i(e)}),n("#continue-button").addClass("disabled")}ui_handler.displayChatOnly(),ui_handler.setDisabled(!0),isLsvAdmin&&agentName?svConfigs.entryForm.enabled=!1:n("#ng_info").show(),setTimeout(function(){n("#ng_caller_name").focus()},500),n("#continue-button").off(),n("#continue-button").on("click",function(){t()}),svConfigs.showEntryForm=!1}else{if(queryString.isAdmin&&agentName)svConfigs.entryForm.enabled=!1,(e=localStorage.getItem("prd"))&&((e=JSON.parse(e)).name=names[comm_controller.getSessionId()].name,e.avatar=names[comm_controller.getSessionId()].avatar),names[comm_controller.getSessionId()]={name:svConfigs.agentName?svConfigs.agentName:"",avatar:svConfigs.agentAvatar?svConfigs.agentAvatar:lsRepUrl+"img/small-avatar.jpg",room:room},comm_controller.setCallerInfo(e,!0),localStorage.setItem("prd",JSON.stringify(names[comm_controller.getSessionId()]));isOnline?(ui_handler.displayChatOnly(),toggleNotification("",!1),ui_handler.setDisabled(!1)):ui_handler.setDisabled(!0)}(e=localStorage.getItem("prd"))&&(0==(e=JSON.parse(e)).video&&(disableVideo=!0),1==e.muted&&(disableAudio=!0)),names[comm_controller.getSessionId()]={name:e?e.name:caller_name,avatar:e?e.avatar:caller_avatar,email:e?e.email:caller_email},0==svConfigs.entryForm.enabled&&"conference"==conferenceStyle&&(isOnline=!0,ui_handler.setDisabled(!1),_())}var i;r()}},R=function(e){e?n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"endmeeting",agentId:agentId,roomId:room}}).done(function(e){setTimeout(function(){toggleNotification(smartVideoLocale.msgStore.meetingHasEnded,!0),localStorage.removeItem("prd"),localStorage.removeItem("hasPrivileges"),comm_controller.setClose(comm_controller.getSessionId()),ui_handler.displayChatOnly(),ui_handler.setDisabled(!0),isOnline=!1},150)}).fail(function(){}):1!=svConfigs.serverSide.feedback||queryString.isAdmin||getCookie("lsvRateRoom")||comm_controller.getVideoSessions()||(n("#feedback_form").show(),n("#invideo").hide(),n("#feedback-button").click(function(){if(n("#feedback_form").hide(),token)var e=token;else e=names[comm_controller.getSessionId()].name?names[comm_controller.getSessionId()].name:guestName(comm_controller.getSessionId());n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"feedback",roomId:room,sessionId:comm_controller.getSessionId(),rate:n("#ratestars").rateit("value"),text:n("#feedback_message").val(),userId:e}}).done(function(e){e&&setCookie("lsvRateRoom","1",240)}).complete(function(){setCookie("lsvRateRoom","1",240)}).fail(function(){console.log(!1)})}))},T=function(){if(comm_controller.getParticipants()>0)console.log("setOffline return");else{if(!queryString.isAdmin&&duration&&setTimeout(function(){if(!I())return!1},50),queryString.broadcast&&"https://www.new-dev.com/ui/"===lsRepUrl)if(svConfigs.videoScreen.exitMeetingOnTime=!0,svConfigs.videoScreen.exitMeeting="https://www.new-dev.com",duration=5,!I())return!1;if(!comm_controller.getVideoSessions()&&!n("#invideo").is(":visible")){if(ui_handler.setDisabled(!0),smartVideoLocale.msgStore.waitingOtherParty)var e=smartVideoLocale.msgStore.waitingOtherParty;else e="Waiting for the other party to join";comm_controller.customerHere(visitorName),toggleNotification(e,!0)}r()}},x=function(e,n){names[e]&&(names[e].video=n),r()};function M(){if("conference"==conferenceStyle)var o="roomconference.css";else o="room.css";var s=n("<link>",{rel:"stylesheet",type:"text/css",href:lsRepUrl+"css/"+o+"?v="+currVersion});(n(document.body).append(t),s.appendTo("head"),1==svConfigs.serverSide.feedback)&&n("<link>",{rel:"stylesheet",type:"text/css",href:lsRepUrl+"css/rateit.css?v="+currVersion}).appendTo("head");n.get(lsRepUrl+"pages/"+videoWidgetContainer+"?v="+currVersion,function(o){if(t.append(o),ui_handler.setWidgetValues(),svConfigs.serverSide.checkRoom&&n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"getroom",isAdmin:queryString.isAdmin,roomId:room}}).done(function(e){if(!e){var n=smartVideoLocale.msgStore.roomNotAllowed;return toggleError(n,5e4),void(roomAllow=isOnline=!1)}(e=JSON.parse(e)).title&&(roomAllow=!0,document.title=e.title)}).fail(function(){}),svConfigs.blackList&&svConfigs.blackList.includes(room)){var s=smartVideoLocale.msgStore.roomNotAllowed;return toggleError(s,5e4),void(roomAllow=isOnline=!1)}"conference"==conferenceStyle&&(n("#showProfile").show(),!(isChrome||isFirefox||isOpera||isSafariA)||isiPhone||isAndroid||!queryString.room&&!queryString.broadcast||n("#screenshareLi").show(),queryString.broadcast&&!queryString.isAdmin&&n("#screenshareLi").hide(),svConfigs.recording.enabled&&queryString.isAdmin&&!isiPhone&&!isAndroid&&n("#recordingLi").show(),svConfigs.videoScreen.getSnapshot&&n("#snapshotLi").show()),"conference"==conferenceStyle&&queryString.broadcast&&!queryString.isAdmin&&(n("#showHideVideo").hide(),n("#showHideAudio").hide(),n("#raisehandLi").show(),n("#raisehandLi1").show(),n("#localVideo").hide(),n("#snapshotLi").hide()),"conference"==conferenceStyle&&queryString.broadcast&&svConfigs.videoScreen.videoFileStream&&(n("#showHideVideo").hide(),n("#showHideAudio").hide(),n("#localVideo").hide(),n("#snapshotLi").hide(),n("#raisehandLi").hide(),n("#whiteboardLi").hide(),n("#screenshareLi").hide(),n("#recordingLi").hide(),n("#changeViewLi").hide()),disableWhiteboard&&n("#whiteboardLi").hide(),disableScreenShare&&n("#screenshareLi").hide(),n(document).on("LSLocaleUpdated",function(e){n("#cancel_call_button span").html(smartVideoLocale.msgStore.Cancel),n("#waitingToConnect").html(smartVideoLocale.msgStore.waitingToConnect),n("#answer_audiocall_button").attr("title",smartVideoLocale.msgStore.answerWithAudio),n("#answer_audiocall_button1").attr("title",smartVideoLocale.msgStore.answerWithAudio),n("#callAudioButton_4").attr("title",smartVideoLocale.msgStore.callWithAudio),n("#callAudioButton_1").attr("title",smartVideoLocale.msgStore.callWithAudio),n("#call_audio").attr("title",smartVideoLocale.msgStore.callWithAudio),n("#answer_call_button1").attr("title",smartVideoLocale.msgStore.answerWithVideo),n("#answer_call_button").attr("title",smartVideoLocale.msgStore.answerWithVideo),n("#reject_call_button").attr("title",smartVideoLocale.msgStore.rejectCall);var o=smartVideoLocale.msgStore.incomingText;n("#incoming_text").html(o.replace("{{caller_name}}",peer_name)),n("#callButton_4").attr("title",smartVideoLocale.msgStore.callWithVideo),n("#callButton_1").attr("title",smartVideoLocale.msgStore.callWithVideo),n("#call_video").attr("title",smartVideoLocale.msgStore.callWithVideo),n("#exit_meeting").attr("title",smartVideoLocale.msgStore.exitMeeting),n("#file_transfer").attr("title",smartVideoLocale.msgStore.fileTransfer),n("#showHideVideo").attr("title",smartVideoLocale.msgStore.showHideVideo),n("#showHideAudio").attr("title",smartVideoLocale.msgStore.showHideAudio),n(".wd-v-share").attr("title",smartVideoLocale.msgStore.startShare),n("#startscreenshare").attr("title",smartVideoLocale.msgStore.startShare),n("#stopscreenshare").attr("title",smartVideoLocale.msgStore.stopShare),n(".wd-v-stopshare").attr("title",smartVideoLocale.msgStore.stopShare),n("#cameraSwitch").attr("title",smartVideoLocale.msgStore.cameraSwitch),n("#hangupButton").attr("title",smartVideoLocale.msgStore.hangupButton),n("#enableScreenShare").html(smartVideoLocale.msgStore.enableScreenShare),n("#screensharelink").attr("src","https://chrome.google.com/webstore/detail/"+svConfigs.chromePluginId),n(".swipe_text_video").html(smartVideoLocale.msgStore.videoScreen),n(".swipe_text").html(smartVideoLocale.msgStore.chatScreen),n(".login-wd-title").html(smartVideoLocale.msgStore.nameFieldForm),n("#login-conference-title").html(smartVideoLocale.msgStore.formConferenceTitle),n("#continue-button").html(smartVideoLocale.msgStore.continueButton),n("#ng_caller_name").attr("placeholder",smartVideoLocale.msgStore.namePlaceholder),n("#ng_caller_avatar").attr("placeholder",smartVideoLocale.msgStore.avatarPlaceholder),n("#ng_password").attr("placeholder",smartVideoLocale.msgStore.passwordPlaceholder),n("#answer_audiocall_button span").html(smartVideoLocale.msgStore.audio),n("#answer_call_button span").html(smartVideoLocale.msgStore.video),n("#reject_call_button span").html(smartVideoLocale.msgStore.reject),n(".wd-v-recording recording-on").attr("title",smartVideoLocale.msgStore.stopRecording),n(".wd-v-recording recording-off").attr("title",smartVideoLocale.msgStore.startRecording),n(".recordingIcon").attr("title",smartVideoLocale.msgStore.recording),n("#whiteboard").attr("title",smartVideoLocale.msgStore.whiteboard),n("#changeView").attr("title",smartVideoLocale.msgStore.changeView),n("#raisehand").attr("title",smartVideoLocale.msgStore.raiseHand),n("#raisehand1").attr("title",smartVideoLocale.msgStore.raiseHand),n("#snapshot").attr("title",smartVideoLocale.msgStore.getSnapshot),n(".recordinglink").html(smartVideoLocale.msgStore.previewRecording),n("#snapshotLink").html(smartVideoLocale.msgStore.snapshotDownload),n(".acceptFile").html(smartVideoLocale.msgStore.acceptFile),n(".rejectFile").html(smartVideoLocale.msgStore.rejectFile),n("#cleanCanvas").attr("title",smartVideoLocale.msgStore.wb_clearall),n("#downloadCanvas").attr("title",smartVideoLocale.msgStore.wb_downloadimage);var t=isiPhone?smartVideoLocale.msgStore.notSupportedIos:smartVideoLocale.msgStore.notSupportedError;n("#not_supported").html(t),n("#startVideoButton").html(smartVideoLocale.msgStore.continueToCall),n("#chooseVideoAudio").html(smartVideoLocale.msgStore.chooseOptions),n(".feedback-title").html(smartVideoLocale.msgStore.feedbackFieldForm),n("#feedback-button").html(smartVideoLocale.msgStore.feedbackButton),n(".muteMe").html(smartVideoLocale.msgStore.muteMe),n(".turnOffCamera").html(smartVideoLocale.msgStore.turnOffCamera),n("#startRecording").attr("title",smartVideoLocale.msgStore.startRecording),n("#end_meeting").attr("title",smartVideoLocale.msgStore.endMeeting),n("#newdev_chat_message1").attr("placeholder",smartVideoLocale.msgStore.writeSomething)}),n(document).on("RemoteVideoSessions",function(e){remoteVideoSessions=e.count}),n(document).on("IncomingCall",function(e){if("conference"==conferenceStyle)ui_handler.setWidgetValues(),ui_handler.onIncomingVideo(),e.autoaccept||comm_controller.getVideoSessions()?setTimeout(function(){comm_controller.answerCall(video_on,!0)},1e3):(playIncomingCall(),ui_handler.toggleRinging(function(e){e?comm_controller.answerCall(video_on,!0):comm_controller.rejectCall()}));else{ui_handler.setWidgetValues(),ui_handler.onIncomingVideo();var o=smartVideoLocale.msgStore.incomingText;n("#incoming_text").html(o.replace("{{caller_name}}",peer_name)),autoAcceptVideo||autoAcceptAudio||svConfigs.videoScreen.autoAcceptVideo||svConfigs.videoScreen.autoAcceptAudio||e.autoaccept||comm_controller.getVideoSessions()?queryString.isAdmin&&setTimeout(function(){svConfigs.videoScreen.greenRoom&&!getCookie("lsvGreenRoom")?(v(),n("#startVideoButton").click(function(){window.stream&&window.stream.getTracks().forEach(function(e){e.stop()}),inCall.push(e.sessionId),comm_controller.answerCall(video_on,!1,videoSource,audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint)})):((svConfigs.videoScreen.autoAcceptAudio||autoAcceptAudio)&&(video_on=!1),(svConfigs.videoScreen.autoAcceptVideo||autoAcceptVideo)&&(video_on=!0),ui_handler.setMobileChatOnly(),ui_handler.displayVideoOnly(),inCall.push(e.sessionId),comm_controller.answerCall(video_on,!1,videoSource,audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint))},1e3):(playIncomingCall(),ui_handler.toggleRinging(function(o){o?remoteVideoSessions>0?(n("#wd-widget-content-video-waiting").show(),setTimeout(function(){h(!0)},1e3),inCall.includes(e.sessionId)||(inCall.push(e.sessionId),comm_controller.answerCall(video_on,!0,videoSource,audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint))):svConfigs.videoScreen.greenRoom&&!getCookie("lsvGreenRoom")?(v(),n("#startVideoButton").click(function(){window.stream&&window.stream.getTracks().forEach(function(e){e.stop()}),inCall.push(e.sessionId),comm_controller.answerCall(video_on,!0,videoSource,audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint)})):(inCall.push(e.sessionId),comm_controller.answerCall(video_on,!0,videoSource,audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint)):comm_controller.rejectCall()}))}}),n(".wd-v-hangup").on("click",function(){f()}),n(document).off("LocalVideoStarted"),n(document).on("LocalVideoStarted",function(o){n("#localVideo").show(),("conference"==conferenceStyle||queryString.broadcast)&&(ui_handler.toggleVideoBox(!0),x(comm_controller.getSessionId(),video_on));var t=!1,i=svConfigs.transcribe?svConfigs.transcribe.direction:"";"agent"==i?t=isChrome&&queryString.isAdmin&&svConfigs.transcribe&&1==svConfigs.transcribe.enabled:"visitor"==i?t=isChrome&&!queryString.isAdmin&&svConfigs.transcribe&&1==svConfigs.transcribe.enabled:"both"==i&&(t=isChrome&&svConfigs.transcribe&&1==svConfigs.transcribe.enabled),t&&loadScript("../js/translator.js",function(){translator=new Translator;var n=e.getAttribute("data-langFrom")?e.getAttribute("data-langFrom"):svConfigs.transcribe.language,o=e.getAttribute("data-langTo")?e.getAttribute("data-langTo"):svConfigs.transcribe.languageTo;"both"!=i||queryString.isAdmin||(n=e.getAttribute("data-langTo")?e.getAttribute("data-langTo"):svConfigs.transcribe.languageTo,o=e.getAttribute("data-langFrom")?e.getAttribute("data-langFrom"):svConfigs.transcribe.language),translator.voiceToText(function(e){o&&svConfigs.transcribe.apiKey?translator.translateLanguage(e,{from:n,to:o,callback:function(e){comm_controller.sendTranslateMessage(e,!1)},api_key:svConfigs.transcribe.apiKey}):comm_controller.sendTranslateMessage(e,!1)},n)}),!queryString.broadcast&&svConfigs.videoScreen.separateScreenShare&&comm_controller.addToJoinScreenShare()}),n("#end_meeting").on("click",function(){f(),localStorage.removeItem("prd"),localStorage.removeItem("hasPrivileges");var e=function(){svConfigs.videoScreen.exitMeeting?(queryString.isAdmin&&comm_controller.setDeleteAll(),location.href=svConfigs.videoScreen.exitMeeting):queryString.isAdmin?(comm_controller.setDeleteAll(),n("#invideo").hide(),n("#ng_info").show(),n("#continue-button").on("click",function(){var e={name:caller_name=n("#ng_caller_name").val(),email:caller_email,avatar:caller_avatar,room:room};localStorage.setItem("prd",JSON.stringify(e)),comm_controller.setCallerInfo(e,queryString.isAdmin),n("#ng_info").hide(),_()})):location.reload()};queryString.isAdmin?e():1!=svConfigs.serverSide.feedback||queryString.isAdmin||getCookie("lsvRateRoom")||comm_controller.getVideoSessions()?e():(n("#feedback_form").show(),n("#invideo").hide(),n("#feedback-button").click(function(){if(n("#feedback_form").hide(),token)var o=token;else o=names[comm_controller.getSessionId()].name?names[comm_controller.getSessionId()].name:guestName(comm_controller.getSessionId());n.ajax({type:"POST",timeout:5e3,url:lsRepUrl+"server/script.php",data:{type:"feedback",roomId:room,sessionId:comm_controller.getSessionId(),rate:n("#ratestars").rateit("value"),text:n("#feedback_message").val(),userId:o}}).done(function(e){e&&setCookie("lsvRateRoom","1",240)}).complete(function(){setCookie("lsvRateRoom","1",240),e()}).fail(function(){console.log(!1)})}))}),n("#cancel_call_button").on("click",function(){f()}),n("#callButton_1").on("click",function(){video_on=video_iphone_on=!0,ui_handler.setVideoButton(),h(!1)}),n("#callAudioButton_1").on("click",function(){ringBackStart=!0,video_on=!1,ui_handler.setVideoButton(),h(!1)}),n(document).on("NotSupportedBrowser",function(e){comm_controller.rejectCall(),ui_handler.setVideoBoxOff("video")}),n(document).off("RemoteSpanPosition"),n(document).on("RemoteSpanPosition",function(e){var o=names[e.sessionId]?names[e.sessionId].name:peer_name,t=n("<h2 />",{id:"remoteVideoSpan"+e.sessionId,class:"sourcevideospan"});t.css("postion","absolute"),t.css("top",e.position.top+"px"),t.css("left",e.position.left+"px"),t.appendTo(n("#"+videoElementContainer)),t.html(o)}),n(document).off("MakeBigBroadcast"),n(document).on("MakeBigBroadcast",function(e){ui_handler.makeBig()}),n(document).off("VoiceSpeaking"),n(document).on("VoiceSpeaking",function(e){if("grid"!=currentView){var o=e.id;if(n("#"+o).is(":visible")&&!n("#wd-widget-content-whiteboard").is(":visible"))if(clearTimeout(timerVars[o]),svConfigs.videoScreen&&"conference"===svConfigs.videoScreen.videoContainerStyle&&jQEngager("#"+o)){if(!(svConfigs.videoScreen.videoConference||names[o].isAdmin||queryString.isAdmin||jQEngager("#"+o).hasClass("bigvideo")))return;ui_handler.makeAllSmall(),comm_controller.getScreenStreamConnections()||(n("#fullScreen").show(),n("#"+o).detach().appendTo("#video_container"),n("#"+o).removeClass("sourcevideo"),n("#"+o).addClass("bigvideo"),n("#"+o).addClass("bigvideoadd"),comm_controller.getVideoSessions()>1?(n("#"+o).css("height","85%"),n("#"+o).css("height","85%")):(n("#"+o).css("height","98%"),n("#"+o).css("height","98%")),ui_handler.changeSpanPositions())}else jQEngager("#"+o).css("border","1px solid #484d75")}}),n(document).off("VoiceSilence"),n(document).on("VoiceSilence",function(e){if(svConfigs.videoScreen.videoConference){var o=e.id;n("#"+o).is(":visible")&&(timerVars[o]=setTimeout(function(){svConfigs.videoScreen&&"conference"===svConfigs.videoScreen.videoContainerStyle&&jQEngager("#"+o)||jQEngager("#"+o).css("border","1px solid #fff"),n("#translate_message").hide()},5e3))}}),n("#changeView").click(function(){ui_handler.changeView(!0)});var d,c,g,p,I=function(){p=null,n("#snapshotData").hide(),n(".recordinglink").attr("href",""),n("#canvasData").hide()};svConfigs.videoScreen.getSnapshot&&n("#snapshotLi").click(function(){if(d=n(".bigvideoadd")[0],c=n("#snapshotCanvas")[0],500,d){g=d.videoHeight/(d.videoWidth/500),isNaN(g)&&(g=375);var e=c.getContext("2d");g?(c.width=500,c.height=g,e.drawImage(d,0,0,500,g),p=c.toDataURL("image/png"),n("#snapshotData").show(),n("#snapshotLink").attr("href",p),n("#snapshotLink").attr("download",peer_name+".png"),n("#snapshotLink").click(function(){I()}),n(".close-but-wd-small").on("click",function(){I()})):I()}});n(document).off("RemoteVideoStarted"),n(document).on("RemoteVideoStarted",function(e){var o=document.querySelector("video#videoPreview");if(o&&(o.src="",o.srcObject=null),"conference"==conferenceStyle)!isChrome&&!isFirefox||isiPhone||isAndroid||!queryString.isAdmin||1!=svConfigs.recording.enabled||0!=svConfigs.recording.autoStart||n(".fa-circle").show(),n("#permission_div").hide(),n("#video_back").hide(),stopIncomingCall(),n("#wd-widget-content-whiteboard").is(":visible")||(ui_handler.toggleVideoBox(!0),(isChrome||isFirefox)&&!isiPhone&&!isAndroid&&queryString.isAdmin&&svConfigs.recording.enabled&&svConfigs.recording.autoStart&&l()),x(comm_controller.getSessionId(),video_on),playEnterRoom(),ui_handler.changeView(!1);else{!isChrome&&!isFirefox||isiPhone||isAndroid||!queryString.isAdmin||1!=svConfigs.recording.enabled||0!=svConfigs.recording.autoStart||n(".wd-v-recording").show(),n("#permission_div").hide(),n("#video_back").hide(),stopIncomingCall();try{ui_handler.toggleVideoBox(!0),(isChrome||isFirefox)&&!isiPhone&&!isAndroid&&queryString.isAdmin&&svConfigs.recording.enabled&&svConfigs.recording.autoStart&&l()}catch(e){console.log(e)}}I()}),n(document).on("VideoRemoved",function(e){video_on=!1,ui_handler.setVideoButton(),x(comm_controller.getSessionId(),!1),names[comm_controller.getSessionId()].video=!1,names[comm_controller.getSessionId()].room=room,localStorage.setItem("prd",JSON.stringify(names[comm_controller.getSessionId()]))}),n(document).on("AudioRemoved",function(e){ui_handler.disableAudio(),audio_on=!1,ui_handler.setMuteButton(),names[comm_controller.getSessionId()]&&(names[comm_controller.getSessionId()].muted=!0,names[comm_controller.getSessionId()].room=room,localStorage.setItem("prd",JSON.stringify(names[comm_controller.getSessionId()]))),r()}),n(document).on("VideoMuted",function(e){ui_handler.disableVideo(),video_on=!1,ui_handler.setVideoButton(),x(comm_controller.getSessionId(),!1),n("#localVideo").hide()}),n(document).on("VideoUnmuted",function(e){video_on=!0,ui_handler.setVideoButton(),x(comm_controller.getSessionId(),!0),n("#localVideo").show()}),n(document).on("AudioMuted",function(e){audio_on=!1,ui_handler.setMuteButton(),names[comm_controller.getSessionId()]&&(names[comm_controller.getSessionId()].muted=!0),r()}),n(document).on("AudioUnmuted",function(e){audio_on=!0,ui_handler.setMuteButton(),names[comm_controller.getSessionId()]&&(names[comm_controller.getSessionId()].muted=!1),r()}),n(document).on("RemoteVideoMuted",function(e){n("#"+e.sessionId).hide(),n("#remoteVideoSpan"+e.sessionId).hide(),x(e.sessionId,!1)}),n(document).on("BlockUser",function(e){comm_controller.getSessionId()==e.sessionId&&(f(),localStorage.removeItem("prd"),localStorage.removeItem("hasPrivileges"),comm_controller.setClose(comm_controller.getSessionId()),delete names[e.sessionId],location.reload())}),n(document).on("RevokePriveleges",function(e){names[e.sessionId].priv=!1,comm_controller.getSessionId()==e.sessionId&&(n(".fa-hand-paper-o").closest("a").removeClass("active"),localStorage.removeItem("hasPrivileges"),n("#hangupBroadcastButton").trigger("click"),comm_controller.revokeBroadcast(),n("#screenshareLi").hide(),n("#whiteboardLi").hide(),n("#localVideo").hide(),n("#showHideVideo").hide())}),n(document).on("GrantPriveleges",function(e){names[e.sessionId].priv=!0,comm_controller.getSessionId()==e.sessionId&&(localStorage.setItem("hasPrivileges",!0),n(".fa-hand-paper-o").closest("a").removeClass("active"),comm_controller.joinBroadcast(),!(isChrome||isFirefox||isOpera||isSafariA)||isiPhone||isAndroid||!queryString.room&&!queryString.broadcast||n("#screenshareLi").show(),1==svConfigs.whiteboard.enabled&&svConfigs.whiteboard.allowAnonymous&&n("#whiteboardLi").show(),svConfigs.videoScreen.broadcastAttendeeVideo?n("#showHideVideo").show():n("#showHideVideo").hide())}),n(document).on("RemoteVideoUnmuted",function(e){n("#"+e.sessionId).show(),n("#remoteVideoSpan"+e.sessionId).show(),x(e.sessionId,!0)}),n(document).on("RemoteAudioMuted",function(e){names[e.sessionId]&&(names[e.sessionId].muted=!0),r()}),n(document).on("RemoteAudioUnmuted",function(e){names[e.sessionId]&&(names[e.sessionId].muted=!1),r()}),n(document).on("ForceAudioMuted",function(e){if(e.sessionId==comm_controller.getSessionId()){audio_on=!1;var n=localStorage.getItem("prd");(n=JSON.parse(n)).muted=!audio_on,n.room=room,localStorage.setItem("prd",JSON.stringify(n)),comm_controller.toggleAudio()}}),n(document).on("ForceAudioMutedAll",function(e){audio_on=!1;var n=localStorage.getItem("prd");(n=JSON.parse(n)).muted=!audio_on,n.room=room,localStorage.setItem("prd",JSON.stringify(n)),comm_controller.toggleAudio()}),n(document).on("ForceDelete",function(e){e.sessionId==comm_controller.getSessionId()&&(f(),n("#invideo").hide(),localStorage.removeItem("prd"),localStorage.removeItem("hasPrivileges"),location.reload())}),n(document).on("ForceDeleteAll",function(e){f(),is_widget_opened=!1,n("#invideo").hide(),localStorage.removeItem("prd"),localStorage.removeItem("hasPrivileges"),svConfigs.videoScreen.exitMeeting?location.href=svConfigs.videoScreen.exitMeeting:location.reload()}),n("#fullscreenButton").on("click",function(){n("#fullScreen").hide(),n("#exitFullScreen").show(),toggleFullScreen()}),n("#exitFullscreenButton").on("click",function(){n("#fullScreen").show(),n("#exitFullScreen").hide(),toggleFullScreen()}),n("#call_video").off(),n("#call_audio").off(),n("#call_video").on("click",function(){video_on=!0,E(!0)}),n("#call_audio").on("click",function(){isiPhone?(video_on=!0,video_iphone_on=!1):video_on=!1,E(!0)}),n(".wd-v-text").on("click",function(){E(!1)}),n("#slide_video").on("click",function(){E(!1)}),(isAndroid||isiPhone)&&(n("#mainleft_div").on("swipe",function(){E(!1)}),n(".wd-chat-box").on("swipe",function(){E(!1)})),n("#showHideAudio").on("click",function(){audio_on||video_on||comm_controller.initCall("Audio",!1,videoSource,comm_controller.getSessionId(),audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint),audio_on=!audio_on;var e=localStorage.getItem("prd");(e=JSON.parse(e)).muted=!audio_on,e.room=room,localStorage.setItem("prd",JSON.stringify(e)),comm_controller.toggleAudio()}),n("#showHideVideo").on("click",function(){audio_on||video_on||comm_controller.initCall("Video",!1,videoSource,comm_controller.getSessionId(),audioSource,svConfigs.videoScreen.videoConstraint,svConfigs.videoScreen.audioConstraint),video_on=!video_on;var e=localStorage.getItem("prd");(e=JSON.parse(e)).video=video_on,e.room=room,localStorage.setItem("prd",JSON.stringify(e)),comm_controller.toggleVideo()}),n(document).on("RemoteVideoStopped",function(e){ui_handler.changeView(!1)}),n(document).on("MediaDevices",function(e){(videoDevices=e.devices).length>1&&(n("#cameraSwitch").show(),n("#cameraSwitch").off(),n("#cameraSwitch").click(function(){(videoCurrentId+=1)===videoDevices.length&&(videoCurrentId=0),video_on=!0,isAndroid?comm_controller.renegotiate(videoDevices[videoCurrentId].value):comm_controller.forceStopCall()}))}),n(document).on("RestartVideo",function(e){f(),video_on=!0,ui_handler.displayVideoOnly(),setTimeout(function(){h(!0)},1e3)}),n(document).on("CallAccepted",function(e){stopIncomingCall()}),n(document).on("CallRejected",function(e){stopIncomingCall()}),n(document).on("CallFailed",function(e){stopIncomingCall()}),n(document).on("LocalVideoStopped",function(e){}),n(document).on("ChatRejected",function(e){}),n(document).off("CallEnded"),n(document).on("CallEnded",function(e){a(e.sessionId)}),n(document).off("TogglePermissionDenied"),n(document).on("TogglePermissionDenied",function(e){a(e.sessionId),ui_handler.togglePermissionWidget(!1)}),n(document).on("CheckPopup",function(e){comm_controller.setPing(comm_controller.getSessionId())}),n(document).off("CallerInfo"),n(document).on("CallerInfo",function(e){e.callerInfo&&e.callerInfo.name&&(passRoom||e.callerInfo.password?(queryString.isAdmin&&comm_controller.sendCallerBack(e.callerInfo.password==passRoom,e.sessionId),e.callerInfo.password==passRoom&&i(e)):i(e))}),n(document).off("AdminPopupOffline"),n(document).on("AdminPopupOffline",function(e){"conference"!=conferenceStyle&&(isOnline=!1,T())}),n(document).off("PopupOffline"),n(document).on("PopupOffline",function(e){"conference"!=conferenceStyle&&(isOnline=!1,T())}),n(document).off("PopupLeft"),n(document).on("PopupLeft",function(e){if(names[e.sessionId]&&names[e.sessionId].name){var o=smartVideoLocale.msgStore.leftChat.replace("{{caller_name}}",names[e.sessionId].name);svConfigs.videoScreen&&svConfigs.videoScreen.waitingRoom?toggleError(o,5e3):(showMessage("",o,null,"leftChat"),svConfigs.serverSide.chatHistory&&saveChat(o,"","leftChat",agentId,"",names));var t=document.getElementById(e.sessionId);t&&(t.parentNode.removeChild(t),n("#remoteVideoSpan"+e.sessionId).remove()),delete names[e.sessionId],r()}}),n(".box-title").on("click",function(){ui_handler.toggleVisitors(!0)}),n("#toVideo").on("click",function(){comm_controller.getStream()||"conference"==conferenceStyle?(ui_handler.displayVideoOnly(),comm_controller.toVideo(),ui_handler.changeView(!1)):ui_handler.toggleInstaChat()}),n(document).on("ToVideo",function(e){ui_handler.displayVideoOnly(),ui_handler.changeView(!1)}),n("#cleanCanvas").on("click",function(){comm_controller.clearCanvas()});var k,M=document.getElementById("canvasLink");n("#downloadCanvas").on("click",function(){var e;n("#canvasData").show(),M.innerHTML=M.href=M.style="",canvasLink,e=e||function(){},lsDesigner.toDataURL("image/png",function(e){M.href=e,M.innerHTML=smartVideoLocale.msgStore.wb_downloadimage,M.download="image."+"image/png".split("/")[1]})}),n("#canvasLink").click(function(){n("#canvasData").hide()}),n(document).on("WhiteboardSync",function(e){"list"==currentView?ui_handler.makeAllSmall():ui_handler.makeAllSmallGrid(),ui_handler.toggleInstaWhiteboard()}),n("#mainleft_div").hover(function(){n(".wd-video-c").delay(200).show()},function(){n(".wd-video-c").delay(200).hide()}),n("#whiteboard").off(),n("#whiteboard").on("click",function(){"list"==currentView?ui_handler.makeAllSmall():ui_handler.makeAllSmallGrid(),ui_handler.toggleInstaWhiteboard(),n("#cleanCanvas").show(),n("#downloadCanvas").show(),(queryString.isAdmin||localStorage.getItem("hasPrivileges"))&&comm_controller.startWhiteboard()}),n("#raisehand").off(),n("#raisehand").on("click",function(){S("raiseHand");var e=smartVideoLocale.msgStore.raiseHandText.replace("{{caller_name}}",names[comm_controller.getSessionId()].name);n(".fa-hand-paper-o").closest("a").addClass("active"),svConfigs.videoScreen&&svConfigs.videoScreen.waitingRoom?toggleError(e,5e3):showMessage("",e,null,"raiseHand")}),n("#raisehand1").off(),n("#raisehand1").on("click",function(){S("raiseHand");var e=smartVideoLocale.msgStore.raiseHandText.replace("{{caller_name}}",names[comm_controller.getSessionId()].name);n(".fa-hand-paper-o").closest("a").addClass("active"),svConfigs.videoScreen&&svConfigs.videoScreen.waitingRoom?toggleError(e,5e3):showMessage("",e,null,"raiseHand")}),1==svConfigs.whiteboard.enabled&&(queryString.isAdmin&&!svConfigs.videoScreen.videoFileStream&&(n("#whiteboard_div").show(),n("#whiteboardLi").show()),loadScript("../js/canvas-designer-widget.js",function(){})),1==svConfigs.serverSide.feedback&&loadScript("../js/jquery.rateit.js",function(){}),n(document).off("ChatMessage"),n(document).on("ChatMessage",function(e){var o=names[e.sessionId]?names[e.sessionId].name:peer_name,t=names[e.sessionId]?names[e.sessionId].avatar:peer_avatar;if("raiseHand"==e.msg){var i=smartVideoLocale.msgStore.raiseHandText.replace("{{caller_name}}",names[e.sessionId].name);svConfigs.videoScreen&&svConfigs.videoScreen.waitingRoom?toggleError(i,5e3):showMessage("",i,null,"raiseHand"),names[e.sessionId].raiseHand=!0,r(),setTimeout(function(){names[e.sessionId].raiseHand=!1,r()},15e4)}else if("sendFile"==e.msg){var a=e.sessionId?names[e.sessionId].name:peer_name,s=smartVideoLocale.msgStore.incomingFile;s=s.replace("{{caller_name}}",a),svConfigs.videoScreen&&svConfigs.videoScreen.waitingRoom?toggleError(s,5e3):showMessage("",s,null,"sendFile")}else showMessage(o,e.msg,null,null,t);"conference"==conferenceStyle?n("#formito_chat").hasClass("is-open")?n(".new_chat_badge_container").hide():n(".new_chat_badge_container").show():svConfigs.videoScreen&&!0===svConfigs.videoScreen.chat?n(".wd-v-text").hide():n(".new_chat_badge_container").show()}),n(document).off("TranslateMessage"),n(document).on("TranslateMessage",function(e){var n=names[e.sessionId]?names[e.sessionId].name:peer_name;names[e.sessionId]&&names[e.sessionId].avatar;ui_handler.showTranslateMessage(n+": "+e.msg)}),n(document).off("SendTyping"),n(document).on("SendTyping",function(e){if(e.typing){n('li[data-system-attribue="chatTyping"]').remove(),n('div[data-system-attribue="chatTyping"]').remove();var o=names[e.sessionId]?names[e.sessionId].name:guestName(e.sessionId);showMessage("",o+" is typing",null,"chatTyping")}else n('li[data-system-attribue="chatTyping"]').remove(),n('div[data-system-attribue="chatTyping"]').remove()});var P=0;n("#newdev_chat_message1").keyup(function(e){if(clearTimeout(k),++P%3==0&&comm_controller.sendTyping(!0),k=setTimeout(function(){comm_controller.sendTyping(!1)},1200),"conference"==conferenceStyle)var o=n("#newdev_chat_message1").val();else o=n("#newdev_chat_message1").text();13==e.keyCode&&o&&(user_act=!0,S(o,!0),n("#newdev_chat_message1").html(""),n("#newdev_chat_message1").val(""),comm_controller.sendTyping(!1))}),isOnline||queryString.isAdmin?setTimeout(function(){A()},100):T(),n(document).off("IncomingFileTransfer"),n(document).on("IncomingFileTransfer",function(e){if(e.sender){var n=smartVideoLocale.msgStore.sendingFile;showMessage("",n+e.name+'<br/><div class="progress"><progress id="progress'+e.fileId+'" max="0" value="0"></progress></div>',null,"fileTransfer")}else{var o=e.fileId,t=e.name+'<br/><div class="progress"><progress id="progress'+o+'" max="0" value="0"></progress></div><span id="download'+o+'"></span>';showMessage("",t,null,"fileTransfer"),svConfigs.serverSide.chatHistory&&saveChat(smartVideoLocale.msgStore.receivingFile+e.name,"","fileTransfer",agentId,"",names)}}),n("#file_transfer").off(),n("#file_transfer").on("click",function(e){(new FileSelector).selectSingleFile(function(e){S("sendFile"),comm_controller.sendFile(e)})}),n(document).off("SendCallerBack"),n(document).on("SendCallerBack",function(e){if(!queryString.isAdmin&&e.sessionId==comm_controller.getSessionId()&&!is_callerback){if(is_callerback=!0,toggleNotification("",!1),!e.access)return localStorage.removeItem("prd"),localStorage.removeItem("prdTmp"),location.reload(),!1;isOnline=!0,ui_handler.setDisabled(!1),n("#ng_info").hide(),n("#continue-button").off(),localStorage.getItem("prdTmp")&&(localStorage.setItem("prd",localStorage.getItem("prdTmp")),localStorage.removeItem("prdTmp"));var o=localStorage.getItem("prd");names[comm_controller.getSessionId()]={name:o?o.name:caller_name,avatar:o?o.avatar:caller_avatar,email:o?o.email:caller_email},"conference"==conferenceStyle&&_()}}),n("#newdev_chat_button1").click(function(e){C("newdev_chat_message1")}),n(document).off("AdminPopupOnline"),n(document).on("AdminPopupOnline",function(e){isOnline=!0,requirePass=null!=e.pass&&e.pass,A()}),n(document).off("PopupOnline"),n(document).on("PopupOnline",function(e){e.sessionId&&"visitor"!==e.sessionId&&(names[e.sessionId]||(names[e.sessionId]={avatar:e.avatar?e.avatar:lsRepUrl+"img/small-avatar.jpg",name:e.name?e.name:guestName(e.sessionId)},e.callerInfo&&i(e),u()),isOnline=!0,requirePass=null!=e.pass&&e.pass,A(e.sessionId))}),n(".wd-v-recording").on("click",function(){multiStreamRecorder&&"recording"==multiStreamRecorder.getState()?m(!0):l()}),n("#startRecording").on("click",function(){multiStreamRecorder&&"recording"==multiStreamRecorder.getState()?m(!0):l()}),n(document).on("RemoteStartRecording",function(e){n(".recordingIcon").show()}),n(document).on("RemoteStopRecording",function(e){n(".recordingIcon").hide()}),n(document).on("ScreenShareFailed",function(e){toggleError("Screen Share failed"),w(!1)}),n(document).off("RemoteScreenShareStarted"),n(document).on("RemoteScreenShareStarted",function(e){!queryString.broadcast&&svConfigs.videoScreen.separateScreenShare&&("list"==currentView?ui_handler.makeAllSmall():ui_handler.makeAllSmallGrid()),ui_handler.displayScreenShare(),n("#remoteScreen").show(),ui_handler.setScreenDisabled(!0)}),n(document).off("ScreenShareEnded"),n(document).on("ScreenShareEnded",function(e){ui_handler.setScreenDisabled(!1),w(!1),n("#remoteScreen").is(":visible")||comm_controller.getStream()||("conference"==conferenceStyle?ui_handler.displayVideoOnly():ui_handler.toggleInstaChat())}),n(document).on("EndMeeting",function(e){R(!1)}),n("#exit_meeting").on("click",function(){n("#hangupBroadcastButton").trigger("click"),f(),comm_controller.endMeeting(),R(!0)}),(isChrome||isFirefox||isOpera||isSafariA)&&!isiPhone&&(queryString.room||queryString.broadcast||localStorage.getItem("hasPrivileges"))&&(n(".wd-v-share").show(),n("#screenshare_div").show(),n(document).on("PluginDetected",function(e){pluginInstalled=!0}),n(document).on("PluginNotDetected",function(e){pluginInstalled=!1}),n(".control-ss > a").click(function(){n(".control-ss").hide()}));var O=function(){b()};n(".wd-v-share").on("click",function(){O()}),n("#startscreenshare").off("click",function(){}),n("#startscreenshare").on("click",function(){isOnline?(ui_handler.displayVideoOnly(),O()):T()}),n(".wd-v-stopshare").on("click",function(){y()}),n("#stopscreenshare").on("click",function(){y()}),(queryString.isAdmin||queryString.broadcast)&&(isChrome||isFirefox||isOpera)&&!isiPhone&&1==svConfigs.recording.enabled&&loadScript(lsRepUrl+"js/msr.js",function(){}),svConfigs.videoScreen&&svConfigs.videoScreen.onlyAgentButtons&&!queryString.isAdmin&&ui_handler.setAgentOnlyButtons(),disableVideo&&ui_handler.disableVideo(),disableAudio&&ui_handler.disableAudio(),disableScreenShare&&ui_handler.disableScreenShare(),disableWhiteboard&&ui_handler.disableWhiteboard(),disableTransfer&&ui_handler.disableTransfer(),n(document).on("click",".closebtn",function(){n("body").removeClass("menuopen"),n(".menu-link").removeClass("active")}),n(document).on("click",".fo-icon",function(){n(".formito-launcher").toggleClass("is-open"),n(".new_chat_badge_container").hide()}),n(document).on("click",".fa-users",function(e){n("#attendees").toggle(),e.stopPropagation()}),n(document.body).on("click",function(e){var o=e.target.id;"private_message_small"!==o&&"fausers"!==o&&(n("#attendees").hide(),n("#visitor_message").hide())}),n(document).mouseup(function(e){var o;(o=n("#nd_widget_visitors")).is(e.target)||0!==o.has(e.target).length||ui_handler.toggleVisitors(!1),(o=n("#feedback_form")).is(e.target)||0!==o.has(e.target).length||n("#feedback_form").hide()}),smartVideoLocale.persistMsgStore(smartVideoLocale.msgStore),r(),loadScript(lsRepUrl+"js/additional.js",function(){})})}(ui_handler=new uiHandler).init(jQuery,t,comm_controller),jQuery(document).on("CommConnected",function(e){function n(){m(!0),deleteCookie("lsvGreenRoom")}window.addEventListener?window.addEventListener("beforeunload",n,!1):window.attachEvent("onbeforeunload",n),loadScript(isAndroid||isiPhone?lsRepUrl+"js/adapter-latest.js":isIEA?lsRepUrl+"js/adapter.screenshare.js":lsRepUrl+"js/adapter-latest.js",M())})})};function loadScript(e,n){var o=document.createElement("script");o.type="text/javascript",o.readyState?o.onreadystatechange=function(){"loaded"!=o.readyState&&"complete"!=o.readyState||(o.onreadystatechange=null,n&&n())}:o.onload=function(){n&&n()},o.src=e+"?v="+currVersion,document.getElementsByTagName("head")[0].appendChild(o)}var init=new main;